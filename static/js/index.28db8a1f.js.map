{"version":3,"file":"static/js/index.28db8a1f.js","mappings":"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","sources":["webpack://wasm-boids/./src/components/Settings.vue","webpack://wasm-boids/./src/components/Settings.vue?b3ff","webpack://wasm-boids/./src/rendering/BoidInstancing.js","webpack://wasm-boids/./src/rendering/FogPipeline.js","webpack://wasm-boids/./src/rendering/ParticleField.js","webpack://wasm-boids/./src/simulation/WasmtimeBridge.js","webpack://wasm-boids/./src/state/FlockSettingsStore.js","webpack://wasm-boids/./src/App.vue","webpack://wasm-boids/./src/App.vue?7ccd","webpack://wasm-boids/./src/main.js","webpack://wasm-boids/webpack/bootstrap","webpack://wasm-boids/webpack/runtime/chunk loaded","webpack://wasm-boids/webpack/runtime/define property getters","webpack://wasm-boids/webpack/runtime/global","webpack://wasm-boids/webpack/runtime/hasOwnProperty shorthand","webpack://wasm-boids/webpack/runtime/jsonp chunk loading","webpack://wasm-boids/webpack/startup"],"sourcesContent":["// filepath: d:\\GitHub\\wasm-boids\\src\\components\\Settings.vue\r\n<template>\r\n  <div class=\"settings\">\r\n    <details class=\"species-section\" :open=\"false\">\r\n      <summary class=\"species-header\">\r\n        <span class=\"species-title\">{{ settings.species }} ({{ settings.count }})</span>\r\n        <button\r\n          v-if=\"canRemove\"\r\n          class=\"species-remove\"\r\n          type=\"button\"\r\n          @click.stop=\"emitRemove\"\r\n        ></button>\r\n      </summary>\r\n      <div class=\"species-content\">\r\n        <div class=\"setting-row\">\r\n          <label><br>(Species):</label>\r\n          <span>{{ settings.species }}</span>\r\n        </div>\r\n        <div class=\"setting-row\">\r\n          <label>()<br>(Count):</label>\r\n          <input\r\n            type=\"range\"\r\n            v-model.number=\"countDraft\"\r\n            min=\"0\"\r\n            max=\"50000\"\r\n            step=\"1\"\r\n            @change=\"commitCountFromSlider\"\r\n          />\r\n          <span \r\n            v-if=\"!editingCount\" \r\n            class=\"editable-value\" \r\n            @click=\"startEditCount\"\r\n            title=\"\"\r\n          >{{ settings.count }}</span>\r\n          <input \r\n            v-if=\"editingCount\"\r\n            type=\"number\" \r\n            v-model.number=\"countDraft\" \r\n            min=\"0\" \r\n            max=\"20000\"\r\n            class=\"value-input\"\r\n            @blur=\"cancelCountEdit\"\r\n            @keyup.enter=\"commitCountFromInput\"\r\n            ref=\"countInput\"\r\n          />\r\n        </div><div class=\"setting-row\">\r\n      <label><br>(Cohesion):</label>\r\n      <input type=\"range\" v-model.number=\"settings.cohesion\" min=\"0\" max=\"40\" step=\"0.01\" />\r\n      <span \r\n        v-if=\"!editingCohesion\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditCohesion\"\r\n        title=\"\"\r\n      >{{ settings.cohesion }}</span>\r\n      <input \r\n        v-if=\"editingCohesion\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.cohesion\" \r\n        min=\"0\" \r\n        max=\"40\"\r\n        step=\"0.01\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditCohesion\"\r\n        @keyup.enter=\"stopEditCohesion\"\r\n        ref=\"cohesionInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Cohesion Range):</label>\r\n      <input type=\"range\" v-model.number=\"settings.cohesionRange\" min=\"1\" max=\"300\" step=\"1\" />\r\n      <span \r\n        v-if=\"!editingCohesionRange\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditCohesionRange\"\r\n        title=\"\"\r\n      >{{ settings.cohesionRange }}</span>\r\n      <input \r\n        v-if=\"editingCohesionRange\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.cohesionRange\" \r\n        min=\"1\" \r\n        max=\"300\"\r\n        step=\"1\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditCohesionRange\"\r\n        @keyup.enter=\"stopEditCohesionRange\"\r\n        ref=\"cohesionRangeInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Separation):</label>\r\n      <input type=\"range\" v-model.number=\"settings.separation\" min=\"0\" max=\"10\" step=\"0.01\" />\r\n      <span \r\n        v-if=\"!editingSeparation\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditSeparation\"\r\n        title=\"\"\r\n      >{{ settings.separation }}</span>\r\n      <input \r\n        v-if=\"editingSeparation\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.separation\" \r\n        min=\"0\" \r\n        max=\"10\"\r\n        step=\"0.01\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditSeparation\"\r\n        @keyup.enter=\"stopEditSeparation\"\r\n        ref=\"separationInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Separation Range):</label>\r\n      <input type=\"range\" v-model.number=\"settings.separationRange\" min=\"0.1\" max=\"10\" step=\"0.1\" />\r\n      <span \r\n        v-if=\"!editingSeparationRange\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditSeparationRange\"\r\n        title=\"\"\r\n      >{{ settings.separationRange }}</span>\r\n      <input \r\n        v-if=\"editingSeparationRange\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.separationRange\" \r\n        min=\"0.1\" \r\n        max=\"10\"\r\n        step=\"0.1\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditSeparationRange\"\r\n        @keyup.enter=\"stopEditSeparationRange\"\r\n        ref=\"separationRangeInput\"\r\n      />\r\n    </div>    <div class=\"setting-row\">\r\n      <label><br>(Alignment):</label>\r\n      <input type=\"range\" v-model.number=\"settings.alignment\" min=\"0\" max=\"20\" step=\"0.01\" />\r\n      <span \r\n        v-if=\"!editingAlignment\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditAlignment\"\r\n        title=\"\"\r\n      >{{ settings.alignment }}</span>\r\n      <input \r\n        v-if=\"editingAlignment\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.alignment\" \r\n        min=\"0\" \r\n        max=\"20\"\r\n        step=\"0.01\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditAlignment\"\r\n        @keyup.enter=\"stopEditAlignment\"\r\n        ref=\"alignmentInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Alignment Range):</label>\r\n      <input type=\"range\" v-model.number=\"settings.alignmentRange\" min=\"1\" max=\"100\" step=\"1\" />\r\n      <span \r\n        v-if=\"!editingAlignmentRange\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditAlignmentRange\"\r\n        title=\"\"\r\n      >{{ settings.alignmentRange }}</span>\r\n      <input \r\n        v-if=\"editingAlignmentRange\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.alignmentRange\" \r\n        min=\"1\" \r\n        max=\"100\"\r\n        step=\"1\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditAlignmentRange\"\r\n        @keyup.enter=\"stopEditAlignmentRange\"\r\n        ref=\"alignmentRangeInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Predator Alert):</label>\r\n      <input type=\"range\" v-model.number=\"settings.predatorAlertRadius\" min=\"0\" max=\"10\" step=\"0.05\" />\r\n      <span \r\n        v-if=\"!editingPredatorAlertRadius\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditPredatorAlertRadius\"\r\n        title=\"\"\r\n      >{{ settings.predatorAlertRadius }}</span>\r\n      <input \r\n        v-if=\"editingPredatorAlertRadius\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.predatorAlertRadius\" \r\n        min=\"0\" \r\n        max=\"20\"\r\n        step=\"0.05\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditPredatorAlertRadius\"\r\n        @keyup.enter=\"stopEditPredatorAlertRadius\"\r\n        ref=\"predatorAlertRadiusInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Max Speed):</label>\r\n      <input type=\"range\" v-model.number=\"settings.maxSpeed\" min=\"0.1\" max=\"2\" step=\"0.01\" />\r\n      <span \r\n        v-if=\"!editingMaxSpeed\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditMaxSpeed\"\r\n        title=\"\"\r\n      >{{ settings.maxSpeed }}</span>\r\n      <input \r\n        v-if=\"editingMaxSpeed\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.maxSpeed\" \r\n        min=\"0.1\" \r\n        max=\"2\"\r\n        step=\"0.01\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditMaxSpeed\"\r\n        @keyup.enter=\"stopEditMaxSpeed\"\r\n        ref=\"maxSpeedInput\"\r\n      />\r\n    </div>    <div class=\"setting-row\">\r\n      <label><br>(Max Turn Angle):</label>\r\n      <input type=\"range\" v-model.number=\"settings.maxTurnAngle\" min=\"0.001\" max=\"0.3\" step=\"0.001\" />\r\n      <span \r\n        v-if=\"!editingMaxTurnAngle\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditMaxTurnAngle\"\r\n        title=\"\"\r\n      >{{ settings.maxTurnAngle }}</span>\r\n      <input \r\n        v-if=\"editingMaxTurnAngle\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.maxTurnAngle\" \r\n        min=\"0.001\" \r\n        max=\"0.3\"\r\n        step=\"0.001\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditMaxTurnAngle\"\r\n        @keyup.enter=\"stopEditMaxTurnAngle\"\r\n        ref=\"maxTurnAngleInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Max Neighbors):</label>\r\n      <input type=\"range\" v-model.number=\"settings.maxNeighbors\" min=\"0\" max=\"32\" step=\"1\" />\r\n      <span \r\n        v-if=\"!editingMaxNeighbors\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditMaxNeighbors\"\r\n        title=\"\"\r\n      >{{ settings.maxNeighbors }}</span>\r\n      <input \r\n        v-if=\"editingMaxNeighbors\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.maxNeighbors\" \r\n        min=\"0\" \r\n        max=\"32\"\r\n        step=\"1\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditMaxNeighbors\"\r\n        @keyup.enter=\"stopEditMaxNeighbors\"\r\n        ref=\"maxNeighborsInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Horizontal Torque):</label>\r\n      <input type=\"range\" v-model.number=\"settings.horizontalTorque\" min=\"0.0\" max=\"0.2\" step=\"0.001\" />\r\n      <span \r\n        v-if=\"!editingHorizontalTorque\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditHorizontalTorque\"\r\n        title=\"\"\r\n      >{{ settings.horizontalTorque }}</span>\r\n      <input \r\n        v-if=\"editingHorizontalTorque\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.horizontalTorque\" \r\n        min=\"0.0\" \r\n        max=\"0.2\"\r\n        step=\"0.001\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditHorizontalTorque\"\r\n        @keyup.enter=\"stopEditHorizontalTorque\"\r\n        ref=\"horizontalTorqueInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Torque Strength):</label>\r\n      <input type=\"range\" v-model.number=\"settings.torqueStrength\" min=\"0.0\" max=\"20\" step=\"0.001\" />\r\n      <span \r\n        v-if=\"!editingTorqueStrength\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditTorqueStrength\"\r\n        title=\"\"\r\n      >{{ settings.torqueStrength }}</span>\r\n      <input \r\n        v-if=\"editingTorqueStrength\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.torqueStrength\" \r\n        min=\"0.0\" \r\n        max=\"5\"\r\n        step=\"0.001\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditTorqueStrength\"\r\n        @keyup.enter=\"stopEditTorqueStrength\"\r\n        ref=\"torqueStrengthInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Damping Coefficient):</label>\r\n      <input type=\"range\" v-model.number=\"settings.lambda\" min=\"0\" max=\"1\" step=\"0.001\" />\r\n      <span \r\n        v-if=\"!editingLambda\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditLambda\"\r\n        title=\"\"\r\n      >{{ settings.lambda }}</span>\r\n      <input \r\n        v-if=\"editingLambda\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.lambda\" \r\n        min=\"0\" \r\n        max=\"1\"\r\n        step=\"0.001\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditLambda\"\r\n        @keyup.enter=\"stopEditLambda\"\r\n        ref=\"lambdaInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Memory Time):</label>\r\n      <input type=\"range\" v-model.number=\"settings.tau\" min=\"0\" max=\"5\" step=\"0.01\" />\r\n      <span \r\n        v-if=\"!editingTau\" \r\n        class=\"editable-value\" \r\n        @click=\"startEditTau\"\r\n        title=\"\"\r\n      >{{ settings.tau }}</span>\r\n      <input \r\n        v-if=\"editingTau\"\r\n        type=\"number\" \r\n        v-model.number=\"settings.tau\" \r\n        min=\"0\" \r\n        max=\"5\"\r\n        step=\"0.01\"\r\n        class=\"value-input\"\r\n        @blur=\"stopEditTau\"\r\n        @keyup.enter=\"stopEditTau\"\r\n        ref=\"tauInput\"\r\n      />\r\n    </div>\r\n    <div class=\"setting-row\">\r\n      <label><br>(Is Predator):</label>\r\n      <input type=\"checkbox\" v-model=\"settings.isPredator\" />\r\n      <span>{{ settings.isPredator }}</span>\r\n    </div>\r\n      </div>\r\n    </details>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, nextTick, watch } from 'vue';\r\n\r\nconst emit = defineEmits(['remove']);\r\n\r\nconst props = defineProps({\r\n  settings: {\r\n    type: Object,\r\n    required: true\r\n  },\r\n  canRemove: {\r\n    type: Boolean,\r\n    default: false\r\n  }\r\n});\r\n\r\nconst settings = props.settings;\r\n\r\n// ref\r\nconst editingCount = ref(false);\r\nconst editingCohesion = ref(false);\r\nconst editingCohesionRange = ref(false);\r\nconst editingSeparation = ref(false);\r\nconst editingSeparationRange = ref(false);\r\nconst editingAlignment = ref(false);\r\nconst editingAlignmentRange = ref(false);\r\nconst editingMaxSpeed = ref(false);\r\nconst editingMaxTurnAngle = ref(false);\r\nconst editingMaxNeighbors = ref(false);\r\nconst editingHorizontalTorque = ref(false);\r\nconst editingTorqueStrength = ref(false);\r\nconst editingLambda = ref(false);\r\nconst editingTau = ref(false);\r\nconst editingPredatorAlertRadius = ref(false);\r\n\r\n// ref\r\nconst countInput = ref(null);\r\nconst cohesionInput = ref(null);\r\nconst cohesionRangeInput = ref(null);\r\nconst separationInput = ref(null);\r\nconst separationRangeInput = ref(null);\r\nconst alignmentInput = ref(null);\r\nconst alignmentRangeInput = ref(null);\r\nconst maxSpeedInput = ref(null);\r\nconst maxTurnAngleInput = ref(null);\r\nconst maxNeighborsInput = ref(null);\r\nconst horizontalTorqueInput = ref(null);\r\nconst torqueStrengthInput = ref(null);\r\nconst lambdaInput = ref(null);\r\nconst tauInput = ref(null);\r\nconst predatorAlertRadiusInput = ref(null);\r\n\r\nconst countDraft = ref(settings.count ?? 0);\r\n\r\nwatch(\r\n  () => settings.count,\r\n  (value) => {\r\n    if (!editingCount.value) {\r\n      countDraft.value = value ?? 0;\r\n    }\r\n  }\r\n);\r\n\r\n// \r\nasync function startEditCount() {\r\n  editingCount.value = true;\r\n  countDraft.value = settings.count ?? 0;\r\n  await nextTick();\r\n  if (countInput.value) {\r\n    countInput.value.focus();\r\n    countInput.value.select();\r\n  }\r\n}\r\n\r\nfunction cancelCountEdit() {\r\n  editingCount.value = false;\r\n  countDraft.value = settings.count ?? 0;\r\n}\r\n\r\nfunction applyCountDraft() {\r\n  const nextValue = Math.max(0, Math.round(Number.isFinite(countDraft.value) ? countDraft.value : 0));\r\n  if (settings.count !== nextValue) {\r\n    settings.count = nextValue;\r\n  }\r\n}\r\n\r\nfunction commitCountFromSlider() {\r\n  applyCountDraft();\r\n}\r\n\r\nfunction commitCountFromInput() {\r\n  applyCountDraft();\r\n  cancelCountEdit();\r\n}\r\n\r\nfunction emitRemove() {\r\n  emit('remove');\r\n}\r\n\r\nasync function startEditCohesion() {\r\n  editingCohesion.value = true;\r\n  await nextTick();\r\n  if (cohesionInput.value) {\r\n    cohesionInput.value.focus();\r\n    cohesionInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditCohesionRange() {\r\n  editingCohesionRange.value = true;\r\n  await nextTick();\r\n  if (cohesionRangeInput.value) {\r\n    cohesionRangeInput.value.focus();\r\n    cohesionRangeInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditSeparation() {\r\n  editingSeparation.value = true;\r\n  await nextTick();\r\n  if (separationInput.value) {\r\n    separationInput.value.focus();\r\n    separationInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditSeparationRange() {\r\n  editingSeparationRange.value = true;\r\n  await nextTick();\r\n  if (separationRangeInput.value) {\r\n    separationRangeInput.value.focus();\r\n    separationRangeInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditAlignment() {\r\n  editingAlignment.value = true;\r\n  await nextTick();\r\n  if (alignmentInput.value) {\r\n    alignmentInput.value.focus();\r\n    alignmentInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditAlignmentRange() {\r\n  editingAlignmentRange.value = true;\r\n  await nextTick();\r\n  if (alignmentRangeInput.value) {\r\n    alignmentRangeInput.value.focus();\r\n    alignmentRangeInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditPredatorAlertRadius() {\r\n  editingPredatorAlertRadius.value = true;\r\n  await nextTick();\r\n  if (predatorAlertRadiusInput.value) {\r\n    predatorAlertRadiusInput.value.focus();\r\n    predatorAlertRadiusInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditMaxSpeed() {\r\n  editingMaxSpeed.value = true;\r\n  await nextTick();\r\n  if (maxSpeedInput.value) {\r\n    maxSpeedInput.value.focus();\r\n    maxSpeedInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditMaxTurnAngle() {\r\n  editingMaxTurnAngle.value = true;\r\n  await nextTick();\r\n  if (maxTurnAngleInput.value) {\r\n    maxTurnAngleInput.value.focus();\r\n    maxTurnAngleInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditMaxNeighbors() {\r\n  editingMaxNeighbors.value = true;\r\n  await nextTick();\r\n  if (maxNeighborsInput.value) {\r\n    maxNeighborsInput.value.focus();\r\n    maxNeighborsInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditHorizontalTorque() {\r\n  editingHorizontalTorque.value = true;\r\n  await nextTick();\r\n  if (horizontalTorqueInput.value) {\r\n    horizontalTorqueInput.value.focus();\r\n    horizontalTorqueInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditTorqueStrength() {\r\n  editingTorqueStrength.value = true;\r\n  await nextTick();\r\n  if (torqueStrengthInput.value) {\r\n    torqueStrengthInput.value.focus();\r\n    torqueStrengthInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditLambda() {\r\n  editingLambda.value = true;\r\n  await nextTick();\r\n  if (lambdaInput.value) {\r\n    lambdaInput.value.focus();\r\n    lambdaInput.value.select();\r\n  }\r\n}\r\n\r\nasync function startEditTau() {\r\n  editingTau.value = true;\r\n  await nextTick();\r\n  if (tauInput.value) {\r\n    tauInput.value.focus();\r\n    tauInput.value.select();\r\n  }\r\n}\r\n\r\nfunction stopEditCohesion() {\r\n  editingCohesion.value = false;\r\n}\r\n\r\nfunction stopEditCohesionRange() {\r\n  editingCohesionRange.value = false;\r\n}\r\n\r\nfunction stopEditSeparation() {\r\n  editingSeparation.value = false;\r\n}\r\n\r\nfunction stopEditSeparationRange() {\r\n  editingSeparationRange.value = false;\r\n}\r\n\r\nfunction stopEditAlignment() {\r\n  editingAlignment.value = false;\r\n}\r\n\r\nfunction stopEditAlignmentRange() {\r\n  editingAlignmentRange.value = false;\r\n}\r\n\r\nfunction stopEditPredatorAlertRadius() {\r\n  editingPredatorAlertRadius.value = false;\r\n}\r\n\r\nfunction stopEditMaxSpeed() {\r\n  editingMaxSpeed.value = false;\r\n}\r\n\r\nfunction stopEditMaxTurnAngle() {\r\n  editingMaxTurnAngle.value = false;\r\n}\r\n\r\nfunction stopEditMaxNeighbors() {\r\n  editingMaxNeighbors.value = false;\r\n}\r\n\r\nfunction stopEditHorizontalTorque() {\r\n  editingHorizontalTorque.value = false;\r\n}\r\n\r\nfunction stopEditTorqueStrength() {\r\n  editingTorqueStrength.value = false;\r\n}\r\n\r\nfunction stopEditLambda() {\r\n  editingLambda.value = false;\r\n}\r\n\r\nfunction stopEditTau() {\r\n  editingTau.value = false;\r\n}\r\n</script>\r\n\r\n<style scoped>\r\n.settings {\r\n  margin-bottom: 20px;\r\n  width: 100%;\r\n  min-width: 260px;\r\n  max-width: 520px;\r\n  box-sizing: border-box;\r\n  pointer-events: auto;\r\n  position: relative;\r\n  z-index: 1;\r\n}\r\n.setting-row {\r\n  display: flex;\r\n  align-items: center;\r\n  margin-bottom: 8px;\r\n  width: 100%;\r\n}\r\n.setting-row label {\r\n  width: 130px;\r\n  text-align: left;\r\n  margin-right: 10px;\r\n  flex-shrink: 0;\r\n  display: inline-block;\r\n}\r\n.setting-row input[type=\"range\"] {\r\n  width: 120px;\r\n  min-width: 80px;\r\n  max-width: 200px;\r\n  margin: 0 10px;\r\n  flex: none;\r\n  display: inline-block;\r\n}\r\n.setting-row span {\r\n  width: 60px;\r\n  text-align: left;\r\n  display: inline-block;\r\n  flex-shrink: 0;\r\n}\r\n\r\n.editable-value {\r\n  cursor: pointer;\r\n  padding: 2px 4px;\r\n  border-radius: 3px;\r\n  transition: background-color 0.2s;\r\n}\r\n\r\n.editable-value:hover {\r\n  background-color: rgba(255, 255, 255, 0.1);\r\n  text-decoration: underline;\r\n}\r\n\r\n.value-input {\r\n  width: 60px;\r\n  padding: 2px 4px;\r\n  border: 1px solid #ccc;\r\n  border-radius: 3px;\r\n  background: transparent;\r\n  color: inherit;\r\n  font-size: inherit;\r\n  text-align: left;\r\n}\r\n\r\n.value-input:focus {\r\n  outline: none;\r\n  border-color: #007bff;\r\n  box-shadow: 0 0 3px rgba(0, 123, 255, 0.3);\r\n}\r\n\r\n.species-section {\r\n  border: 1px solid rgba(255, 255, 255, 0.2);\r\n  border-radius: 5px;\r\n  margin-bottom: 10px;\r\n  background-color: rgba(255, 255, 255, 0.05);\r\n  pointer-events: auto;\r\n  position: relative;\r\n  overflow: visible;\r\n  max-width: 100%;\r\n  width: fit-content;\r\n  min-width: 260px;\r\n}\r\n\r\n.species-header {\r\n  padding: 10px;\r\n  font-weight: bold;\r\n  cursor: pointer;\r\n  background-color: rgba(255, 255, 255, 0.1);\r\n  border-radius: 5px 5px 0 0;\r\n  user-select: none;\r\n  pointer-events: auto;\r\n  max-width: 100%;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  display: flex;\r\n  align-items: center;\r\n  justify-content: space-between;\r\n  gap: 8px;\r\n}\r\n\r\n.species-title {\r\n  flex: 1;\r\n}\r\n\r\n.species-remove {\r\n  pointer-events: auto;\r\n  background: #d9534f;\r\n  color: #fff;\r\n  border: none;\r\n  border-radius: 4px;\r\n  padding: 4px 8px;\r\n  font-size: 0.8rem;\r\n  cursor: pointer;\r\n}\r\n\r\n.species-remove:hover {\r\n  background: #c9302c;\r\n}\r\n\r\n.species-header:hover {\r\n  background-color: rgba(255, 255, 255, 0.15);\r\n}\r\n\r\n.species-content {\r\n  padding: 10px;\r\n  pointer-events: auto;\r\n  position: relative;\r\n  max-width: 100%;\r\n  width: 100%;\r\n  box-sizing: border-box;\r\n  overflow: hidden;\r\n}\r\n</style>","import script from \"./Settings.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./Settings.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./Settings.vue?vue&type=style&index=0&id=255c5208&scoped=true&lang=css\"\n\nimport exportComponent from \"../../node_modules/vue-loader/dist/exportHelper.js\"\nconst __exports__ = /*#__PURE__*/exportComponent(script, [['__scopeId',\"data-v-255c5208\"]])\n\nexport default __exports__","import * as THREE from 'three';\n\n/**\n * Boid \n * / LOD  uniform \n */\nexport class BoidInstancing {\n  constructor({\n    tailAnimation,\n    tripleBufferSize = 3,        // \n    hiddenPosition = 1e6,        // \n    identityQuaternion = [0, 0, 0, 1], // \n    lodNearDistanceSq = 4,       // 2m\n    lodMidDistanceSq = 25,       // LOD 5m\n  } = {}) {\n    this.tailAnimation = tailAnimation;\n    this.tripleBufferSize = tripleBufferSize;\n    this.hiddenPosition = hiddenPosition;\n    this.identityQuaternion = identityQuaternion;\n    this.lodNearDistanceSq = lodNearDistanceSq;\n    this.lodMidDistanceSq = lodMidDistanceSq;\n    this.streamUsage = THREE.StreamDrawUsage ?? THREE.DynamicDrawUsage;\n\n    this.scene = null;\n    this.count = 0;\n\n    this.instancedMeshHigh = null;\n    this.instancedMeshLow = null;\n    this.instancingMaterials = new Set();\n\n    this.bufferSetHigh = null;\n    this.bufferSetLow = null;\n    this.tailPhaseSeeds = null;\n    this.bufferCursor = 0;\n\n    this.previousVelocities = null;\n    this.previousLodFlags = null;\n\n    this.predatorModel = null;\n    this.predatorMeshes = [];\n    this.predatorMeshCountCache = -1;\n  }\n\n  init(scene, {\n    count,\n    boidModel,\n    boidModelLod,\n    highMaterial,\n    lowMaterial,\n    predatorModel = null,\n  }) {\n    if (!scene || !boidModel || !boidModelLod || !highMaterial || !lowMaterial) {\n      console.error('BoidInstancing.init: missing required arguments.');\n      return false;\n    }\n    if (!boidModel.children?.length || !boidModel.children[0].geometry) {\n      console.error('BoidInstancing.init: invalid high model.');\n      return false;\n    }\n    if (!boidModelLod.children?.length || !boidModelLod.children[0].geometry) {\n      console.error('BoidInstancing.init: invalid LOD model.');\n      return false;\n    }\n\n    this.dispose(scene);\n\n    this.scene = scene;\n    this.count = count;\n    if (predatorModel) {\n      this.predatorModel = predatorModel;\n    }\n\n    const highMaterialClone = highMaterial.clone();\n    const lowMaterialClone = lowMaterial.clone();\n    this.patchMaterial(highMaterialClone);\n    this.patchMaterial(lowMaterialClone);\n\n    // \n    const highGeometry = boidModel.children[0].geometry.clone();\n    const lowGeometry = boidModelLod.children[0].geometry.clone();\n    this.ensureBodyCoordAttribute(highGeometry);\n    this.ensureBodyCoordAttribute(lowGeometry);\n\n    this.instancedMeshHigh = new THREE.InstancedMesh(highGeometry, highMaterialClone, count);\n    this.configureInstancedMesh(this.instancedMeshHigh, highMaterialClone);\n\n    this.instancedMeshLow = new THREE.InstancedMesh(lowGeometry, lowMaterialClone, count);\n    this.configureInstancedMesh(this.instancedMeshLow, lowMaterialClone);\n\n    scene.add(this.instancedMeshHigh);\n    scene.add(this.instancedMeshLow);\n\n    this.bufferSetHigh = this.createBufferSet(count);\n    this.bufferSetLow = this.createBufferSet(count);\n    this.resetBufferSetToHidden(this.bufferSetHigh);\n    this.resetBufferSetToHidden(this.bufferSetLow);\n\n    this.tailPhaseSeeds = this.createTailPhaseArray(count);\n    this.applyTailPhaseSeeds(this.bufferSetHigh, this.tailPhaseSeeds);\n    this.applyTailPhaseSeeds(this.bufferSetLow, this.tailPhaseSeeds);\n\n    this.bufferCursor = 0;\n    this.applyBufferSet(this.instancedMeshHigh, this.bufferSetHigh, this.bufferCursor);\n    this.applyBufferSet(this.instancedMeshLow, this.bufferSetLow, this.bufferCursor);\n\n    this.instancedMeshHigh.instanceMatrix.setUsage(THREE.StaticDrawUsage);\n    this.instancedMeshLow.instanceMatrix.setUsage(THREE.StaticDrawUsage);\n    this.instancedMeshHigh.count = count;\n    this.instancedMeshLow.count = count;\n\n    this.previousVelocities = null;\n    this.previousLodFlags = null;\n\n    if (this.scene && this.predatorModel) {\n      this.ensurePredatorMeshes(0);\n    }\n\n    return true;\n  }\n\n  /**\n * LOD \n *\n * NOTE:\n *  -  High/Low  count  hiddenPosition \n *     GPU High+Low //\n *  -  LOD mesh.count  High/Low \n *    GPU \n *\n * App.vue instanceIndex  boidIndex\n */\nupdate({\n  count,\n  positions,\n  orientations,\n  velocities,\n  cameraPosition,\n  predatorCount = 0,\n}) {\n  if (!this.instancedMeshHigh || !this.instancedMeshLow || !this.bufferSetHigh || !this.bufferSetLow) {\n    return { visibleCount: 0, lodFlags: null };\n  }\n  if (!positions || !orientations) {\n    return { visibleCount: 0, lodFlags: null };\n  }\n\n  const currentIndex = this.bufferCursor;\n  const nextIndex = (currentIndex + 1) % this.tripleBufferSize;\n\n  this.ensureTailRuntimeBuffers(count);\n  this.ensureTailSeedCapacity(count);\n  const lodFlags = this.ensureLodFlagBuffer(count);\n\n  const highPosAttr = this.bufferSetHigh.pos[currentIndex];\n  const highQuatAttr = this.bufferSetHigh.quat[currentIndex];\n  const highTailParamsAttr = this.bufferSetHigh.tailParams[currentIndex];\n  const highTailPhaseAttr = this.bufferSetHigh.tailPhase[currentIndex];\n  const lowPosAttr = this.bufferSetLow.pos[currentIndex];\n  const lowQuatAttr = this.bufferSetLow.quat[currentIndex];\n  const lowTailParamsAttr = this.bufferSetLow.tailParams[currentIndex];\n  const lowTailPhaseAttr = this.bufferSetLow.tailPhase[currentIndex];\n\n  const highPosArray = highPosAttr.array;\n  const highQuatArray = highQuatAttr.array;\n  const highTailParamsArray = highTailParamsAttr.array;\n  const highTailPhaseArray = highTailPhaseAttr.array;\n  const lowPosArray = lowPosAttr.array;\n  const lowQuatArray = lowQuatAttr.array;\n  const lowTailParamsArray = lowTailParamsAttr.array;\n  const lowTailPhaseArray = lowTailPhaseAttr.array;\n\n  let highTransformTouched = false;\n  let lowTransformTouched = false;\n  let highTailTouched = false;\n  let lowTailTouched = false;\n  let highTailPhaseTouched = false;\n  let lowTailPhaseTouched = false;\n\n  const camX = cameraPosition?.x ?? 0;\n  const camY = cameraPosition?.y ?? 0;\n  const camZ = cameraPosition?.z ?? 0;\n\n  // C++ \n  const predatorStartIndex = predatorCount > 0 ? Math.max(0, count - predatorCount) : count;\n  if (this.scene && this.predatorModel) {\n    if (this.ensurePredatorMeshes(predatorCount)) {\n      this.predatorMeshCountCache = predatorCount;\n    }\n    for (const mesh of this.predatorMeshes) {\n      mesh.visible = false;\n    }\n  }\n\n  const prevVel = this.previousVelocities;\n  const tailSeeds = this.tailPhaseSeeds;\n\n  // LOD  write index\n  let highWrite = 0;\n  let lowWrite = 0;\n\n  // instanceIndex  boidIndex \n  if (!this.highInstanceToBoid || this.highInstanceToBoid.length < count) {\n    this.highInstanceToBoid = new Uint32Array(count);\n    this.lowInstanceToBoid = new Uint32Array(count);\n  }\n\n  for (let i = 0; i < count; i++) {\n    const basePos = i * 3;\n    const baseQuat = i * 4;\n\n    const px = positions[basePos];\n    const py = positions[basePos + 1];\n    const pz = positions[basePos + 2];\n\n    const qx = orientations[baseQuat];\n    const qy = orientations[baseQuat + 1];\n    const qz = orientations[baseQuat + 2];\n    const qw = orientations[baseQuat + 3];\n\n    // \n    if (i >= predatorStartIndex) {\n      if (this.scene && this.predatorModel) {\n        const predatorLocalIndex = i - predatorStartIndex;\n        const predatorMesh = this.predatorMeshes[predatorLocalIndex];\n        if (predatorMesh) {\n          predatorMesh.visible = true;\n          predatorMesh.position.set(px, py, pz);\n          predatorMesh.quaternion.set(qx, qy, qz, qw);\n        }\n      }\n      if (lodFlags) {\n        lodFlags[i] = 0;\n      }\n      continue;\n    }\n\n    const dx = px - camX;\n    const dy = py - camY;\n    const dz = pz - camZ;\n    //  LOD \n    const distSq = dx * dx + dy * dy + dz * dz;\n    const isNear = distSq < this.lodNearDistanceSq;\n    const isMid = !isNear && distSq < this.lodMidDistanceSq;\n    const animateTail = isNear || isMid;\n\n    // \n    const vx = velocities ? velocities[basePos] : 0;\n    const vy = velocities ? velocities[basePos + 1] : 0;\n    const vz = velocities ? velocities[basePos + 2] : 0;\n\n    const speed = Math.hypot(vx, vy, vz);\n    const prevVx = prevVel ? prevVel[basePos] : 0;\n    const prevVy = prevVel ? prevVel[basePos + 1] : 0;\n    const prevVz = prevVel ? prevVel[basePos + 2] : 0;\n    const prevLen = Math.hypot(prevVx, prevVy, prevVz);\n\n    let turnAmount = 0;\n    if (prevLen > 1e-5 && speed > 1e-5) {\n      //  Y \n      const crossY = prevVz * vx - prevVx * vz;\n      const dot = prevVx * vx + prevVy * vy + prevVz * vz;\n      turnAmount = Math.atan2(crossY, dot);\n    }\n\n    const tailSpeedValue = animateTail ? speed : 0;\n    const tailTurnValue = animateTail ? turnAmount : 0;\n    const driveValue = animateTail ? 1 : 0;\n\n    if (isNear) {\n      // High \n      const writeIndex = highWrite;\n      const outPos = writeIndex * 3;\n      const outQuat = writeIndex * 4;\n      const outTail = writeIndex * 3;\n\n      highPosArray[outPos] = px;\n      highPosArray[outPos + 1] = py;\n      highPosArray[outPos + 2] = pz;\n      highQuatArray[outQuat] = qx;\n      highQuatArray[outQuat + 1] = qy;\n      highQuatArray[outQuat + 2] = qz;\n      highQuatArray[outQuat + 3] = qw;\n      highTailParamsArray[outTail] = tailSpeedValue;\n      highTailParamsArray[outTail + 1] = tailTurnValue;\n      highTailParamsArray[outTail + 2] = driveValue;\n      // Boid \n      // tailPhase  Boid LOD \n      const seedValue = tailSeeds && i < tailSeeds.length ? tailSeeds[i] : 0;\n      highTailPhaseArray[writeIndex] = seedValue;\n\n      this.highInstanceToBoid[writeIndex] = i;\n      highWrite++;\n\n      highTransformTouched = true;\n      highTailTouched = true;\n      highTailPhaseTouched = true;\n    } else {\n      // Low \n      const writeIndex = lowWrite;\n      const outPos = writeIndex * 3;\n      const outQuat = writeIndex * 4;\n      const outTail = writeIndex * 3;\n\n      lowPosArray[outPos] = px;\n      lowPosArray[outPos + 1] = py;\n      lowPosArray[outPos + 2] = pz;\n      lowQuatArray[outQuat] = qx;\n      lowQuatArray[outQuat + 1] = qy;\n      lowQuatArray[outQuat + 2] = qz;\n      lowQuatArray[outQuat + 3] = qw;\n      lowTailParamsArray[outTail] = tailSpeedValue;\n      lowTailParamsArray[outTail + 1] = tailTurnValue;\n      lowTailParamsArray[outTail + 2] = driveValue;\n      const seedValue = tailSeeds && i < tailSeeds.length ? tailSeeds[i] : 0;\n      lowTailPhaseArray[writeIndex] = seedValue;\n\n      this.lowInstanceToBoid[writeIndex] = i;\n      lowWrite++;\n\n      lowTransformTouched = true;\n      lowTailTouched = true;\n      lowTailPhaseTouched = true;\n    }\n\n    if (lodFlags) {\n      lodFlags[i] = isNear ? 1 : 2;\n    }\n\n    if (prevVel) {\n      prevVel[basePos] = vx;\n      prevVel[basePos + 1] = vy;\n      prevVel[basePos + 2] = vz;\n    }\n  }\n\n  const visibleCount = predatorCount > 0 ? Math.max(0, count - predatorCount) : count;\n\n  // High/Low \n  this.instancedMeshHigh.count = highWrite;\n  this.instancedMeshLow.count = lowWrite;\n\n  this.applyBufferSet(this.instancedMeshHigh, this.bufferSetHigh, currentIndex);\n  this.applyBufferSet(this.instancedMeshLow, this.bufferSetLow, currentIndex);\n\n  highPosAttr.needsUpdate = highTransformTouched;\n  highQuatAttr.needsUpdate = highTransformTouched;\n  lowPosAttr.needsUpdate = lowTransformTouched;\n  lowQuatAttr.needsUpdate = lowTransformTouched;\n  highTailParamsAttr.needsUpdate = highTailTouched;\n  lowTailParamsAttr.needsUpdate = lowTailTouched;\n  highTailPhaseAttr.needsUpdate = highTailPhaseTouched;\n  lowTailPhaseAttr.needsUpdate = lowTailPhaseTouched;\n\n  this.bufferCursor = nextIndex;\n\n  return {\n    visibleCount,\n    lodFlags,\n    highCount: highWrite,\n    lowCount: lowWrite,\n    highInstanceToBoid: this.highInstanceToBoid,\n    lowInstanceToBoid: this.lowInstanceToBoid,\n  };\n}\n\n  forEachInstancingMaterial(callback) {\n    for (const material of this.instancingMaterials) {\n      callback(material);\n    }\n  }\n\n  getMeshes() {\n    return {\n      high: this.instancedMeshHigh,\n      low: this.instancedMeshLow,\n    };\n  }\n\n  getPredatorMeshes() {\n    return this.predatorMeshes;\n  }\n\n  setTailUniformTime(time) {\n    if (!this.tailAnimation?.uniforms) return;\n    if (this.tailAnimation.uniforms.uTailTime) {\n      this.tailAnimation.uniforms.uTailTime.value = time;\n    }\n  }\n\n  /**\n   *  uniform \n   */\n  patchMaterial(material) {\n    if (!material || material.userData?.instancingPatched) return;\n    const uniforms = this.tailAnimation?.uniforms;\n    if (!uniforms) {\n      console.warn('BoidInstancing.patchMaterial: tailAnimation.uniforms ');\n    }\n\n    material.onBeforeCompile = (shader) => {\n      if (uniforms) {\n        //  uniform \n        Object.entries(uniforms).forEach(([key, uniform]) => {\n          shader.uniforms[key] = uniform;\n        });\n      }\n\n      shader.vertexShader = shader.vertexShader\n        .replace(\n          '#include <common>',\n          `#include <common>\\nattribute vec3 instancePos;\\nattribute vec4 instanceQuat;\\nattribute float aBodyCoord;\\nattribute float instanceTailPhase;\\nattribute vec3 instanceTailParams;\\nuniform float uTailTime;\\nuniform float uTailAmplitude;\\nuniform float uTailFrequency;\\nuniform float uTailPhaseStride;\\nuniform float uTailTurnStrength;\\nuniform float uTailSpeedScale;\\nuniform vec3 uTailRight;\\nuniform vec3 uTailForward;\\nuniform vec3 uTailUp;\\nuniform float uTailEnable;\\nuniform sampler2D uSinLut;\\nuniform float uLutSize;\\nvec3 quatTransform(vec3 v, vec4 q) {\\n  vec3 t = 2.0 * cross(q.xyz, v);\\n  return v + q.w * t + cross(q.xyz, t);\\n}\\nvec2 sampleSinCos(float angle) {\\n  float u = fract(angle * 0.15915494309189535);\\n  u = u * (uLutSize - 1.0) + 0.5;\\n  vec4 lutSample = texture(uSinLut, vec2(u / uLutSize, 0.5));\\n  return lutSample.rg * 2.0 - 1.0;\\n}`\n        )\n        .replace(\n          '#include <instancing_vertex>',\n          `#ifdef USE_INSTANCING\n#endif\n#ifdef USE_INSTANCING_COLOR\n  vColor.xyz *= instanceColor.xyz;\n#endif`\n        )\n        .replace(\n          '#include <begin_vertex>',\n          `#include <begin_vertex>\\nvec3 tailParams = instanceTailParams;\\nif (uTailEnable > 0.5) {\\n  float driveRaw = tailParams.z;\\n  if (driveRaw > 0.01) {\\n    float drive = clamp(driveRaw, 0.0, 1.0);\\n    vec3 originalPos = transformed;\\n    vec3 right = normalize(uTailRight);\\n    vec3 forward = normalize(uTailForward);\\n    vec3 up = normalize(uTailUp);\\n\\n    float localX = dot(originalPos, right);\\n    float localY = dot(originalPos, forward);\\n    float localZ = dot(originalPos, up);\\n\\n    float bodyCoord = clamp(aBodyCoord, 0.0, 1.0);\\n    float tailWeight = smoothstep(0.0, 0.35, bodyCoord);\\n    float speedFactor = clamp(tailParams.x * uTailSpeedScale, 0.0, 2.0);\\n\\n    float phase = instanceTailPhase + uTailTime * uTailFrequency;\\n    float wavePhase = phase + bodyCoord * uTailPhaseStride;\\n    vec2 waveSC = sampleSinCos(wavePhase);\\n    float wag = waveSC.x * uTailAmplitude * drive;\\n    float turnOffset = tailParams.y * uTailTurnStrength * drive;\\n    float motion = wag * (0.4 + 0.6 * speedFactor) + turnOffset;\\n\\n    float tipDamping = 1.0 - smoothstep(0.7, 1.0, bodyCoord) * 0.3;\\n    float bendStrength = mix(0.02, 1.0, tailWeight) * tipDamping;\\n\\n    float bendAngle = motion * bendStrength;\\n    vec2 bendSC = sampleSinCos(bendAngle);\\n    float s = bendSC.x;\\n    float c = bendSC.y;\\n    float rotX = localX * c - localY * s;\\n    float rotY = localX * s + localY * c;\\n\\n    float sway = motion * 0.4 * tipDamping;\\n    rotX += sway * (0.05 + 0.95 * bodyCoord);\\n\\n    vec3 rotated = right * rotX + forward * rotY + up * localZ;\\n    transformed = rotated;\\n  }\\n}\\ntransformed = quatTransform(transformed, instanceQuat) + instancePos;`\n        )\n        .replace(\n          '#include <beginnormal_vertex>',\n          '#include <beginnormal_vertex>\\nobjectNormal = quatTransform(objectNormal, instanceQuat);'\n        )\n        .replace(\n          '#include <project_vertex>',\n          `#include <project_vertex>\\n#ifdef DEPTH_PACKING\\nvec3 tailParams = instanceTailParams;\\nif (uTailEnable > 0.5) {\\n  float driveRaw = tailParams.z;\\n  if (driveRaw > 0.01) {\\n    float drive = clamp(driveRaw, 0.0, 1.0);\\n    vec3 viewPos = mvPosition.xyz;\\n    mat3 normalMatrix3 = mat3(normalMatrix);\\n    vec3 right = normalize(normalMatrix3 * uTailRight);\\n    vec3 forward = normalize(normalMatrix3 * uTailForward);\\n    vec3 up = normalize(normalMatrix3 * uTailUp);\\n\\n    float localX = dot(viewPos, right);\\n    float localY = dot(viewPos, forward);\\n    float localZ = dot(viewPos, up);\\n\\n    float bodyCoord = clamp(aBodyCoord, 0.0, 1.0);\\n    float tailWeight = smoothstep(0.0, 0.35, bodyCoord);\\n    float speedFactor = clamp(tailParams.x * uTailSpeedScale, 0.0, 2.0);\\n\\n    float phase = instanceTailPhase + uTailTime * uTailFrequency;\\n    float wavePhase = phase + bodyCoord * uTailPhaseStride;\\n    vec2 waveSC = sampleSinCos(wavePhase);\\n    float wag = waveSC.x * uTailAmplitude * drive;\\n    float turnOffset = tailParams.y * uTailTurnStrength * drive;\\n    float motion = wag * (0.4 + 0.6 * speedFactor) + turnOffset;\\n\\n    float tipDamping = 1.0 - smoothstep(0.7, 1.0, bodyCoord) * 0.3;\\n    float bendStrength = mix(0.02, 1.0, tailWeight) * tipDamping;\\n\\n    float bendAngle = motion * bendStrength;\\n    vec2 bendSC = sampleSinCos(bendAngle);\\n    float s = bendSC.x;\\n    float c = bendSC.y;\\n    float rotX = localX * c - localY * s;\\n    float rotY = localX * s + localY * c;\\n\\n    float sway = motion * 0.4 * tipDamping;\\n    rotX += sway * (0.05 + 0.95 * bodyCoord);\\n\\n    vec3 rotated = right * rotX + forward * rotY + up * localZ;\\n    mvPosition.xyz = rotated;\\n    gl_Position = projectionMatrix * mvPosition;\\n  }\\n}\\n#endif`\n        );\n\n      material.userData = {\n        ...(material.userData || {}),\n        instancingPatched: true,\n      };\n    };\n\n    material.needsUpdate = true;\n    this.instancingMaterials.add(material);\n  }\n\n  createDepthMaterial(sourceMaterial) {\n    const depthMaterial = new THREE.MeshDepthMaterial({\n      depthPacking: THREE.RGBADepthPacking,\n      alphaTest: sourceMaterial.alphaTest ?? 0,\n    });\n    depthMaterial.map = sourceMaterial.map ?? null;\n    depthMaterial.alphaMap = sourceMaterial.alphaMap ?? null;\n    depthMaterial.transparent = sourceMaterial.transparent ?? false;\n    this.patchMaterial(depthMaterial);\n    return depthMaterial;\n  }\n\n  createDistanceMaterial(sourceMaterial) {\n    const distanceMaterial = new THREE.MeshDistanceMaterial({\n      alphaTest: sourceMaterial.alphaTest ?? 0,\n    });\n    distanceMaterial.map = sourceMaterial.map ?? null;\n    distanceMaterial.alphaMap = sourceMaterial.alphaMap ?? null;\n    distanceMaterial.transparent = sourceMaterial.transparent ?? false;\n    this.patchMaterial(distanceMaterial);\n    return distanceMaterial;\n  }\n\n  configureInstancedMesh(mesh, material) {\n    mesh.castShadow = true;\n    mesh.receiveShadow = true;\n    mesh.frustumCulled = false;\n    mesh.customDepthMaterial = this.createDepthMaterial(material);\n    mesh.customDistanceMaterial = this.createDistanceMaterial(material);\n\n    const white = new THREE.Color(1, 1, 1);\n    for (let i = 0; i < mesh.count; i++) {\n      mesh.setColorAt(i, white);\n    }\n    if (mesh.instanceColor) {\n      mesh.instanceColor.needsUpdate = true;\n    }\n  }\n\n  createAttributeSet(count, itemSize, ArrayType = Float32Array) {\n    const length = count * itemSize;\n    const attributes = [];\n    for (let i = 0; i < this.tripleBufferSize; i++) {\n      const attr = new THREE.InstancedBufferAttribute(new ArrayType(length), itemSize);\n      attr.setUsage(this.streamUsage);\n      attributes.push(attr);\n    }\n    return attributes;\n  }\n\n  createBufferSet(count) {\n    return {\n      pos: this.createAttributeSet(count, 3),\n      quat: this.createAttributeSet(count, 4),\n      tailPhase: this.createAttributeSet(count, 1),\n      tailParams: this.createAttributeSet(count, 3),\n    };\n  }\n\n  resetBufferSetToHidden(bufferSet) {\n    // \n    for (const attr of bufferSet.pos) {\n      const array = attr.array;\n      for (let i = 0; i < array.length; i += 3) {\n        array[i] = this.hiddenPosition;\n        array[i + 1] = this.hiddenPosition;\n        array[i + 2] = this.hiddenPosition;\n      }\n    }\n    for (const attr of bufferSet.quat) {\n      const array = attr.array;\n      for (let i = 0; i < array.length; i += 4) {\n        array[i] = this.identityQuaternion[0];\n        array[i + 1] = this.identityQuaternion[1];\n        array[i + 2] = this.identityQuaternion[2];\n        array[i + 3] = this.identityQuaternion[3];\n      }\n    }\n    for (const attr of bufferSet.tailPhase) {\n      attr.array.fill(0);\n    }\n    for (const attr of bufferSet.tailParams) {\n      attr.array.fill(0);\n    }\n  }\n\n  applyBufferSet(mesh, bufferSet, index) {\n    mesh.geometry.setAttribute('instancePos', bufferSet.pos[index]);\n    mesh.geometry.setAttribute('instanceQuat', bufferSet.quat[index]);\n    mesh.geometry.setAttribute('instanceTailPhase', bufferSet.tailPhase[index]);\n    mesh.geometry.setAttribute('instanceTailParams', bufferSet.tailParams[index]);\n  }\n\n  createTailPhaseArray(count) {\n    const array = new Float32Array(count);\n    for (let i = 0; i < count; i++) {\n      array[i] = Math.random() * Math.PI * 2;\n    }\n    return array;\n  }\n\n  applyTailPhaseSeeds(bufferSet, seeds) {\n    if (!bufferSet?.tailPhase) return;\n    for (const attr of bufferSet.tailPhase) {\n      attr.array.set(seeds);\n      attr.needsUpdate = true;\n    }\n  }\n\n  ensureTailRuntimeBuffers(count) {\n    const targetLength = count * 3;\n    if (!this.previousVelocities || this.previousVelocities.length !== targetLength) {\n      this.previousVelocities = new Float32Array(targetLength);\n    }\n  }\n\n  ensureLodFlagBuffer(count) {\n    if (count <= 0) {\n      this.previousLodFlags = null;\n      return null;\n    }\n    if (!this.previousLodFlags || this.previousLodFlags.length !== count) {\n      this.previousLodFlags = new Uint8Array(count);\n    }\n    return this.previousLodFlags;\n  }\n\n  ensureTailSeedCapacity(count) {\n    if (count <= 0) {\n      return;\n    }\n    const currentLength = this.tailPhaseSeeds ? this.tailPhaseSeeds.length : 0;\n    if (!this.tailPhaseSeeds || currentLength < count) {\n      const next = new Float32Array(count);\n      if (this.tailPhaseSeeds && currentLength > 0) {\n        next.set(this.tailPhaseSeeds.subarray(0, currentLength));\n      }\n      for (let i = currentLength; i < count; i++) {\n        next[i] = Math.random() * Math.PI * 2;\n      }\n      this.tailPhaseSeeds = next;\n    }\n  }\n\n  ensureBodyCoordAttribute(geometry) {\n    if (geometry.getAttribute('aBodyCoord')) return;\n    const position = geometry.getAttribute('position');\n    if (!position) return;\n\n    const count = position.count;\n    const array = position.array;\n    let minX = Infinity;\n    let minY = Infinity;\n    let minZ = Infinity;\n    let maxX = -Infinity;\n    let maxY = -Infinity;\n    let maxZ = -Infinity;\n\n    for (let i = 0; i < count; i++) {\n      const ix = i * 3;\n      const x = array[ix];\n      const y = array[ix + 1];\n      const z = array[ix + 2];\n      if (x < minX) minX = x;\n      if (x > maxX) maxX = x;\n      if (y < minY) minY = y;\n      if (y > maxY) maxY = y;\n      if (z < minZ) minZ = z;\n      if (z > maxZ) maxZ = z;\n    }\n\n    const rangeX = maxX - minX;\n    const rangeY = maxY - minY;\n    const rangeZ = maxZ - minZ;\n\n    let axis = 'z';\n    let min = minZ;\n    let range = rangeZ;\n    if (rangeX > rangeY && rangeX > rangeZ) {\n      axis = 'x';\n      min = minX;\n      range = rangeX;\n    } else if (rangeY > rangeZ) {\n      axis = 'y';\n      min = minY;\n      range = rangeY;\n    }\n\n    const bodyCoord = new Float32Array(count);\n    const denom = range > 0 ? range : 1;\n    for (let i = 0; i < count; i++) {\n      const ix = i * 3;\n      const value = axis === 'x' ? array[ix] : axis === 'y' ? array[ix + 1] : array[ix + 2];\n      bodyCoord[i] = (value - min) / denom;\n    }\n\n    //  0-1 \n    geometry.setAttribute('aBodyCoord', new THREE.BufferAttribute(bodyCoord, 1));\n  }\n\n  ensurePredatorMeshes(count) {\n    if (!this.scene || !this.predatorModel) return false;\n\n    const target = Math.max(0, count);\n    while (this.predatorMeshes.length > target) {\n      const mesh = this.predatorMeshes.pop();\n      if (mesh) {\n        this.scene.remove(mesh);\n      }\n    }\n\n    while (this.predatorMeshes.length < target) {\n      const clone = this.predatorModel.clone(true);\n      clone.traverse((child) => {\n        if (child.isMesh) {\n          child.castShadow = true;\n          child.receiveShadow = true;\n        }\n      });\n      clone.visible = false;\n      this.scene.add(clone);\n      this.predatorMeshes.push(clone);\n    }\n    return this.predatorMeshes.length === target;\n  }\n\n  dispose(scene = this.scene) {\n    if (this.instancedMeshHigh) {\n      scene?.remove(this.instancedMeshHigh);\n      this.instancedMeshHigh.geometry?.dispose?.();\n      this.instancedMeshHigh.material?.dispose?.();\n      this.instancedMeshHigh = null;\n    }\n    if (this.instancedMeshLow) {\n      scene?.remove(this.instancedMeshLow);\n      this.instancedMeshLow.geometry?.dispose?.();\n      this.instancedMeshLow.material?.dispose?.();\n      this.instancedMeshLow = null;\n    }\n    if (scene) {\n      for (const mesh of this.predatorMeshes) {\n        scene.remove(mesh);\n      }\n    }\n    this.instancingMaterials.clear();\n    this.bufferSetHigh = null;\n    this.bufferSetLow = null;\n    this.tailPhaseSeeds = null;\n    this.bufferCursor = 0;\n    this.previousVelocities = null;\n    this.previousLodFlags = null;\n    this.predatorMeshes = [];\n    this.predatorMeshCountCache = -1;\n    this.scene = scene ?? null;\n    this.count = 0;\n  }\n}\n","import * as THREE from 'three';\r\nimport { EffectComposer } from 'three/examples/jsm/postprocessing/EffectComposer.js';\r\nimport { RenderPass } from 'three/examples/jsm/postprocessing/RenderPass.js';\r\nimport { SSAOPass } from 'three/examples/jsm/postprocessing/SSAOPass.js';\r\nimport { UnrealBloomPass } from 'three/examples/jsm/postprocessing/UnrealBloomPass.js';\r\nimport { ShaderPass } from 'three/examples/jsm/postprocessing/ShaderPass.js';\r\n\r\n/**\r\n * \r\n * Three.js  EffectComposer \r\n * \r\n */\r\nexport class FogPipeline {\r\n  constructor(fogConfig) {\r\n    this.config = fogConfig;\r\n    this.composer = null;\r\n    this.heightFogPass = null;\r\n    this.heightFogRenderTarget = null;\r\n    this.renderer = null;\r\n    this.scene = null;\r\n    this.camera = null;\r\n  }\r\n\r\n  /** HeightFog  ShaderPass  */\r\n  get heightFog() {\r\n    return this.heightFogPass;\r\n  }\r\n\r\n  /**\r\n   * \r\n   *  +  HeightFogShader \r\n   */\r\n  init(renderer, scene, camera, width, height) {\r\n    if (!renderer || !scene || !camera) {\r\n      console.warn('FogPipeline.init: renderer / scene / camera ');\r\n      return;\r\n    }\r\n\r\n    this.dispose();\r\n\r\n    this.renderer = renderer;\r\n    this.scene = scene;\r\n    this.camera = camera;\r\n\r\n    // fog \r\n    const rtOptions = { depthBuffer: true, stencilBuffer: false };\r\n    this.heightFogRenderTarget = new THREE.WebGLRenderTarget(width, height, rtOptions);\r\n    this.heightFogRenderTarget.depthTexture = new THREE.DepthTexture(width, height, THREE.FloatType);\r\n    this.heightFogRenderTarget.depthTexture.format = THREE.DepthFormat;\r\n    this.heightFogRenderTarget.depthTexture.type = THREE.FloatType;\r\n    this.heightFogRenderTarget.depthTexture.needsUpdate = true;\r\n\r\n    this.composer = new EffectComposer(renderer, this.heightFogRenderTarget);\r\n\r\n    // \r\n    const renderPass = new RenderPass(scene, camera);\r\n    this.composer.addPass(renderPass);\r\n\r\n    //  SSAO\r\n    const ssaoPass = new SSAOPass(scene, camera, width, height);\r\n    ssaoPass.kernelRadius = 5;     //  AO\r\n    ssaoPass.minDistance = 0.01;   // \r\n    ssaoPass.maxDistance = 0.3;    // \r\n    this.composer.addPass(ssaoPass);\r\n\r\n    // \r\n    const bloomStrength = 1.0;   // \r\n    const bloomRadius = 0.25;     // \r\n    const bloomThreshold = 0.85; // \r\n    const bloomPass = new UnrealBloomPass(new THREE.Vector2(width, height), bloomStrength, bloomRadius, bloomThreshold);\r\n    this.composer.addPass(bloomPass);\r\n\r\n    const shader = createHeightFogShader(this.config);\r\n    this.heightFogPass = new ShaderPass(shader);\r\n    // \r\n    const originalRender = this.heightFogPass.render.bind(this.heightFogPass);\r\n    this.heightFogPass.render = (passRenderer, writeBuffer, readBuffer, deltaTime, maskActive) => {\r\n      if (this.heightFogPass.uniforms.tDepth) {\r\n        const depthTexture = readBuffer?.depthTexture ?? this.heightFogRenderTarget?.depthTexture ?? null;\r\n        if (depthTexture) {\r\n          this.heightFogPass.uniforms.tDepth.value = depthTexture;\r\n        }\r\n      }\r\n      originalRender(passRenderer, writeBuffer, readBuffer, deltaTime, maskActive);\r\n    };\r\n    this.heightFogPass.needsSwap = false;\r\n    this.heightFogPass.uniforms.tDepth.value = this.heightFogRenderTarget.depthTexture;\r\n\r\n    applyFogConfigToUniforms(this.heightFogPass.uniforms, this.config);\r\n\r\n    const material = this.heightFogPass.material;\r\n    if (material) {\r\n      material.depthTest = false;\r\n      material.depthWrite = false;\r\n      material.transparent = false;\r\n      material.blending = THREE.NoBlending;\r\n      material.toneMapped = true;\r\n      material.needsUpdate = true;\r\n    }\r\n\r\n    this.heightFogPass.renderToScreen = true;\r\n    this.composer.addPass(this.heightFogPass);\r\n  }\r\n\r\n  /**  */\r\n  resize(width, height) {\r\n    if (!this.composer) {\r\n      return;\r\n    }\r\n    this.composer.setSize(width, height);\r\n    this.heightFogRenderTarget?.setSize(width, height);\r\n  }\r\n\r\n  /** composer  */\r\n  render(delta) {\r\n    if (!this.composer) {\r\n      return;\r\n    }\r\n    this.composer.render(delta);\r\n  }\r\n\r\n  /** composer  */\r\n  isReady() {\r\n    return !!this.composer;\r\n  }\r\n\r\n  /**  */\r\n  updateCameraUniforms(camera) {\r\n    const pass = this.heightFogPass;\r\n    const targetCamera = camera || this.camera;\r\n    if (!pass || !targetCamera) {\r\n      return;\r\n    }\r\n    const { uniforms } = pass;\r\n    if (uniforms.cameraNear) {\r\n      uniforms.cameraNear.value = targetCamera.near;\r\n    }\r\n    if (uniforms.cameraFar) {\r\n      uniforms.cameraFar.value = targetCamera.far;\r\n    }\r\n    if (uniforms.projectionMatrixInverse?.value) {\r\n      uniforms.projectionMatrixInverse.value.copy(targetCamera.projectionMatrixInverse);\r\n    }\r\n    if (uniforms.cameraMatrixWorld?.value) {\r\n      uniforms.cameraMatrixWorld.value.copy(targetCamera.matrixWorld);\r\n    }\r\n  }\r\n\r\n  /**  */\r\n  updateConfig(nextConfig = {}) {\r\n    this.config = { ...this.config, ...nextConfig };\r\n    if (!this.heightFogPass) {\r\n      return;\r\n    }\r\n    applyFogConfigToUniforms(this.heightFogPass.uniforms, this.config);\r\n  }\r\n\r\n  /**  */\r\n  dispose() {\r\n    this.heightFogPass = null;\r\n    this.composer?.dispose?.();\r\n    this.composer = null;\r\n    this.heightFogRenderTarget?.dispose?.();\r\n    this.heightFogRenderTarget = null;\r\n    this.renderer = null;\r\n    this.scene = null;\r\n    this.camera = null;\r\n  }\r\n}\r\n\r\n/**\r\n * HeightFogShader \r\n */\r\nexport function createHeightFogShader(config = {}) {\r\n  const defaults = buildFogDefaults();\r\n  const finalConfig = { ...defaults, ...config };\r\n\r\n  return {\r\n    uniforms: {\r\n      tDiffuse: { value: null },\r\n      tDepth: { value: null },\r\n      cameraNear: { value: 0.1 },\r\n      cameraFar: { value: 1000 },\r\n      projectionMatrixInverse: { value: new THREE.Matrix4() },\r\n      cameraMatrixWorld: { value: new THREE.Matrix4() },\r\n      fogColor: { value: cloneColor(finalConfig.color) },                     // \r\n      distanceStart: { value: finalConfig.distanceStart },                   // \r\n      distanceEnd: { value: finalConfig.distanceEnd },                       // \r\n      distanceExponent: { value: finalConfig.distanceExponent },             // \r\n      distanceControlPoint1: { value: cloneVector2(finalConfig.distanceControlPoint1) }, // 1\r\n      distanceControlPoint2: { value: cloneVector2(finalConfig.distanceControlPoint2) }, // 2\r\n      surfaceLevel: { value: finalConfig.surfaceLevel },                     // y\r\n      heightFalloff: { value: finalConfig.heightFalloff },                   // \r\n      heightExponent: { value: finalConfig.heightExponent },                 // \r\n      maxOpacity: { value: finalConfig.maxOpacity },                         // \r\n    },\r\n    vertexShader: /* glsl */`\r\n    varying vec2 vUv;\r\n    void main() {\r\n      vUv = uv;\r\n      gl_Position = vec4(position.xy, 0.0, 1.0);\r\n    }\r\n  `,\r\n    fragmentShader: /* glsl */`\r\n    precision highp float;\r\n    varying vec2 vUv;\r\n\r\n    uniform sampler2D tDiffuse;\r\n    uniform sampler2D tDepth;\r\n    uniform float cameraNear;\r\n    uniform float cameraFar;\r\n    uniform vec3 fogColor;\r\n    uniform float distanceStart;\r\n    uniform float distanceEnd;\r\n    uniform float distanceExponent;\r\n    uniform vec2 distanceControlPoint1;\r\n    uniform vec2 distanceControlPoint2;\r\n    uniform float surfaceLevel;\r\n    uniform float heightFalloff;\r\n    uniform float heightExponent;\r\n    uniform float maxOpacity;\r\n    uniform mat4 projectionMatrixInverse;\r\n    uniform mat4 cameraMatrixWorld;\r\n\r\n    float cubicBezier1D(float t, float p0, float p1, float p2, float p3) {\r\n      float u = 1.0 - t;\r\n      float uu = u * u;\r\n      float tt = t * t;\r\n      return u * uu * p0 + 3.0 * uu * t * p1 + 3.0 * u * tt * p2 + tt * t * p3;\r\n    }\r\n\r\n    float cubicBezierDerivative1D(float t, float p0, float p1, float p2, float p3) {\r\n      float u = 1.0 - t;\r\n      return 3.0 * u * u * (p1 - p0)\r\n           + 6.0 * u * t * (p2 - p1)\r\n           + 3.0 * t * t * (p3 - p2);\r\n    }\r\n\r\n    float cubicBezierInverse(float x, vec2 c1, vec2 c2) {\r\n      float t = clamp(x, 0.0, 1.0);\r\n      for (int i = 0; i < 5; i++) {\r\n        float current = cubicBezier1D(t, 0.0, c1.x, c2.x, 1.0) - x;\r\n        float slope = cubicBezierDerivative1D(t, 0.0, c1.x, c2.x, 1.0);\r\n        if (abs(slope) < 1e-5) {\r\n          break;\r\n        }\r\n        t -= current / slope;\r\n        t = clamp(t, 0.0, 1.0);\r\n      }\r\n      return t;\r\n    }\r\n\r\n    float sampleDistanceCurve(float x, vec2 c1, vec2 c2) {\r\n      float t = cubicBezierInverse(x, c1, c2);\r\n      return cubicBezier1D(t, 0.0, c1.y, c2.y, 1.0);\r\n    }\r\n\r\n    void main() {\r\n      vec4 baseColor = texture2D(tDiffuse, vUv);\r\n      float depth = texture2D(tDepth, vUv).x;\r\n\r\n      if (depth >= 1.0) {\r\n        gl_FragColor = baseColor;\r\n        return;\r\n      }\r\n\r\n      vec2 ndc = vUv * 2.0 - 1.0;\r\n      float ndcZ = depth * 2.0 - 1.0;\r\n      vec4 clipPos = vec4(ndc, ndcZ, 1.0);\r\n      vec4 viewPos = projectionMatrixInverse * clipPos;\r\n      viewPos /= max(viewPos.w, 1e-5);\r\n      vec4 worldPos = cameraMatrixWorld * viewPos;\r\n\r\n      float viewDistance = length(viewPos.xyz);\r\n      float distanceFogNorm = clamp(\r\n        (viewDistance - distanceStart) / max(distanceEnd - distanceStart, 1e-5),\r\n        0.0,\r\n        1.0\r\n      );\r\n      float distanceFog = sampleDistanceCurve(distanceFogNorm, distanceControlPoint1, distanceControlPoint2);\r\n      distanceFog = pow(distanceFog, distanceExponent);\r\n\r\n      float depthBelowSurface = max(surfaceLevel - worldPos.y, 0.0);\r\n      float heightFactor = 1.0 - exp(-depthBelowSurface * heightFalloff);\r\n      heightFactor = clamp(pow(heightFactor, heightExponent), 0.0, 1.0);\r\n\r\n      float fogFactor = clamp(distanceFog * heightFactor, 0.0, 1.0);\r\n      fogFactor = mix(0.0, maxOpacity, fogFactor);\r\n\r\n      vec3 fogged = mix(baseColor.rgb, fogColor, fogFactor);\r\n      gl_FragColor = vec4(fogged, baseColor.a);\r\n      #include <tonemapping_fragment>\r\n      #include <colorspace_fragment>\r\n    }\r\n  `,\r\n  };\r\n}\r\n\r\nexport const HeightFogShader = createHeightFogShader();\r\n\r\nfunction buildFogDefaults() {\r\n  return {\r\n    color: new THREE.Color('#153a6c'),                // \r\n    distanceStart: 4,                                 // \r\n    distanceEnd: 60,                                  // \r\n    distanceExponent: 0.4,                            // \r\n    distanceControlPoint1: new THREE.Vector2(0.4, 0.75), // \r\n    distanceControlPoint2: new THREE.Vector2(0.75, 0.95), // \r\n    surfaceLevel: 100,                                //  World Y \r\n    heightFalloff: 0.01,                              // \r\n    heightExponent: 1,                                // \r\n    maxOpacity: 1,                                    // \r\n  };\r\n}\r\n\r\nfunction cloneColor(value) {\r\n  if (value instanceof THREE.Color) {\r\n    return value.clone();\r\n  }\r\n  if (typeof value === 'string' || typeof value === 'number') {\r\n    return new THREE.Color(value);\r\n  }\r\n  return new THREE.Color('#000000');\r\n}\r\n\r\nfunction cloneVector2(value) {\r\n  if (value instanceof THREE.Vector2) {\r\n    return value.clone();\r\n  }\r\n  if (value && typeof value.x === 'number' && typeof value.y === 'number') {\r\n    return new THREE.Vector2(value.x, value.y);\r\n  }\r\n  return new THREE.Vector2();\r\n}\r\n\r\nfunction applyFogConfigToUniforms(uniforms, config = {}) {\r\n  const defaults = buildFogDefaults();\r\n  const finalConfig = { ...defaults, ...config };\r\n\r\n  if (uniforms.fogColor?.value) {\r\n    uniforms.fogColor.value.copy(cloneColor(finalConfig.color));\r\n  }\r\n  if (uniforms.distanceStart) {\r\n    uniforms.distanceStart.value = finalConfig.distanceStart;\r\n  }\r\n  if (uniforms.distanceEnd) {\r\n    uniforms.distanceEnd.value = finalConfig.distanceEnd;\r\n  }\r\n  if (uniforms.distanceExponent) {\r\n    uniforms.distanceExponent.value = finalConfig.distanceExponent;\r\n  }\r\n  if (uniforms.distanceControlPoint1?.value) {\r\n    uniforms.distanceControlPoint1.value.copy(cloneVector2(finalConfig.distanceControlPoint1));\r\n  }\r\n  if (uniforms.distanceControlPoint2?.value) {\r\n    uniforms.distanceControlPoint2.value.copy(cloneVector2(finalConfig.distanceControlPoint2));\r\n  }\r\n  if (uniforms.surfaceLevel) {\r\n    uniforms.surfaceLevel.value = finalConfig.surfaceLevel;\r\n  }\r\n  if (uniforms.heightFalloff) {\r\n    uniforms.heightFalloff.value = finalConfig.heightFalloff;\r\n  }\r\n  if (uniforms.heightExponent) {\r\n    uniforms.heightExponent.value = finalConfig.heightExponent;\r\n  }\r\n  if (uniforms.maxOpacity) {\r\n    uniforms.maxOpacity.value = finalConfig.maxOpacity;\r\n  }\r\n}\r\n","import * as THREE from 'three';\r\n\r\n// XYZ: \r\nconst PARTICLE_BASE_SPREAD_DESKTOP = new THREE.Vector3(24, 12, 26);\r\nconst PARTICLE_BASE_SPREAD_MOBILE = new THREE.Vector3(16, 9, 18);\r\n// : \r\nconst PARTICLE_BASE_MAX_DISTANCE_DESKTOP = PARTICLE_BASE_SPREAD_DESKTOP.z * 1.2;\r\nconst PARTICLE_BASE_MAX_DISTANCE_MOBILE = PARTICLE_BASE_SPREAD_MOBILE.z * 1.2;\r\n// \r\nconst FLOW_TILT_DEGREES = 30; // 30\r\nconst DEFAULT_FLOW_DIR = new THREE.Vector3(\r\n  Math.cos(THREE.MathUtils.degToRad(FLOW_TILT_DEGREES)),\r\n  -Math.sin(THREE.MathUtils.degToRad(FLOW_TILT_DEGREES)),\r\n  0\r\n);\r\nconst DEFAULT_LAT1 = new THREE.Vector3(0, 0, 1);\r\nconst DEFAULT_LAT2 = new THREE.Vector3(0, 1, 0);\r\n\r\n//  new \r\nconst TEMP_DIR = new THREE.Vector3();\r\nconst TEMP_AXIS = new THREE.Vector3();\r\nconst TEMP_LAT1 = new THREE.Vector3();\r\nconst TEMP_LAT2 = new THREE.Vector3();\r\n\r\n/**\r\n * \r\n * App.vue  init/update/dispose  Three.js  Points \r\n */\r\nexport class ParticleField {\r\n  constructor(isMobileDevice) {\r\n    this.isMobileDevice = Boolean(isMobileDevice);\r\n    this.scene = null;\r\n    this.renderer = null;\r\n    this.camera = null;\r\n    this.controls = null;\r\n\r\n    this.particlePoints = null;\r\n    this.particleMaterial = null;\r\n    this.elapsedTime = 0;\r\n  }\r\n\r\n  /**\r\n   * Three.js \r\n   */\r\n  init(scene, renderer, camera, controls) {\r\n    if (!scene || !renderer?.capabilities?.isWebGL2) {\r\n      console.warn('Skipping particle system: WebGL2 required.');\r\n      return false;\r\n    }\r\n\r\n    this.dispose(scene);\r\n\r\n    this.scene = scene;\r\n    this.renderer = renderer;\r\n    this.camera = camera;\r\n    this.controls = controls;\r\n    this.elapsedTime = 0;\r\n\r\n    const count = this.isMobileDevice ? 800 : 2000; // \r\n    const geometry = new THREE.BufferGeometry();\r\n    geometry.setAttribute('position', new THREE.BufferAttribute(new Float32Array(count * 3), 3));\r\n    geometry.setDrawRange(0, count);\r\n\r\n    const baseSpread = (this.isMobileDevice ? PARTICLE_BASE_SPREAD_MOBILE : PARTICLE_BASE_SPREAD_DESKTOP).clone();\r\n    const baseMaxDistance = this.isMobileDevice ? PARTICLE_BASE_MAX_DISTANCE_MOBILE : PARTICLE_BASE_MAX_DISTANCE_DESKTOP;\r\n\r\n    const material = new THREE.ShaderMaterial({\r\n      glslVersion: THREE.GLSL3,\r\n      transparent: true,\r\n      depthWrite: false,\r\n      depthTest: true,\r\n      blending: THREE.AdditiveBlending,\r\n      uniforms: {\r\n        uTime: { value: 0 }, // CPU\r\n        uOrigin: { value: new THREE.Vector3() }, // \r\n        uFlowDir: { value: DEFAULT_FLOW_DIR.clone() }, // \r\n        uLat1: { value: DEFAULT_LAT1.clone() }, // 1\r\n        uLat2: { value: DEFAULT_LAT2.clone() }, // 2\r\n        uSpread: { value: baseSpread.clone() }, // XYZ \r\n        uMaxDistance: { value: baseMaxDistance }, // \r\n        uBaseSpeed: { value: 0.6 }, // \r\n        uJitterAmp: { value: 0.22 }, // \r\n        uSizePx: { value: this.isMobileDevice ? 5.0 : 12.0 }, // px\r\n        uFadeNear: { value: 1.5 }, // \r\n        uFadeFar: { value: 14.0 }, // \r\n        uColorNear: { value: new THREE.Color(0x72a1c4) }, // \r\n        uColorFar: { value: new THREE.Color(0x0a5270) }, // \r\n      },\r\n      vertexShader: PARTICLE_VERTEX_SHADER,\r\n      fragmentShader: PARTICLE_FRAGMENT_SHADER,\r\n    });\r\n\r\n    const baseTargetDistance = controls\r\n      ? camera.position.distanceTo(controls.target)\r\n      : camera.position.length();\r\n    material.userData = {\r\n      baseSpread: baseSpread.clone(),\r\n      baseMaxDistance,\r\n      baseTargetDistance: Math.max(baseTargetDistance, 0.1), // OrbitControls \r\n    };\r\n\r\n    this.particlePoints = new THREE.Points(geometry, material);\r\n    this.particlePoints.frustumCulled = false;\r\n    this.particlePoints.renderOrder = 2;\r\n    scene.add(this.particlePoints);\r\n\r\n    this.particleMaterial = material;\r\n    this.setWorldBasis(material.uniforms.uFlowDir.value);\r\n    this.update(camera, controls);\r\n    return true;\r\n  }\r\n\r\n  /**\r\n   * uTime \r\n   */\r\n  setTime(timeSeconds) {\r\n    this.elapsedTime = timeSeconds ?? this.elapsedTime;\r\n    if (this.particleMaterial?.uniforms?.uTime) {\r\n      this.particleMaterial.uniforms.uTime.value = this.elapsedTime;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * \r\n   */\r\n  advanceTime(deltaSeconds) {\r\n    if (!Number.isFinite(deltaSeconds) || deltaSeconds === 0) {\r\n      return;\r\n    }\r\n    this.elapsedTime += deltaSeconds;\r\n    if (this.particleMaterial?.uniforms?.uTime) {\r\n      this.particleMaterial.uniforms.uTime.value = this.elapsedTime;\r\n    }\r\n  }\r\n\r\n  /**\r\n   * uniform \r\n   */\r\n  setWorldBasis(flowDir) {\r\n    if (!this.particleMaterial || !flowDir) {\r\n      return;\r\n    }\r\n\r\n    const dir = TEMP_DIR.copy(flowDir).normalize();\r\n    //  cross \r\n    const axis = Math.abs(dir.y) < 0.99\r\n      ? TEMP_AXIS.set(0, 1, 0)\r\n      : TEMP_AXIS.set(1, 0, 0);\r\n\r\n    const lat1 = TEMP_LAT1.copy(dir).cross(axis);\r\n    if (lat1.lengthSq() < 1e-6) {\r\n      lat1.set(0, 0, 1);\r\n      lat1.cross(dir);\r\n    }\r\n    lat1.normalize();\r\n\r\n    const lat2 = TEMP_LAT2.copy(dir).cross(lat1).normalize();\r\n\r\n    const uniforms = this.particleMaterial.uniforms;\r\n    uniforms.uFlowDir.value.copy(dir);\r\n    uniforms.uLat1.value.copy(lat1);\r\n    uniforms.uLat2.value.copy(lat2);\r\n  }\r\n\r\n  /**\r\n   *  uniform \r\n   */\r\n  update(camera, controls) {\r\n    const targetCamera = camera || this.camera;\r\n    if (!this.particleMaterial || !targetCamera) {\r\n      return;\r\n    }\r\n\r\n    const uniforms = this.particleMaterial.uniforms;\r\n    uniforms.uOrigin.value.copy(targetCamera.position);\r\n\r\n    const { baseSpread, baseMaxDistance, baseTargetDistance } = this.particleMaterial.userData || {};\r\n    if (!baseSpread || !baseMaxDistance) {\r\n      return;\r\n    }\r\n\r\n    // \r\n    uniforms.uSpread.value.copy(baseSpread);\r\n    uniforms.uMaxDistance.value = baseMaxDistance;\r\n  }\r\n\r\n  /**\r\n   * GPU\r\n   */\r\n  dispose(scene) {\r\n    const targetScene = scene || this.scene;\r\n    if (this.particlePoints && targetScene) {\r\n      targetScene.remove(this.particlePoints);\r\n    }\r\n    this.particlePoints?.geometry?.dispose();\r\n    this.particlePoints?.material?.dispose();\r\n\r\n    this.particlePoints = null;\r\n    this.particleMaterial = null;\r\n    this.scene = null;\r\n    this.renderer = null;\r\n    this.camera = null;\r\n    this.controls = null;\r\n  }\r\n\r\n  /**  */\r\n  getMaterial() {\r\n    return this.particleMaterial;\r\n  }\r\n}\r\n\r\nconst PARTICLE_VERTEX_SHADER = /* glsl */`\r\nprecision highp float;\r\nprecision highp int;\r\n\r\nuniform float uTime;\r\nuniform vec3 uOrigin;\r\nuniform vec3 uFlowDir;\r\nuniform vec3 uLat1;\r\nuniform vec3 uLat2;\r\nuniform vec3 uSpread;\r\nuniform float uMaxDistance;\r\nuniform float uBaseSpeed;\r\nuniform float uJitterAmp;\r\nuniform float uSizePx;\r\nuniform float uFadeNear;\r\nuniform float uFadeFar;\r\n\r\nout float vFade;\r\nout float vColorMix;\r\n\r\nuint hashUint(uint n) {\r\n  n ^= (n << 13);\r\n  n ^= (n >> 17);\r\n  n ^= (n << 5);\r\n  return n * 0x27d4eb2du;\r\n}\r\n\r\nfloat hashFloat(uint n) {\r\n  return float(hashUint(n)) / 4294967296.0;\r\n}\r\n\r\nvec3 hashVec3(uint n) {\r\n  return vec3(\r\n    hashFloat(n),\r\n    hashFloat(n * 1664525u + 1013904223u),\r\n    hashFloat(n * 22695477u + 1u)\r\n  );\r\n}\r\n\r\nvoid main() {\r\n  uint id = uint(gl_VertexID);\r\n  vec3 randSeed = hashVec3(id) - 0.5;\r\n\r\n  vec3 flowDir = normalize(uFlowDir);\r\n  vec3 lateral = uLat1 * (randSeed.x * uSpread.x)\r\n    + uLat2 * (randSeed.y * uSpread.y);\r\n\r\n  float speedSeed = hashFloat(id * 747796405u);\r\n  float speed = uBaseSpeed * (0.7 + 0.6 * speedSeed);\r\n  float flowCycle = max(uSpread.z, 1e-3);\r\n  float flowParam = randSeed.z + (uTime * speed) / flowCycle;\r\n  float wrappedZ = fract(flowParam) - 0.5;\r\n  vec3 pos = uOrigin + lateral + flowDir * (wrappedZ * flowCycle);\r\n\r\n  float phase = hashFloat(id * 1664525u) * 6.28318530718;\r\n  float driftSeed = hashFloat(id * 22695477u);\r\n  float triangle = 1.0 - abs(fract((phase + uTime * (0.8 + 0.4 * driftSeed)) / 3.14159265) * 2.0 - 1.0);\r\n\r\n  vec3 jitter1 = normalize(uLat1);\r\n  vec3 jitter2 = normalize(uLat2);\r\n  pos += jitter1 * ((triangle - 0.5) * uJitterAmp);\r\n  pos += jitter2 * ((hashFloat(id * 1103515245u) - 0.5) * uJitterAmp * 0.6);\r\n\r\n  vec4 mvPosition = modelViewMatrix * vec4(pos, 1.0);\r\n  float dist = -mvPosition.z;\r\n  float forwardMask = step(0.0, dist);\r\n\r\n  vec4 clipPosition = projectionMatrix * mvPosition;\r\n  float invW = 1.0 / max(abs(clipPosition.w), 1e-3);\r\n  vec2 ndc = clipPosition.xy * invW;\r\n\r\n  float screenMask = 1.0 - smoothstep(0.96, 1.16, max(abs(ndc.x), abs(ndc.y)));\r\n  float rangeMask = 1.0 - smoothstep(uMaxDistance * 0.7, uMaxDistance, dist);\r\n\r\n  float fadeT = clamp((dist - uFadeNear) / max(uFadeFar - uFadeNear, 1e-3), 0.0, 1.0);\r\n  float fade = (1.0 - fadeT) * screenMask * rangeMask * forwardMask;\r\n  vFade = fade;\r\n  vColorMix = fade;\r\n\r\n  float sizeBase = uSizePx * projectionMatrix[1][1] / max(dist, 1e-3);\r\n  float attenuatedSize = sizeBase * fade;\r\n  gl_PointSize = max(attenuatedSize, 0.75) * step(0.001, fade);\r\n  gl_Position = clipPosition;\r\n}\r\n`;\r\n\r\nconst PARTICLE_FRAGMENT_SHADER = /* glsl */`\r\nprecision highp float;\r\n\r\nin float vFade;\r\nin float vColorMix;\r\n\r\nuniform vec3 uColorNear;\r\nuniform vec3 uColorFar;\r\n\r\nout vec4 fragColor;\r\n\r\nvoid main() {\r\n  vec2 coord = gl_PointCoord - vec2(0.5);\r\n  float falloff = exp(-8.0 * dot(coord, coord));\r\n  float alpha = vFade * falloff * 0.6;\r\n  if (alpha < 0.004) {\r\n    discard;\r\n  }\r\n  vec3 color = mix(uColorFar, uColorNear, vColorMix);\r\n  fragColor = vec4(color, alpha);\r\n}\r\n`;\r\n","/**\r\n * WASM \r\n * Vue  wasm \r\n * DataView  GC \r\n */\r\nexport class WasmtimeBridge {\r\n  constructor(wasmModule) {\r\n    if (!wasmModule) {\r\n      throw new Error('WasmtimeBridge: wasmModule ');\r\n    }\r\n\r\n    this.wasm = wasmModule;\r\n    this.latestStatePtr = 0;\r\n    this.latestStateHeaderPtr = 0;\r\n    this.latestStateHeaderView = null;\r\n    this.latestPositionsPtr = 0;\r\n    this.latestVelocitiesPtr = 0;\r\n    this.latestOrientationsPtr = 0;\r\n    this.latestBoidCount = 0;\r\n\r\n    this.cachedHeapBuffer = null;\r\n    this.cachedPositionsPtr = 0;\r\n    this.cachedOrientationsPtr = 0;\r\n    this.cachedVelocitiesPtr = 0;\r\n    this.cachedSpeciesIdsPtr = 0;\r\n    this.cachedPositionsView = null;\r\n    this.cachedOrientationsView = null;\r\n    this.cachedVelocitiesView = null;\r\n    this.cachedSpeciesIdsView = null;\r\n    this.cachedPositionsCount = 0;\r\n    this.cachedOrientationsCount = 0;\r\n    this.cachedVelocitiesCount = 0;\r\n    this.cachedSpeciesIdsCount = 0;\r\n    this.cachedSpeciesIdsBuffer = null;\r\n\r\n    // cwrap  wasm \r\n    this.stepSimulationHandle = this.createWrappedFunction('stepSimulation', 'number', ['number']);\r\n    this.buildHandle = this.createWrappedFunction('build', 'void', ['number', 'number']);\r\n    this.exportTreeStructureHandle = this.createWrappedFunction('exportTreeStructure', 'object', []);\r\n    this.boidUnitMappingPtrHandle = this.createWrappedFunction('boidUnitMappingPtr', 'number', []);\r\n    this.currentFirstBoidXHandle = this.createWrappedFunction('currentFirstBoidX', 'number', []);\r\n    this.speciesIdsPtrHandle = this.createWrappedFunction('speciesIdsPtr', 'number', []);\r\n    this.syncReadToWriteBuffersHandle = this.createWrappedFunction('syncReadToWriteBuffers', 'void', []);\r\n    this.getSimulationTuningParamsHandle = this.createWrappedFunction('getSimulationTuningParams', 'object', []);\r\n    this.setSimulationTuningParamsHandle = this.createWrappedFunction('setSimulationTuningParams', 'void', ['object']);\r\n  }\r\n\r\n  getSimulationTuningParams() {\r\n    if (!this.wasm) {\r\n      return null;\r\n    }\r\n    const handle = this.ensureHandle(this.getSimulationTuningParamsHandle, 'getSimulationTuningParams');\r\n    return handle ? handle() : null;\r\n  }\r\n\r\n  setSimulationTuningParams(params) {\r\n    if (!this.wasm) {\r\n      return;\r\n    }\r\n    const handle = this.ensureHandle(this.setSimulationTuningParamsHandle, 'setSimulationTuningParams');\r\n    if (!handle || !params) {\r\n      return;\r\n    }\r\n    const toNumber = (value, fallback) => {\r\n      const num = Number(value);\r\n      return Number.isFinite(num) ? num : fallback;\r\n    };\r\n    handle({\r\n      threatDecay: toNumber(params.threatDecay, 0.5),\r\n      threatGain: toNumber(params.threatGain, 2.0),\r\n      maxEscapeWeight: toNumber(params.maxEscapeWeight, 1.0),\r\n      baseEscapeStrength: toNumber(params.baseEscapeStrength, 3.0),\r\n      escapeStrengthPerThreat: toNumber(params.escapeStrengthPerThreat, 10.0),\r\n      cohesionBoost: toNumber(params.cohesionBoost, 2.0),\r\n      separationMinFactor: toNumber(params.separationMinFactor, 1.0),\r\n      alignmentBoost: toNumber(params.alignmentBoost, 1.2),\r\n    });\r\n  }\r\n\r\n  /**\r\n   *  wasm \r\n   * App.vue::createSpeciesParamsVector \r\n   */\r\n  buildSpeciesParams(settings) {\r\n    if (!Array.isArray(settings)) {\r\n      return null;\r\n    }\r\n\r\n    // wasm  VectorSpeciesParams  push\r\n    const vector = new this.wasm.VectorSpeciesParams();\r\n    settings.forEach((raw, index) => {\r\n      if (!raw) {\r\n        return;\r\n      }\r\n\r\n      const toNumber = (value, fallback = 0) => {\r\n        const num = Number(value);\r\n        return Number.isFinite(num) ? num : fallback;\r\n      };\r\n\r\n      vector.push_back({\r\n        species: typeof raw.species === 'string' ? raw.species : `Species ${index + 1}`,\r\n        count: Math.max(0, Math.floor(toNumber(raw.count, 0))),\r\n        speciesId: Math.max(0, Math.floor(toNumber(raw.speciesId, index))),\r\n        cohesion: toNumber(raw.cohesion, 0),\r\n        separation: toNumber(raw.separation, 0),\r\n        alignment: toNumber(raw.alignment, 0),\r\n        maxSpeed: toNumber(raw.maxSpeed, 1),\r\n        minSpeed: toNumber(raw.minSpeed, 0),\r\n        maxTurnAngle: toNumber(raw.maxTurnAngle, 0),\r\n        separationRange: toNumber(raw.separationRange, 0),\r\n        alignmentRange: toNumber(raw.alignmentRange, 0),\r\n        cohesionRange: toNumber(raw.cohesionRange, 0),\r\n        maxNeighbors: Math.max(0, Math.floor(toNumber(raw.maxNeighbors, 0))),\r\n        lambda: toNumber(raw.lambda, 0),\r\n        tau: toNumber(raw.tau, 0),\r\n        horizontalTorque: toNumber(raw.horizontalTorque, 0),\r\n        velocityEpsilon: toNumber(raw.velocityEpsilon, 0.0001),\r\n        torqueStrength: toNumber(raw.torqueStrength, 0),\r\n        // \r\n        bodyHeadLength: toNumber(raw.bodyHeadLength, -0.15),\r\n        bodyTailLength: toNumber(raw.bodyTailLength, 0.33),\r\n        bodyRadius: toNumber(raw.bodyRadius, 0.035),\r\n        predatorAlertRadius: toNumber(raw.predatorAlertRadius, 1.0),\r\n        isPredator: Boolean(raw.isPredator),\r\n      });\r\n    });\r\n    return vector;\r\n  }\r\n\r\n  /**\r\n   *  1 \r\n   * App.vue::stepSimulationAndUpdateState \r\n   */\r\n  stepSimulation(deltaTime) {\r\n    const handle = this.ensureHandle(this.stepSimulationHandle, 'stepSimulation');\r\n\r\n    const { wasm } = this;\r\n    const dt = Number.isFinite(deltaTime) ? deltaTime : 0;\r\n    const statePtr = handle(dt);\r\n    if (!statePtr) {\r\n      this.latestStatePtr = 0;\r\n      this.latestStateHeaderPtr = 0;\r\n      this.latestPositionsPtr = 0;\r\n      this.latestVelocitiesPtr = 0;\r\n      this.latestOrientationsPtr = 0;\r\n      this.latestStateHeaderView = null;\r\n      this.latestBoidCount = 0;\r\n      return 0;\r\n    }\r\n\r\n    const heapU8Buffer = wasm.HEAPU8.buffer;\r\n    if (\r\n      !this.latestStateHeaderView ||\r\n      this.latestStateHeaderPtr !== statePtr ||\r\n      this.latestStateHeaderView.buffer !== heapU8Buffer\r\n    ) {\r\n      this.latestStateHeaderView = new DataView(heapU8Buffer, statePtr, 16);\r\n      this.latestStateHeaderPtr = statePtr;\r\n    }\r\n\r\n    this.latestStatePtr = statePtr;\r\n    this.latestPositionsPtr = this.latestStateHeaderView.getUint32(0, true);\r\n    this.latestVelocitiesPtr = this.latestStateHeaderView.getUint32(4, true);\r\n    this.latestOrientationsPtr = this.latestStateHeaderView.getUint32(8, true);\r\n    this.latestBoidCount = this.latestStateHeaderView.getInt32(12, true);\r\n\r\n    return this.latestBoidCount;\r\n  }\r\n\r\n  /**\r\n   * wasm  positions / orientations \r\n   * buffer  TypedArray \r\n   */\r\n  getBuffers(count) {\r\n    if (!this.wasm) {\r\n      return {\r\n        positions: new Float32Array(0),\r\n        orientations: new Float32Array(0),\r\n        velocities: new Float32Array(0),\r\n        speciesIds: new Int32Array(0),\r\n      };\r\n    }\r\n\r\n    const heapBuffer = this.wasm.HEAPF32.buffer;\r\n    const heapBufferI32 = this.wasm.HEAP32.buffer;\r\n\r\n    if (this.cachedHeapBuffer !== heapBuffer || this.cachedSpeciesIdsBuffer !== heapBufferI32) {\r\n      this.cachedHeapBuffer = heapBuffer;\r\n      this.cachedSpeciesIdsBuffer = heapBufferI32;\r\n      this.cachedPositionsPtr = 0;\r\n      this.cachedOrientationsPtr = 0;\r\n      this.cachedVelocitiesPtr = 0;\r\n      this.cachedSpeciesIdsPtr = 0;\r\n      this.cachedPositionsView = null;\r\n      this.cachedOrientationsView = null;\r\n      this.cachedVelocitiesView = null;\r\n      this.cachedSpeciesIdsView = null;\r\n      this.cachedPositionsCount = 0;\r\n      this.cachedOrientationsCount = 0;\r\n      this.cachedVelocitiesCount = 0;\r\n      this.cachedSpeciesIdsCount = 0;\r\n    }\r\n\r\n    if (!this.latestPositionsPtr || !this.latestOrientationsPtr || !this.latestVelocitiesPtr || count <= 0) {\r\n      return {\r\n        positions: this.cachedPositionsView ?? new Float32Array(0),\r\n        orientations: this.cachedOrientationsView ?? new Float32Array(0),\r\n        velocities: this.cachedVelocitiesView ?? new Float32Array(0),\r\n        speciesIds: this.cachedSpeciesIdsView ?? new Int32Array(0),\r\n      };\r\n    }\r\n\r\n    if (\r\n      this.cachedPositionsView === null ||\r\n      this.cachedPositionsCount !== count ||\r\n      this.cachedPositionsPtr !== this.latestPositionsPtr\r\n    ) {\r\n      this.cachedPositionsPtr = this.latestPositionsPtr;\r\n      this.cachedPositionsView = new Float32Array(heapBuffer, this.cachedPositionsPtr, count * 3);\r\n      this.cachedPositionsCount = count;\r\n    }\r\n\r\n    if (\r\n      this.cachedOrientationsView === null ||\r\n      this.cachedOrientationsCount !== count ||\r\n      this.cachedOrientationsPtr !== this.latestOrientationsPtr\r\n    ) {\r\n      this.cachedOrientationsPtr = this.latestOrientationsPtr;\r\n      this.cachedOrientationsView = new Float32Array(heapBuffer, this.cachedOrientationsPtr, count * 4);\r\n      this.cachedOrientationsCount = count;\r\n    }\r\n\r\n    if (\r\n      this.cachedVelocitiesView === null ||\r\n      this.cachedVelocitiesCount !== count ||\r\n      this.cachedVelocitiesPtr !== this.latestVelocitiesPtr\r\n    ) {\r\n      this.cachedVelocitiesPtr = this.latestVelocitiesPtr;\r\n      this.cachedVelocitiesView = new Float32Array(heapBuffer, this.cachedVelocitiesPtr, count * 3);\r\n      this.cachedVelocitiesCount = count;\r\n    }\r\n\r\n    const speciesPtr = typeof this.speciesIdsPtrHandle === 'function' ? this.speciesIdsPtrHandle() : 0;\r\n    if (\r\n      speciesPtr && (\r\n        this.cachedSpeciesIdsView === null ||\r\n        this.cachedSpeciesIdsPtr !== speciesPtr ||\r\n        this.cachedSpeciesIdsCount !== count ||\r\n        this.cachedSpeciesIdsBuffer !== heapBufferI32\r\n      )\r\n    ) {\r\n      this.cachedSpeciesIdsPtr = speciesPtr;\r\n      this.cachedSpeciesIdsCount = count;\r\n      this.cachedSpeciesIdsBuffer = heapBufferI32;\r\n      this.cachedSpeciesIdsView = new Int32Array(heapBufferI32, speciesPtr, count);\r\n    }\r\n\r\n    return {\r\n      positions: this.cachedPositionsView,\r\n      orientations: this.cachedOrientationsView,\r\n      velocities: this.cachedVelocitiesView,\r\n      speciesIds: this.cachedSpeciesIdsView,\r\n    };\r\n  }\r\n\r\n  /** wasm  triple buffer  */\r\n  captureState() {\r\n    if (!this.wasm) {\r\n      return null;\r\n    }\r\n\r\n    const currentCount = this.stepSimulation(0);\r\n    if (!currentCount || currentCount <= 0) {\r\n      return { count: 0 };\r\n    }\r\n\r\n    const { positions, velocities, orientations, speciesIds } = this.getBuffers(currentCount);\r\n\r\n    return {\r\n      count: currentCount,\r\n      positions: positions ? new Float32Array(positions) : null,\r\n      velocities: velocities ? new Float32Array(velocities) : null,\r\n      orientations: orientations ? new Float32Array(orientations) : null,\r\n      speciesIds: speciesIds ? new Int32Array(speciesIds) : null,\r\n    };\r\n  }\r\n\r\n  /** restoreFlockState  */\r\n  /**  */\r\n  restoreState(previousState, oldSettings, newSettings) {\r\n    if (!previousState || previousState.count <= 0) {\r\n      return;\r\n    }\r\n\r\n    const currentCount = this.stepSimulation(0);\r\n    if (!currentCount || currentCount <= 0) {\r\n      return;\r\n    }\r\n\r\n    const { positions, velocities, orientations } = this.getBuffers(currentCount);\r\n    if (!positions || !velocities || !orientations) {\r\n      return;\r\n    }\r\n\r\n    const prevPositions = previousState.positions;\r\n    const prevVelocities = previousState.velocities;\r\n    const prevOrientations = previousState.orientations;\r\n\r\n    const oldRanges = buildSpeciesRanges(oldSettings);\r\n    const newRanges = buildSpeciesRanges(newSettings);\r\n    const oldRangeMap = new Map(oldRanges.map((info) => [info.name, info]));\r\n\r\n    let restored = 0;\r\n\r\n    for (const newInfo of newRanges) {\r\n      if (!newInfo.count) continue;\r\n      const oldInfo = oldRangeMap.get(newInfo.name);\r\n      if (!oldInfo || !oldInfo.count) continue;\r\n\r\n      const transferable = Math.min(oldInfo.count, newInfo.count);\r\n      for (let i = 0; i < transferable; i += 1) {\r\n        const srcIndex = oldInfo.start + i;\r\n        const dstIndex = newInfo.start + i;\r\n        if (srcIndex >= previousState.count || dstIndex >= currentCount) {\r\n          break;\r\n        }\r\n\r\n        if (prevPositions) {\r\n          const srcPosBase = srcIndex * 3;\r\n          const dstPosBase = dstIndex * 3;\r\n          positions[dstPosBase] = prevPositions[srcPosBase];\r\n          positions[dstPosBase + 1] = prevPositions[srcPosBase + 1];\r\n          positions[dstPosBase + 2] = prevPositions[srcPosBase + 2];\r\n        }\r\n\r\n        if (prevVelocities) {\r\n          const srcVelBase = srcIndex * 3;\r\n          const dstVelBase = dstIndex * 3;\r\n          velocities[dstVelBase] = prevVelocities[srcVelBase];\r\n          velocities[dstVelBase + 1] = prevVelocities[srcVelBase + 1];\r\n          velocities[dstVelBase + 2] = prevVelocities[srcVelBase + 2];\r\n        }\r\n\r\n        if (prevOrientations) {\r\n          const srcOriBase = srcIndex * 4;\r\n          const dstOriBase = dstIndex * 4;\r\n          orientations[dstOriBase] = prevOrientations[srcOriBase];\r\n          orientations[dstOriBase + 1] = prevOrientations[srcOriBase + 1];\r\n          orientations[dstOriBase + 2] = prevOrientations[srcOriBase + 2];\r\n          orientations[dstOriBase + 3] = prevOrientations[srcOriBase + 3];\r\n        }\r\n        restored += 1;\r\n      }\r\n    }\r\n\r\n    if (restored > 0) {\r\n      this.syncReadToWriteBuffers();\r\n    }\r\n  }\r\n\r\n  /** wasm  */\r\n  buildSpatialIndex(arg0, arg1) {\r\n    const handle = this.ensureHandle(this.buildHandle, 'build');\r\n    handle(arg0, arg1);\r\n  }\r\n\r\n  /** wasm  */\r\n  exportTreeStructure() {\r\n    if (typeof this.exportTreeStructureHandle !== 'function') {\r\n      return null;\r\n    }\r\n    return this.exportTreeStructureHandle();\r\n  }\r\n\r\n  /**  Boid  X  */\r\n  currentFirstBoidX() {\r\n    if (typeof this.currentFirstBoidXHandle !== 'function') {\r\n      return 0;\r\n    }\r\n    return this.currentFirstBoidXHandle();\r\n  }\r\n\r\n  /**  ID  Boid  */\r\n  getUnitMappings(count) {\r\n    if (!count || count <= 0 || typeof this.boidUnitMappingPtrHandle !== 'function') {\r\n      return null;\r\n    }\r\n\r\n    const ptr = this.boidUnitMappingPtrHandle();\r\n    if (!ptr) {\r\n      return null;\r\n    }\r\n\r\n    return new Int32Array(this.wasm.HEAP32.buffer, ptr, count * 2);\r\n  }\r\n\r\n  /** wasm  triple buffer  */\r\n  syncReadToWriteBuffers() {\r\n    if (typeof this.syncReadToWriteBuffersHandle === 'function') {\r\n      this.syncReadToWriteBuffersHandle();\r\n    }\r\n  }\r\n\r\n  /** cwrap  null */\r\n  createWrappedFunction(name, returnType, argTypes) {\r\n    const { wasm } = this;\r\n    if (!wasm) {\r\n      return null;\r\n    }\r\n\r\n    if (typeof wasm[name] === 'function') {\r\n      return wasm[name].bind(wasm);\r\n    }\r\n\r\n    if (typeof wasm.cwrap === 'function') {\r\n      try {\r\n        return wasm.cwrap(name, returnType, argTypes);\r\n      } catch (error) {\r\n        console.warn(`WasmtimeBridge: ${name} `, error);\r\n      }\r\n    }\r\n    return null;\r\n  }\r\n\r\n  /**  */\r\n  ensureHandle(handle, name) {\r\n    if (typeof handle !== 'function') {\r\n      throw new Error(`WasmtimeBridge: ${name} `);\r\n    }\r\n    return handle;\r\n  }\r\n}\r\n\r\n//  {name,start,count} \r\nfunction buildSpeciesRanges(list = []) {\r\n  const ranges = [];\r\n  let offset = 0;\r\n  for (const item of list) {\r\n    if (!item) continue;\r\n    const count = Math.max(0, Number(item.count) || 0);\r\n    ranges.push({\r\n      name: item.species || '',\r\n      start: offset,\r\n      count,\r\n    });\r\n    offset += count;\r\n  }\r\n  return ranges;\r\n}\r\n","import { reactive, computed, toRaw } from 'vue';\r\n\r\nconst STORAGE_KEY = 'boids_settings';\r\nconst DEFAULT_SPECIES_FALLBACK = {\r\n  species: 'Species',\r\n  count: 0,\r\n  cohesion: 20,\r\n  cohesionRange: 30,\r\n  separation: 5,\r\n  separationRange: 1,\r\n  alignment: 10,\r\n  alignmentRange: 6,\r\n  maxSpeed: 0.3,\r\n  minSpeed: 0,\r\n  maxTurnAngle: 0.2,\r\n  maxNeighbors: 6,\r\n  horizontalTorque: 0.02,\r\n  torqueStrength: 5,\r\n  lambda: 0.5,\r\n  tau: 1.5,\r\n  velocityEpsilon: 0.0001,\r\n  predatorAlertRadius: 1,\r\n  isPredator: false,\r\n  speciesId: 0,\r\n};\r\n\r\n/**\r\n * Flock //\r\n * localStorage Vue \r\n */\r\nexport function createFlockSettingsStore(defaultSettings = [], defaultSystem = {}) {\r\n  const defaultTemplates = sanitizeSpeciesList(defaultSettings, defaultSettings);\r\n  const systemDefaults = { ...defaultSystem };\r\n  const settings = reactive([]);\r\n  const systemSettings = reactive({});\r\n\r\n  replaceSettings(defaultTemplates);\r\n  assignSystemSettings(systemDefaults);\r\n  if (!loadFromStorage()) {\r\n    replaceSettings(defaultTemplates);\r\n    assignSystemSettings(systemDefaults);\r\n  }\r\n\r\n  const totalBoids = computed(() => getTotalBoidCount(settings));\r\n\r\n  function loadFromStorage() {\r\n    if (typeof localStorage === 'undefined') {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const saved = localStorage.getItem(STORAGE_KEY);\r\n      if (!saved) {\r\n        return false;\r\n      }\r\n      const parsed = JSON.parse(saved);\r\n      if (Array.isArray(parsed) && parsed.length > 0) {\r\n        replaceSettings(parsed);\r\n        return true;\r\n      }\r\n      if (parsed && typeof parsed === 'object') {\r\n        if (Array.isArray(parsed.species) && parsed.species.length > 0) {\r\n          replaceSettings(parsed.species);\r\n        }\r\n        if (parsed.system && typeof parsed.system === 'object') {\r\n          assignSystemSettings(parsed.system);\r\n        }\r\n        return true;\r\n      }\r\n    } catch (error) {\r\n      console.warn('Failed to load settings from localStorage:', error);\r\n    }\r\n    return false;\r\n  }\r\n\r\n  function saveToStorage() {\r\n    if (typeof localStorage === 'undefined') {\r\n      return false;\r\n    }\r\n\r\n    try {\r\n      const snapshot = {\r\n        species: settings.map((entry) => ({ ...toRaw(entry) })),\r\n        system: { ...toRaw(systemSettings) },\r\n      };\r\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(snapshot));\r\n      return true;\r\n    } catch (error) {\r\n      console.warn('Failed to save settings to localStorage:', error);\r\n      return false;\r\n    }\r\n  }\r\n\r\n  function replaceSettings(nextList) {\r\n    const sanitized = sanitizeSpeciesList(nextList, defaultTemplates);\r\n    settings.splice(0, settings.length, ...sanitized);\r\n    return sanitized;\r\n  }\r\n\r\n  function assignSystemSettings(patch = {}) {\r\n    const merged = { ...systemDefaults, ...(patch || {}) };\r\n    Object.keys(systemSettings).forEach((key) => {\r\n      if (!(key in merged)) {\r\n        delete systemSettings[key];\r\n      }\r\n    });\r\n    Object.entries(merged).forEach(([key, value]) => {\r\n      systemSettings[key] = value;\r\n    });\r\n    return systemSettings;\r\n  }\r\n\r\n  function resetToDefaults() {\r\n    replaceSettings(defaultTemplates);\r\n    assignSystemSettings(systemDefaults);\r\n    saveToStorage();\r\n  }\r\n\r\n  function addSpecies(template) {\r\n    const basePool = settings.length > 0 ? settings : defaultTemplates;\r\n    const fallbackTemplate =\r\n      basePool.find((item) => item && !item.isPredator) ||\r\n      defaultTemplates.find((item) => item && !item.isPredator) ||\r\n      DEFAULT_SPECIES_FALLBACK;\r\n\r\n    const candidate = template\r\n      ? sanitizeSpeciesEntry(template, fallbackTemplate)\r\n      : cloneSpeciesTemplate(fallbackTemplate);\r\n\r\n    candidate.isPredator = false;\r\n    candidate.count = 0;\r\n    candidate.species = ensureUniqueName(candidate.species, new Set(settings.map((s) => s.species)));\r\n    settings.push(candidate);\r\n    return candidate;\r\n  }\r\n\r\n  function removeSpecies(index) {\r\n    if (index < 0 || index >= settings.length) {\r\n      return null;\r\n    }\r\n    const removed = settings.splice(index, 1);\r\n    return removed.length ? removed[0] : null;\r\n  }\r\n\r\n  return {\r\n    settings,\r\n    systemSettings,\r\n    totalBoids,\r\n    loadFromStorage,\r\n    saveToStorage,\r\n    replaceSettings,\r\n    assignSystemSettings,\r\n    resetToDefaults,\r\n    addSpecies,\r\n    removeSpecies,\r\n  };\r\n}\r\n\r\nfunction getTotalBoidCount(list) {\r\n  return list.reduce((sum, entry) => sum + Math.max(0, Number(entry?.count) || 0), 0);\r\n}\r\n\r\nfunction sanitizeSpeciesList(list = [], fallbackList = []) {\r\n  if (!Array.isArray(list)) {\r\n    return [];\r\n  }\r\n\r\n  const sanitized = [];\r\n  const takenNames = new Set();\r\n\r\n  list.forEach((entry, index) => {\r\n    const fallback = fallbackList[index] || fallbackList[0] || DEFAULT_SPECIES_FALLBACK;\r\n    const clean = sanitizeSpeciesEntry(entry, fallback);\r\n    clean.species = ensureUniqueName(clean.species, takenNames);\r\n    sanitized.push(clean);\r\n  });\r\n\r\n  return sanitized;\r\n}\r\n\r\nfunction sanitizeSpeciesEntry(entry = {}, fallback = DEFAULT_SPECIES_FALLBACK) {\r\n  const base = { ...DEFAULT_SPECIES_FALLBACK, ...fallback };\r\n  const merged = { ...base, ...entry };\r\n\r\n  const toFinite = (value, fallbackValue = 0) => {\r\n    const num = Number(value);\r\n    return Number.isFinite(num) ? num : fallbackValue;\r\n  };\r\n\r\n  const result = { ...merged };\r\n  result.count = Math.max(0, Math.floor(toFinite(merged.count, base.count ?? 0)));\r\n  result.maxNeighbors = Math.max(0, Math.floor(toFinite(merged.maxNeighbors, base.maxNeighbors ?? 0)));\r\n  result.speciesId = Math.max(0, Math.floor(toFinite(merged.speciesId, base.speciesId ?? 0)));\r\n\r\n  result.cohesion = toFinite(merged.cohesion, base.cohesion ?? 0);\r\n  result.cohesionRange = Math.max(0, toFinite(merged.cohesionRange, base.cohesionRange ?? 0));\r\n  result.separation = toFinite(merged.separation, base.separation ?? 0);\r\n  result.separationRange = Math.max(0, toFinite(merged.separationRange, base.separationRange ?? 0));\r\n  result.alignment = toFinite(merged.alignment, base.alignment ?? 0);\r\n  result.alignmentRange = Math.max(0, toFinite(merged.alignmentRange, base.alignmentRange ?? 0));\r\n  result.maxSpeed = Math.max(0, toFinite(merged.maxSpeed, base.maxSpeed ?? 0));\r\n  result.minSpeed = Math.max(0, toFinite(merged.minSpeed, base.minSpeed ?? 0));\r\n  result.maxTurnAngle = toFinite(merged.maxTurnAngle, base.maxTurnAngle ?? 0);\r\n  result.horizontalTorque = toFinite(merged.horizontalTorque, base.horizontalTorque ?? 0);\r\n  result.torqueStrength = toFinite(merged.torqueStrength, base.torqueStrength ?? 0);\r\n  result.lambda = toFinite(merged.lambda, base.lambda ?? 0);\r\n  result.tau = toFinite(merged.tau, base.tau ?? 0);\r\n  result.velocityEpsilon = Math.max(0, toFinite(merged.velocityEpsilon, base.velocityEpsilon ?? 0.0001));\r\n  result.predatorAlertRadius = Math.max(0, toFinite(merged.predatorAlertRadius, base.predatorAlertRadius ?? 1));\r\n\r\n  const speciesName = typeof merged.species === 'string' ? merged.species.trim() : '';\r\n  result.species = speciesName || base.species || DEFAULT_SPECIES_FALLBACK.species;\r\n  result.isPredator = Boolean(merged.isPredator);\r\n\r\n  return result;\r\n}\r\n\r\nfunction ensureUniqueName(name, taken, defaultName = 'Species') {\r\n  const base = typeof name === 'string' && name.trim() ? name.trim() : defaultName;\r\n  let candidate = base;\r\n  let index = 2;\r\n  while (taken.has(candidate)) {\r\n    candidate = `${base} ${index}`;\r\n    index += 1;\r\n  }\r\n  taken.add(candidate);\r\n  return candidate;\r\n}\r\n\r\nfunction cloneSpeciesTemplate(template) {\r\n  return JSON.parse(JSON.stringify(template));\r\n}\r\n","<template>\n  <div id=\"app\">\n    <div class=\"ui-overlay\">\n      <h1>Boids Simulation</h1>\n      <details>\n        <summary>Settings</summary>\n        <div v-for=\"(s, i) in settings\" :key=\"i\">\n          <Settings\n            :settings=\"s\"\n            :can-remove=\"settings.length > 1\"\n            @remove=\"removeSpecies(i)\"\n          />\n        </div>\n        <button class=\"add-species-button\" @click=\"addSpecies\">\n          \n        </button>\n        <button @click=\"resetSettings\" style=\"margin-bottom: 1em\">\n          \n        </button>\n        <br />\n        <div class=\"settings tuning-settings\">\n          <details class=\"species-section\" :open=\"false\">\n            <summary class=\"species-header\">\n              <span class=\"species-title\">Adjustment</span>\n            </summary>\n            <div class=\"species-content\">\n              <div class=\"setting-row\">\n                <label><br />(threatDecay):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"5\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.threatDecay\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.threatDecay\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(threatGain):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"5\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.threatGain\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.threatGain\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(maxEscapeWeight):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"1\"\n                  step=\"0.01\"\n                  v-model.number=\"systemSettings.maxEscapeWeight\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  v-model.number=\"systemSettings.maxEscapeWeight\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(baseEscapeStrength):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"15\"\n                  step=\"0.1\"\n                  v-model.number=\"systemSettings.baseEscapeStrength\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.1\"\n                  v-model.number=\"systemSettings.baseEscapeStrength\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(escapeStrengthPerThreat):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"40\"\n                  step=\"0.5\"\n                  v-model.number=\"systemSettings.escapeStrengthPerThreat\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.5\"\n                  v-model.number=\"systemSettings.escapeStrengthPerThreat\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(cohesionBoost):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"3\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.cohesionBoost\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.cohesionBoost\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(separationMinFactor):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"1\"\n                  step=\"0.01\"\n                  v-model.number=\"systemSettings.separationMinFactor\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  v-model.number=\"systemSettings.separationMinFactor\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(alignmentBoost):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"2\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.alignmentBoost\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.05\"\n                  v-model.number=\"systemSettings.alignmentBoost\"\n                />\n              </div>\n              <div class=\"setting-row\">\n                <label><br />(antiMillGain):</label>\n                <input\n                  type=\"range\"\n                  min=\"0\"\n                  max=\"0.6\"\n                  step=\"0.01\"\n                  v-model.number=\"systemSettings.antiMillGain\"\n                />\n                <input\n                  class=\"value-input\"\n                  type=\"number\"\n                  step=\"0.01\"\n                  v-model.number=\"systemSettings.antiMillGain\"\n                />\n              </div>\n            </div>\n          </details>\n        </div>\n        <div>\n          <label>\n            <input type=\"checkbox\" v-model=\"showUnits\" />\n            Unit\n          </label>\n          <label style=\"margin-left: 1em\">\n            <input type=\"checkbox\" v-model=\"showUnitSpheres\" />\n            \n          </label>\n          <label style=\"margin-left: 1em\">\n            <input type=\"checkbox\" v-model=\"showUnitLines\" />\n            \n          </label>\n          <label style=\"margin-left: 1em\">\n            <input type=\"checkbox\" v-model=\"showUnitColors\" />\n            Unit\n          </label>\n          <label style=\"margin-left: 1em\">\n            :\n            <input type=\"range\" min=\"1\" max=\"20\" v-model=\"unitLayer\" />\n            {{ unitLayer }}\n          </label>\n        </div>\n      </details>\n      <div class=\"info\">\n        <p>Boids Count: {{ totalBoids }}</p>\n      </div>\n    </div>\n    <div ref=\"threeContainer\" class=\"three-container\" />\n    <audio\n      ref=\"backgroundAudio\"\n      src=\"/UnderWater.mp3\"\n      loop\n      style=\"display: none\"\n    />\n  </div>\n</template>\n\n<script setup>\nimport { inject, onMounted, ref, watch, toRaw } from \"vue\";\nimport * as THREE from \"three\";\nimport { OrbitControls } from \"three/examples/jsm/controls/OrbitControls.js\";\nimport Settings from \"./components/Settings.vue\";\nimport StatsGl from \"stats-gl\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nimport { BoidInstancing } from \"./rendering/BoidInstancing.js\";\nimport { FogPipeline } from \"./rendering/FogPipeline.js\";\nimport { ParticleField } from \"./rendering/ParticleField.js\";\nimport { WasmtimeBridge } from \"./simulation/WasmtimeBridge.js\";\nimport { createFlockSettingsStore } from \"./state/FlockSettingsStore.js\";\n\nconst wasmModule = inject(\"wasmModule\");\nif (!wasmModule) {\n  console.error(\"wasmModule not provided\");\n}\n\nconst wasmBridge = wasmModule ? new WasmtimeBridge(wasmModule) : null;\n\nif (typeof window !== \"undefined\" && wasmBridge) {\n  window.readLbvhStats = () => wasmBridge.getLbvhQueryStatsSnapshot();\n}\n\n// const getUnitCount = wasmModule.cwrap('getUnitCount', 'number', []);\n// const getUnitParentIndicesPtr = wasmModule.cwrap('getUnitParentIndicesPtr', 'number', []);\n\nfunction detectDeviceProfile() {\n  const profile = {\n    isMobile: false,\n    hasIntegratedGpu: false,\n  };\n\n  if (typeof navigator === \"undefined\") {\n    return profile;\n  }\n\n  // \n  profile.isMobile =\n    /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(\n      navigator.userAgent\n    );\n  if (profile.isMobile) {\n    return profile;\n  }\n\n  // IntelGPUPCGPU\n  try {\n    const canvas = document.createElement(\"canvas\");\n    const gl = canvas.getContext(\"webgl2\") || canvas.getContext(\"webgl\");\n    if (gl) {\n      const debugInfo = gl.getExtension(\"WEBGL_debug_renderer_info\");\n      if (debugInfo) {\n        const renderer = gl.getParameter(debugInfo.UNMASKED_RENDERER_WEBGL);\n        if (renderer && /intel/i.test(renderer)) {\n          console.log(\"Detected Intel integrated GPU:\", renderer);\n          profile.hasIntegratedGpu = true;\n        }\n      }\n    }\n  } catch (error) {\n    console.warn(\"Failed to inspect GPU characteristics:\", error);\n  }\n\n  return profile;\n}\n\nfunction fetchTreeStructure() {\n  return wasmBridge?.exportTreeStructure() ?? null;\n}\nconst deviceProfile = detectDeviceProfile();\nconst useLowSpecPreset =\n  deviceProfile.isMobile || deviceProfile.hasIntegratedGpu;\nconst mobileBoidCount = useLowSpecPreset ? 6000 : 10000;\n\nconst DEFAULT_SETTINGS = [\n  {\n    species: \"Boids\", // \n    count: mobileBoidCount, // 6000PC10000\n    cohesion: 38, // \n    cohesionRange: 30, // \n    separation: 8, // \n    separationRange: 0.6, // \n    alignment: 19, // \n    alignmentRange: 6, // \n    maxSpeed: 0.26, // \n    maxTurnAngle: 0.25, // \n    maxNeighbors: 6, // \n    horizontalTorque: 0.019, // \n    torqueStrength: 10, // \n    lambda: 0.62, // \n    tau: 1.0, // \n    predatorAlertRadius: 1.0, // \n  },\n  {\n    species: \"Predator\",\n    count: 1,\n    cohesion: 5.58, // \n    separation: 0.0,\n    alignment: 0.0,\n    maxSpeed: 1.37, // \n    minSpeed: 0.4,\n    maxTurnAngle: 0.13,\n    separationRange: 14.0,\n    alignmentRange: 11.0,\n    cohesionRange: 77.0,\n    maxNeighbors: 0,\n    lambda: 0.05,\n    tau: 1.0, // \n    horizontalTorque: 0.022,\n    torqueStrength: 0.0,\n    isPredator: true, // \n  },\n];\n\nconst DEFAULT_TUNING_SETTINGS = {\n  threatDecay: 0.75, // 1/sec\n  threatGain: 2.0, // \n  maxEscapeWeight: 1.0, // 01\n  baseEscapeStrength: 3.0, // \n  escapeStrengthPerThreat: 10.0, // \n  cohesionBoost: 2.0, // \n  separationMinFactor: 1.0, // 01\n  alignmentBoost: 1.2, // \n  antiMillGain: 0.15, // \n};\n\nconst flockStore = createFlockSettingsStore(\n  DEFAULT_SETTINGS,\n  DEFAULT_TUNING_SETTINGS\n);\nconst {\n  settings,\n  systemSettings,\n  assignSystemSettings: syncSystemSettings,\n  totalBoids,\n  replaceSettings,\n  resetToDefaults,\n  addSpecies: addSpeciesFromStore,\n  removeSpecies: removeSpeciesFromStore,\n  saveToStorage,\n} = flockStore;\n\nconst tuningInitialized = ref(false);\n\n// \nfunction sanitizeTuningParams(raw = {}) {\n  const sanitized = {};\n  for (const [key, fallback] of Object.entries(DEFAULT_TUNING_SETTINGS)) {\n    const value = Number(raw[key]);\n    sanitized[key] = Number.isFinite(value) ? value : fallback;\n  }\n  return sanitized;\n}\n\n// reactive  systemSettings  wasm \nfunction updateSystemSettings(newValues) {\n  const payload = sanitizeTuningParams(newValues);\n  syncSystemSettings(payload);\n  return payload;\n}\n\n// wasm \nfunction applySystemSettingsToWasm() {\n  if (!wasmBridge) {\n    return;\n  }\n  const payload = sanitizeTuningParams(systemSettings);\n  wasmBridge.setSimulationTuningParams(payload);\n}\n\n// \nfunction snapshotSettingsList(list) {\n  return list.map((item) => JSON.parse(JSON.stringify(toRaw(item))));\n}\n\nlet cachedTotalBoidCount = totalBoids.value;\nlet lastSpeciesSignature = getSpeciesSignature(settings);\nlet previousSettingsSnapshot = snapshotSettingsList(settings);\nlet pendingStateForReinitialize = null; // \nlet pendingSettingsSnapshot = null; // \n\n// localStorage \nfunction applySettingsSnapshot(snapshot) {\n  if (!Array.isArray(snapshot) || snapshot.length === 0) {\n    return null;\n  }\n  const sanitized = replaceSettings(snapshot);\n  saveToStorage();\n  previousSettingsSnapshot = snapshotSettingsList(settings);\n  return sanitized;\n}\n\nfunction addSpecies(template) {\n  const added = addSpeciesFromStore(template);\n  saveToStorage();\n  return added;\n}\n\nfunction removeSpecies(index) {\n  if (settings.length <= 1) {\n    return null;\n  }\n  const removed = removeSpeciesFromStore(index);\n  if (removed) {\n    saveToStorage();\n  }\n  return removed;\n}\n\n// Three.js  DOM \nconst threeContainer = ref(null);\nconst backgroundAudio = ref(null);\nlet scene, camera, renderer, controls;\nlet fogPipeline = null; // \nlet particleField = null; // \n\nconst paused = ref(false);\n\n//  Unit \nconst showUnits = ref(true);\nconst showUnitSpheres = ref(false);\nconst showUnitLines = ref(false);\nconst showUnitColors = ref(false);\nconst unitLayer = ref(1);\n\nlet unitSpheres = []; // \nlet unitLines = []; // \n\nlet maxDepth = 1;\nlet stats = null; // stats-gl \nlet glContext = null;\nlet frameCounter = 0;\nlet flockReinitTimer = null; // \n\nlet animationTimer = null;\nconst FRAME_INTERVAL = 1000 / 1000; // \nconst COUNT_REINIT_DELAY_MS = 400; // \n\nfunction positionStatsOverlay(element) {\n  if (!element) return;\n  element.style.position = \"fixed\";\n  element.style.top = \"0px\";\n  element.style.right = \"0px\";\n  element.style.left = \"auto\";\n  element.style.bottom = \"auto\";\n  element.style.zIndex = \"9999\";\n  element.style.width = \"270px\";\n  element.style.height = \"48px\";\n  element.style.pointerEvents = \"auto\";\n  element.style.transform = \"none\";\n}\n\n// \nfunction calcMaxDepth(unit, depth = 0) {\n  if (\n    !unit ||\n    !unit.children ||\n    typeof unit.children.size !== \"function\" ||\n    unit.children.size() === 0\n  ) {\n    return depth;\n  }\n  let max = depth;\n  for (let i = 0; i < unit.children.size(); i++) {\n    const child = unit.children.get(i);\n    max = Math.max(max, calcMaxDepth(child, depth + 1));\n  }\n  return max;\n}\n\nfunction handleKeydown(e) {\n  if (e.code === \"Space\") {\n    paused.value = !paused.value;\n  }\n}\n\nfunction initThreeJS() {\n  const width = window.innerWidth;\n  const height = window.innerHeight;\n\n  scene = new THREE.Scene();\n  scene.background = new THREE.Color(OCEAN_COLORS.DEEP_BLUE);\n  createOceanSphere();\n\n  camera = new THREE.PerspectiveCamera(75, width / height, 0.1, 1000);\n  camera.position.set(3, -5, 3);\n  camera.lookAt(0, 0, 0);\n\n  renderer = new THREE.WebGLRenderer({\n    antialias: true,\n    depth: true, // \n  });\n  // \n  renderer.toneMapping = THREE.CineonToneMapping;\n  renderer.toneMappingExposure = 0.8;\n  renderer.setPixelRatio(window.devicePixelRatio); // DPI\n  renderer.setSize(width, height);\n  renderer.shadowMap.enabled = true;\n  renderer.shadowMap.type = THREE.PCFShadowMap; // \n\n  glContext = renderer.getContext();\n\n  threeContainer.value.appendChild(renderer.domElement);\n\n  camera.aspect = width / height;\n  camera.updateProjectionMatrix();\n\n  controls = new OrbitControls(camera, renderer.domElement);\n  controls.enableDamping = true; // \n  controls.dampingFactor = 0.1;\n\n  // \n  const groundGeo = new THREE.PlaneGeometry(300, 300);\n  const groundMat = createFadeOutGroundMaterial();\n  groundMat.depthTest = true;\n  const ground = new THREE.Mesh(groundGeo, groundMat);\n  ground.rotation.x = -Math.PI / 2;\n  ground.position.y = -10;\n  ground.receiveShadow = true; // \n  scene.add(ground);\n\n  // \n  const ambientLight = new THREE.AmbientLight(\n    toHex(OCEAN_COLORS.AMBIENT_LIGHT),\n    0.9\n  );\n  scene.add(ambientLight);\n\n  // DirectionalLight\n  const dirLight = new THREE.DirectionalLight(\n    toHex(OCEAN_COLORS.SUN_LIGHT),\n    20\n  ); // \n  dirLight.position.set(300, 500, 200); // \n  dirLight.castShadow = true;\n\n  // \n  dirLight.shadow.camera.left = -100;\n  dirLight.shadow.camera.right = 100;\n  dirLight.shadow.camera.top = 100;\n  dirLight.shadow.camera.bottom = -100;\n  dirLight.shadow.camera.near = 1;\n  dirLight.shadow.camera.far = 400;\n\n  dirLight.shadow.mapSize.width = 768;\n  dirLight.shadow.mapSize.height = 768;\n  dirLight.shadow.bias = -0.01;\n  dirLight.shadow.normalBias = 0.01;\n\n  scene.add(dirLight);\n  initParticleSystem();\n  if (!deviceProfile.isMobile) {\n    fogPipeline?.dispose();\n    fogPipeline = new FogPipeline(heightFogConfig);\n    fogPipeline.init(renderer, scene, camera, width, height);\n  } else if (fogPipeline) {\n    fogPipeline.dispose();\n    fogPipeline = null;\n  }\n  // \n  window.addEventListener(\"resize\", onWindowResize);\n}\n\nfunction onWindowResize() {\n  const width = window.innerWidth;\n  const height = window.innerHeight;\n  camera.aspect = width / height;\n  camera.updateProjectionMatrix();\n  renderer.setSize(width, height);\n  fogPipeline?.resize(width, height);\n}\n\nfunction createSinCosLutTexture(size) {\n  const data = new Uint8Array(size * 4);\n  for (let i = 0; i < size; i++) {\n    const angle = (i / size) * Math.PI * 2;\n    const sinValue = Math.sin(angle);\n    const cosValue = Math.cos(angle);\n    data[i * 4] = Math.round((sinValue * 0.5 + 0.5) * 255);\n    data[i * 4 + 1] = Math.round((cosValue * 0.5 + 0.5) * 255);\n    data[i * 4 + 2] = 0;\n    data[i * 4 + 3] = 255;\n  }\n  const texture = new THREE.DataTexture(data, size, 1, THREE.RGBAFormat);\n  texture.needsUpdate = true;\n  texture.wrapS = THREE.RepeatWrapping;\n  texture.wrapT = THREE.ClampToEdgeWrapping;\n  texture.magFilter = THREE.LinearFilter;\n  texture.minFilter = THREE.LinearFilter;\n  texture.generateMipmaps = false;\n  texture.flipY = false;\n  return texture;\n}\n\nconst TRIPLE_BUFFER_SIZE = 3; // BoidInstancing \nconst HIDDEN_POSITION = 1e6; // \nconst IDENTITY_QUATERNION = [0, 0, 0, 1]; // \nconst SIN_LUT_SIZE = 256; //  LUT \nconst sinCosLutTexture = createSinCosLutTexture(SIN_LUT_SIZE);\n// LOD: LOD+LOD\nconst LOD_DISTANCE_PRESET = deviceProfile.isMobile\n  ? { nearSq: 1.5, midSq: 9 } // LOD\n  : { nearSq: 4, midSq: 25 }; // PC \nconst LOD_NEAR_DISTANCE_SQ = LOD_DISTANCE_PRESET.nearSq;\nconst LOD_MID_DISTANCE_SQ = LOD_DISTANCE_PRESET.midSq;\nconst tailAnimation = {\n  uniforms: {\n    uTailTime: { value: 0 }, // \n    uTailAmplitude: { value: 0.14 }, // \n    uTailFrequency: { value: 10.0 }, // \n    uTailPhaseStride: { value: 5.0 }, // \n    uTailTurnStrength: { value: 0.1 }, // \n    uTailSpeedScale: { value: 1 }, // \n    uTailRight: { value: new THREE.Vector3(1, 0, 0) }, // \n    uTailForward: { value: new THREE.Vector3(0, 0, 1) }, // \n    uTailUp: { value: new THREE.Vector3(0, 1, 0) }, // \n    uTailEnable: { value: 1 }, // /\n    uSinLut: { value: sinCosLutTexture },\n    uLutSize: { value: SIN_LUT_SIZE },\n  },\n};\n\nconst boidInstancing = new BoidInstancing({\n  tailAnimation,\n  tripleBufferSize: TRIPLE_BUFFER_SIZE,\n  hiddenPosition: HIDDEN_POSITION,\n  identityQuaternion: IDENTITY_QUATERNION,\n  lodNearDistanceSq: LOD_NEAR_DISTANCE_SQ,\n  lodMidDistanceSq: LOD_MID_DISTANCE_SQ,\n});\n\nlet instancedMeshHigh = null;\nlet instancedMeshLow = null;\n\n// \nconst OCEAN_COLORS = {\n  SKY_HIGHLIGHT: \"#4fbaff\",\n  SKY_BLUE: \"#15a1ff\",\n  DEEP_BLUE: \"#002968\",\n  SEAFLOOR: \"#777465\",\n  FOG: \"#153a6c\",\n  AMBIENT_LIGHT: \"#59a5eb\",\n  SUN_LIGHT: \"#5389b7\",\n  SIDE_LIGHT1: \"#6ba3d0\",\n  SIDE_LIGHT2: \"#2d5f7a\",\n  BOTTOM_LIGHT: \"#0f2635\",\n};\n\n// '#rrggbb'  three.js \nconst toHex = (colorStr) => parseInt(colorStr.replace(\"#\", \"0x\"), 16);\n\n// \nconst heightFogConfig = {\n  color: new THREE.Color(OCEAN_COLORS.DEEP_BLUE), // \n  distanceStart: 4.0, // \n  distanceEnd: 60.0, // \n  distanceExponent: 0.4, // \n  distanceControlPoint1: new THREE.Vector2(0.2, 0.8), // \n  distanceControlPoint2: new THREE.Vector2(0.75, 0.95), // \n  surfaceLevel: 100.0, // \n  heightFalloff: 0.01, // \n  heightExponent: 1, // \n  maxOpacity: 1.2, // \n};\n\nfunction createOceanSphere() {\n  if (!scene) return null;\n\n  // \n  const canvas = document.createElement(\"canvas\");\n  const context = canvas.getContext(\"2d\");\n  canvas.width = 512;\n  canvas.height = 512;\n\n  const gradient = context.createLinearGradient(0, 0, 0, canvas.height);\n  gradient.addColorStop(0, OCEAN_COLORS.SKY_HIGHLIGHT);\n  gradient.addColorStop(0.2, OCEAN_COLORS.SKY_BLUE);\n  gradient.addColorStop(0.6, OCEAN_COLORS.DEEP_BLUE);\n  gradient.addColorStop(1, OCEAN_COLORS.DEEP_BLUE);\n\n  context.fillStyle = gradient;\n  context.fillRect(0, 0, canvas.width, canvas.height);\n\n  const texture = new THREE.CanvasTexture(canvas);\n  texture.colorSpace = THREE.SRGBColorSpace;\n  texture.generateMipmaps = false;\n  texture.minFilter = THREE.LinearFilter;\n  texture.magFilter = THREE.LinearFilter;\n\n  const sphereGeo = new THREE.SphereGeometry(300, 32, 32);\n  const sphereMat = new THREE.MeshBasicMaterial({\n    map: texture,\n    side: THREE.BackSide,\n    fog: false,\n  });\n\n  const oceanSphere = new THREE.Mesh(sphereGeo, sphereMat);\n  scene.add(oceanSphere);\n  return oceanSphere;\n}\n\nfunction createFadeOutGroundMaterial() {\n  const textureLoader = new THREE.TextureLoader();\n  const alphaMap = textureLoader.load(\"./models/groundAlfa.png\");\n\n  alphaMap.minFilter = THREE.LinearFilter;\n  alphaMap.magFilter = THREE.LinearFilter;\n  alphaMap.wrapS = THREE.ClampToEdgeWrapping;\n  alphaMap.wrapT = THREE.ClampToEdgeWrapping;\n\n  const material = new THREE.MeshStandardMaterial({\n    color: toHex(OCEAN_COLORS.SEAFLOOR),\n    transparent: true,\n    alphaMap,\n    depthWrite: true,\n  });\n\n  material.roughness = 0.85;\n  material.metalness = 0.0;\n  return material;\n}\n\nfunction updateInstancingMaterialUniforms(time) {\n  boidInstancing.setTailUniformTime(time);\n  particleField?.setTime(time);\n}\n\nlet shaderTime = 0;\n\n// WebGL2\nfunction initParticleSystem() {\n  if (!scene || !renderer) {\n    return;\n  }\n  if (!particleField) {\n    particleField = new ParticleField(useLowSpecPreset);\n  }\n  particleField.init(scene, renderer, camera, controls);\n}\n\n// \nfunction updateParticleUniforms() {\n  particleField?.update(camera, controls);\n}\n\nfunction initBackgroundAudioPlayback() {\n  const audioEl = backgroundAudio.value;\n  if (!audioEl) {\n    return;\n  }\n\n  audioEl.volume = 0.1;\n  audioEl.loop = true;\n\n  const tryPlay = () => {\n    const playResult = audioEl.play();\n    if (playResult && typeof playResult.then === \"function\") {\n      playResult.catch(() => {\n        const resume = () => {\n          document.removeEventListener(\"pointerdown\", resume);\n          document.removeEventListener(\"keydown\", resume);\n          audioEl.play().catch(() => {\n            /* ignored */\n          });\n        };\n        document.addEventListener(\"pointerdown\", resume, { once: true });\n        document.addEventListener(\"keydown\", resume, { once: true });\n      });\n    }\n  };\n\n  tryPlay();\n}\n\nfunction stepSimulationAndUpdateState(deltaTime) {\n  if (!wasmBridge) {\n    return 0;\n  }\n  return wasmBridge.stepSimulation(deltaTime);\n}\n\nfunction getWasmViews(count) {\n  if (!wasmBridge) {\n    return {\n      positions: new Float32Array(0),\n      orientations: new Float32Array(0),\n      velocities: new Float32Array(0),\n      speciesIds: new Int32Array(0),\n    };\n  }\n  return wasmBridge.getBuffers(count);\n}\n\n// \nfunction captureFlockState() {\n  return wasmBridge?.captureState() ?? null;\n}\n\n// \nfunction restoreFlockState(previousState, oldSettings, newSettings) {\n  wasmBridge?.restoreState(previousState, oldSettings, newSettings);\n}\n\n// 3D \nlet boidModel = null;\nlet boidModelLod = null;\nlet originalMaterial = null;\nlet originalMaterialLod = null;\nlet predatorModel = null;\nlet predatorMaterial = null;\n\n//  Unit OFFON \nlet lastShowUnitColors = false;\n\n// \nfunction getPredatorCount() {\n  return settings.reduce(\n    (sum, s) => sum + (s.isPredator && s.count ? s.count : 0),\n    0\n  );\n}\n\n//  Boid \nfunction getTotalBoidCount() {\n  return totalBoids.value;\n}\n\n// \nfunction getSpeciesSignature(specList = settings) {\n  if (!Array.isArray(specList)) {\n    return \"\";\n  }\n  return specList\n    .map(\n      (s, index) =>\n        `${index}:${(s && s.count) || 0}:${s && s.isPredator ? 1 : 0}`\n    )\n    .join(\"|\");\n}\n\n//  WASM \nfunction createSpeciesParamsVector() {\n  if (!wasmBridge) {\n    console.warn(\"WasmtimeBridge \");\n    return null;\n  }\n\n  const rawSettings = toRaw(settings);\n  const source = Array.isArray(rawSettings)\n    ? rawSettings\n    : Array.from(settings ?? []);\n  const vector = wasmBridge.buildSpeciesParams(source);\n  if (!vector) {\n    console.warn(\"WasmtimeBridge.buildSpeciesParams \");\n  }\n  return vector;\n}\n\n// \nfunction reinitializeFlockNow() {\n  if (!wasmModule || !wasmBridge) return;\n\n  const pendingState = pendingStateForReinitialize?.state || null;\n  const oldSettingsRef =\n    pendingStateForReinitialize?.oldSettings || previousSettingsSnapshot;\n  const newSettingsRef =\n    pendingSettingsSnapshot || snapshotSettingsList(settings);\n  const targetSignature = getSpeciesSignature(newSettingsRef);\n\n  const vector = createSpeciesParamsVector();\n  if (!vector) {\n    console.error(\"Failed to create species parameter vector\");\n    applySettingsSnapshot(previousSettingsSnapshot);\n    pendingStateForReinitialize = null;\n    pendingSettingsSnapshot = null;\n    return;\n  }\n\n  try {\n    wasmModule.callInitBoids(vector, 1, 4, 0.25);\n  } finally {\n    if (typeof vector.delete === \"function\") {\n      vector.delete();\n    }\n  }\n  try {\n    wasmBridge.buildSpatialIndex(16, 0);\n  } catch (error) {\n    console.error(\n      \"WasmtimeBridge.buildSpatialIndex \",\n      error\n    );\n  }\n  const total = getTotalBoidCount();\n  cachedTotalBoidCount = total;\n  initInstancedBoids(total);\n\n  if (pendingState?.count > 0) {\n    restoreFlockState(pendingState, oldSettingsRef, newSettingsRef);\n  }\n\n  lastSpeciesSignature = targetSignature;\n  previousSettingsSnapshot = newSettingsRef;\n  pendingStateForReinitialize = null;\n  pendingSettingsSnapshot = null;\n}\n\n// \nfunction scheduleFlockReinitialize() {\n  if (flockReinitTimer) {\n    clearTimeout(flockReinitTimer);\n  }\n\n  if (!pendingStateForReinitialize) {\n    pendingStateForReinitialize = {\n      state: captureFlockState(),\n      oldSettings: previousSettingsSnapshot,\n    };\n  }\n\n  pendingSettingsSnapshot = snapshotSettingsList(settings);\n\n  flockReinitTimer = setTimeout(() => {\n    flockReinitTimer = null;\n    reinitializeFlockNow();\n  }, COUNT_REINIT_DELAY_MS);\n}\n\n// \nfunction initInstancedBoids(count) {\n  if (\n    !scene ||\n    !boidModel ||\n    !boidModelLod ||\n    !originalMaterial ||\n    !originalMaterialLod\n  ) {\n    console.warn(\"initInstancedBoids: required assets are not ready\");\n    return;\n  }\n\n  const initialized = boidInstancing.init(scene, {\n    count,\n    boidModel,\n    boidModelLod,\n    highMaterial: originalMaterial,\n    lowMaterial: originalMaterialLod,\n    predatorModel,\n  });\n\n  if (!initialized) {\n    console.error(\"Failed to initialize boid instancing\");\n    return;\n  }\n\n  const meshes = boidInstancing.getMeshes();\n  instancedMeshHigh = meshes.high;\n  instancedMeshLow = meshes.low;\n\n  // \n  const predatorCount = getPredatorCount();\n  if (typeof boidInstancing.ensurePredatorMeshes === \"function\") {\n    boidInstancing.ensurePredatorMeshes(predatorCount);\n  }\n\n  if (instancedMeshHigh?.instanceColor) {\n    instancedMeshHigh.instanceColor.needsUpdate = true;\n  }\n  if (instancedMeshLow?.instanceColor) {\n    instancedMeshLow.instanceColor.needsUpdate = true;\n  }\n}\n\nfunction loadBoidModel(callback) {\n  const loader = new GLTFLoader();\n  const basePath = process.env.BASE_URL || \"/\"; // publicPath \n  const textureLoader = new THREE.TextureLoader();\n  let pendingAssets = 3;\n  const notifyReady = () => {\n    pendingAssets = Math.max(0, pendingAssets - 1);\n    if (pendingAssets === 0) {\n      callback();\n    }\n  };\n  const texture = textureLoader.load(\n    \"./models/fish.png\", // \n    () => {\n      console.log(\"Texture loaded successfully.\");\n    },\n    undefined,\n    (error) => {\n      console.error(\"An error occurred while loading the texture:\", error);\n    }\n  );\n  const textureLod = textureLoader.load(\n    \"./models/fish_lod.png\", // \n    () => {\n      console.log(\"Texture loaded successfully.\");\n    },\n    undefined,\n    (error) => {\n      console.error(\"An error occurred while loading the texture:\", error);\n    }\n  );\n  texture.flipY = false;\n  texture.colorSpace = THREE.SRGBColorSpace; // sRGB\n  textureLod.flipY = false;\n  textureLod.colorSpace = THREE.SRGBColorSpace;\n\n  const predatorTexture = textureLoader.load(\n    \"./models/fishPredetor.png\",\n    () => {\n      console.log(\"Predator texture loaded successfully.\");\n    },\n    undefined,\n    (error) => {\n      console.error(\n        \"An error occurred while loading the predator texture:\",\n        error\n      );\n    }\n  );\n  predatorTexture.flipY = false;\n  predatorTexture.colorSpace = THREE.SRGBColorSpace;\n\n  let boidMaterial = new THREE.MeshStandardMaterial({\n    color: 0xffffff, // \n    roughness: 0.5,\n    metalness: 0.2,\n    transparent: false, // \n    alphaTest: 0.5, // \n    map: texture, // \n    vertexColors: false, // \n    vertexColor: 0xffffff,\n  });\n\n  let boidLodMaterial = new THREE.MeshStandardMaterial({\n    color: 0xffffff, // \n    roughness: 0.5,\n    metalness: 0.2,\n    transparent: false, // \n    alphaTest: 0.5, // \n    map: textureLod, // \n    vertexColors: false, // \n    vertexColor: 0xffffff,\n  });\n\n  originalMaterial = boidMaterial;\n  originalMaterialLod = boidLodMaterial;\n  predatorMaterial = new THREE.MeshStandardMaterial({\n    color: 0xffffff,\n    roughness: 0.5,\n    metalness: 0,\n    transparent: false,\n    alphaTest: 0.5,\n    map: predatorTexture,\n    vertexColors: false,\n    vertexColor: 0xffffff,\n  });\n  loader.load(\n    `./models/boidModel.glb`, // \n    (gltf) => {\n      boidModel = gltf.scene;\n\n      //  transparent  alphaTest \n      boidModel.traverse((child) => {\n        if (child.isMesh) {\n          child.material = boidMaterial; // \n        }\n      });\n\n      notifyReady();\n    },\n    undefined,\n    (error) => {\n      console.error(\"An error occurred while loading the model:\", error);\n      notifyReady();\n    }\n  );\n\n  loader.load(\n    `./models/boidModel_lod.glb`, // LOD\n    (gltf) => {\n      boidModelLod = gltf.scene;\n\n      //  transparent  alphaTest \n      boidModelLod.traverse((child) => {\n        if (child.isMesh) {\n          child.material = boidLodMaterial; // \n        }\n      });\n\n      notifyReady();\n    },\n    undefined,\n    (error) => {\n      console.error(\"An error occurred while loading the LOD model:\", error);\n      notifyReady();\n    }\n  );\n\n  loader.load(\n    `./models/boidPredetorModel.glb`,\n    (gltf) => {\n      predatorModel = gltf.scene;\n      predatorModel.traverse((child) => {\n        if (child.isMesh) {\n          child.material = predatorMaterial;\n          child.castShadow = true;\n          child.receiveShadow = true;\n        }\n      });\n      notifyReady();\n    },\n    undefined,\n    (error) => {\n      console.error(\n        \"An error occurred while loading the predator model:\",\n        error\n      );\n      notifyReady();\n    }\n  );\n}\n\nfunction clearUnitVisuals() {\n  for (const mesh of unitSpheres) scene.remove(mesh);\n  for (const line of unitLines) scene.remove(line);\n  unitSpheres = [];\n  unitLines = [];\n}\n\n// \nfunction drawUnitTree(unit, layer = 0) {\n  // : \n  if (\n    layer >= maxDepth - unitLayer.value + 1 &&\n    (unit.children == null || unit.children.size() === 0 || layer === maxDepth)\n  ) {\n    let sphere;\n    if (unitSpheres.length > 0) {\n      sphere = unitSpheres.pop(); // \n      sphere.visible = true;\n    } else {\n      const geometry = new THREE.SphereGeometry(unit.radius, 16, 16);\n      const material = new THREE.MeshBasicMaterial({\n        color: new THREE.Color().setHSL(0.1, 1, 0.7 - 0.4 * (layer / maxDepth)),\n        wireframe: true,\n        opacity: 0.3,\n        transparent: true,\n      });\n      sphere = new THREE.Mesh(geometry, material);\n      scene.add(sphere);\n    }\n    sphere.position.set(unit.center.x, unit.center.y, unit.center.z);\n    unitSpheres.push(sphere);\n  }\n\n  // : \n  if (\n    showUnitLines.value &&\n    unit.children &&\n    typeof unit.children.size === \"function\" &&\n    unit.children.size() > 0\n  ) {\n    for (let i = 0; i < unit.children.size(); i++) {\n      const child = unit.children.get(i);\n      let line;\n      if (unitLines.length > 0) {\n        line = unitLines.pop(); // \n        line.visible = true;\n      } else {\n        const lineGeometry = new THREE.BufferGeometry();\n        const lineMaterial = new THREE.LineBasicMaterial({\n          color: new THREE.Color().setHSL(\n            0.35,\n            1,\n            0.7 - 0.4 * (layer / maxDepth)\n          ),\n        });\n        line = new THREE.Line(lineGeometry, lineMaterial);\n        scene.add(line);\n      }\n      const points = [\n        new THREE.Vector3(unit.center.x, unit.center.y, unit.center.z),\n        new THREE.Vector3(child.center.x, child.center.y, child.center.z),\n      ];\n      line.geometry.setFromPoints(points);\n      unitLines.push(line);\n    }\n  }\n\n  // \n  if (\n    unit.children &&\n    typeof unit.children.size === \"function\" &&\n    unit.children.size() > 0\n  ) {\n    for (let i = 0; i < unit.children.size(); i++) {\n      const child = unit.children.get(i);\n      drawUnitTree(child, layer + 1);\n    }\n  }\n}\nlet lastTime = performance.now(); // \n\nfunction animate() {\n  stats?.begin();\n  const currentTime = performance.now();\n  const deltaTime = (currentTime - lastTime) / 1000;\n  lastTime = currentTime;\n\n  if (!paused.value) {\n    shaderTime += deltaTime;\n  }\n  updateInstancingMaterialUniforms(shaderTime);\n\n  const count = stepSimulationAndUpdateState(paused.value ? 0 : deltaTime);\n\n  const meshes = boidInstancing.getMeshes();\n  instancedMeshHigh = meshes.high;\n  instancedMeshLow = meshes.low;\n  const pipelineReady = fogPipeline?.isReady?.() ?? false;\n\n  if (!instancedMeshHigh || !instancedMeshLow) {\n    controls.update();\n    updateParticleUniforms();\n    if (pipelineReady) {\n      fogPipeline.updateCameraUniforms(camera);\n      fogPipeline.render(deltaTime);\n    } else {\n      renderer.render(scene, camera);\n    }\n    stats?.end();\n    stats?.update();\n    animationTimer = setTimeout(animate, FRAME_INTERVAL);\n    return;\n  }\n\n  const { positions, orientations, velocities } = getWasmViews(count);\n  if ((frameCounter++ & 63) === 0) {\n    wasmBridge?.currentFirstBoidX();\n  }\n\n  const predatorCount = getPredatorCount();\n  const updateInfo = boidInstancing.update({\n    count,\n    positions,\n    orientations,\n    velocities,\n    cameraPosition: camera.position,\n    predatorCount,\n  });\n\n  const visibleCount =\n    updateInfo.visibleCount ?? Math.max(0, count - predatorCount);\n\n  if (\n  showUnitColors.value &&\n  instancedMeshHigh.instanceColor &&\n  instancedMeshLow.instanceColor\n) {\n  const unitMappings = wasmBridge?.getUnitMappings(count);\n  const highCount = updateInfo?.highCount ?? visibleCount;\n  const lowCount = updateInfo?.lowCount ?? visibleCount;\n  const highMap = updateInfo?.highInstanceToBoid ?? null;\n  const lowMap = updateInfo?.lowInstanceToBoid ?? null;\n\n  if (unitMappings) {\n    // High LOD packed instance index\n    for (let inst = 0; inst < highCount; inst++) {\n      const boidIndex = highMap ? highMap[inst] : inst;\n      let unitId = -1;\n      for (let j = 0; j < unitMappings.length; j += 2) {\n        if (unitMappings[j] === boidIndex) {\n          unitId = unitMappings[j + 1];\n          break;\n        }\n      }\n\n      const color =\n        unitId >= 0\n          ? new THREE.Color().setHSL((unitId % 100) / 100, 0.8, 0.6)\n          : new THREE.Color(1, 0, 0);\n\n      instancedMeshHigh.setColorAt(inst, color);\n    }\n\n    // Low LOD packed instance index\n    for (let inst = 0; inst < lowCount; inst++) {\n      const boidIndex = lowMap ? lowMap[inst] : inst;\n      let unitId = -1;\n      for (let j = 0; j < unitMappings.length; j += 2) {\n        if (unitMappings[j] === boidIndex) {\n          unitId = unitMappings[j + 1];\n          break;\n        }\n      }\n\n      const color =\n        unitId >= 0\n          ? new THREE.Color().setHSL((unitId % 100) / 100, 0.8, 0.6)\n          : new THREE.Color(1, 0, 0);\n\n      instancedMeshLow.setColorAt(inst, color);\n    }\n\n    instancedMeshHigh.instanceColor.needsUpdate = true;\n    instancedMeshLow.instanceColor.needsUpdate = true;\n  }\n} else if (\n    lastShowUnitColors &&\n    instancedMeshHigh.instanceColor &&\n    instancedMeshLow.instanceColor\n  ) {\n    const whiteColor = new THREE.Color(1, 1, 1);\n    const highCount = updateInfo?.highCount ?? visibleCount;\nconst lowCount = updateInfo?.lowCount ?? visibleCount;\n\nfor (let i = 0; i < highCount; i++) {\n  instancedMeshHigh.setColorAt(i, whiteColor);\n}\nfor (let i = 0; i < lowCount; i++) {\n  instancedMeshLow.setColorAt(i, whiteColor);\n}\n    instancedMeshHigh.instanceColor.needsUpdate = true;\n    instancedMeshLow.instanceColor.needsUpdate = true;\n    console.log(\" Reset vertex colors to white (OFF mode)\");\n  }\n\n  lastShowUnitColors = showUnitColors.value;\n\n  controls.update();\n  updateParticleUniforms();\n  if (pipelineReady) {\n    fogPipeline.updateCameraUniforms(camera);\n    fogPipeline.render(deltaTime);\n  } else {\n    renderer.render(scene, camera);\n  }\n\n  stats?.end();\n  stats?.update();\n\n  animationTimer = setTimeout(animate, FRAME_INTERVAL);\n}\n\nfunction drawTreeStructure(treeData) {\n  const drawNode = (node, parentPosition = null) => {\n    const position = new THREE.Vector3(\n      node.center[0],\n      node.center[1],\n      node.center[2]\n    );\n    if (parentPosition) {\n      controls.update();\n      updateParticleUniforms();\n      const geometry = new THREE.BufferGeometry().setFromPoints([\n        parentPosition,\n        position,\n      ]);\n      const material = new THREE.LineBasicMaterial({ color: 0xffffff });\n      const line = new THREE.Line(geometry, material);\n      scene.add(line);\n    }\n\n    if (node.children) {\n      node.children.forEach((child) => drawNode(child, position));\n    }\n  };\n\n  treeData.forEach((rootNode) => drawNode(rootNode));\n}\n\n//  + \nfunction startSimulation() {\n  reinitializeFlockNow();\n  animate();\n}\n\nonMounted(() => {\n  //  WASM \n  if (!tuningInitialized.value) {\n    updateSystemSettings(toRaw(systemSettings));\n    tuningInitialized.value = true;\n    applySystemSettingsToWasm();\n    saveToStorage();\n  }\n\n  initThreeJS();\n  loadBoidModel(() => {\n    console.log(\"Boid model loaded successfully.\");\n\n    stats = new StatsGl({\n      trackGPU: true,\n      trackHz: true,\n      trackCPT: true,\n      logsPerSecond: 4,\n      graphsPerSecond: 30,\n      samplesLog: 40,\n      samplesGraph: 10,\n      precision: 2,\n      horizontal: true,\n      minimal: false,\n      mode: 0,\n    });\n\n    const statsInitTarget = renderer?.domElement ?? document.body;\n\n    const ensureStatsOverlay = () => {\n      const statsElement =\n        (typeof stats?.domElement !== \"undefined\" ? stats.domElement : null) ||\n        (typeof stats?.getDom === \"function\" ? stats.getDom() : null) ||\n        stats?.dom ||\n        stats?.container ||\n        stats?.wrapper ||\n        null;\n\n      if (statsElement) {\n        if (!statsElement.parentElement) {\n          document.body.appendChild(statsElement);\n        }\n        positionStatsOverlay(statsElement);\n      }\n    };\n\n    const initPromise =\n      stats && typeof stats.init === \"function\"\n        ? Promise.resolve(stats.init(statsInitTarget))\n        : Promise.resolve();\n\n    initPromise\n      .then(() => {\n        if (typeof stats?.patchThreeRenderer === \"function\") {\n          stats.patchThreeRenderer(renderer);\n        }\n        ensureStatsOverlay();\n      })\n      .catch((error) => {\n        console.error(\"Failed to initialize stats-gl:\", error);\n        ensureStatsOverlay();\n      });\n\n    startSimulation();\n    initBackgroundAudioPlayback();\n  });\n\n  window.addEventListener(\"keydown\", handleKeydown);\n});\n\n// wasm \nwatch(\n  systemSettings,\n  () => {\n    if (!tuningInitialized.value) {\n      return;\n    }\n    applySystemSettingsToWasm();\n    saveToStorage();\n  },\n  { deep: true }\n);\n\n// WASM  + \nwatch(\n  settings,\n  () => {\n    if (wasmModule && wasmModule.setGlobalSpeciesParamsFromJS) {\n      const vector = createSpeciesParamsVector();\n      if (vector) {\n        try {\n          wasmModule.setGlobalSpeciesParamsFromJS(vector, 1);\n        } finally {\n          if (typeof vector.delete === \"function\") {\n            vector.delete();\n          }\n        }\n      }\n    }\n\n    saveToStorage();\n\n    // \n    const signature = getSpeciesSignature(settings);\n    if (signature !== lastSpeciesSignature) {\n      scheduleFlockReinitialize();\n    } else {\n      if (flockReinitTimer) {\n        clearTimeout(flockReinitTimer);\n        flockReinitTimer = null;\n      }\n      pendingStateForReinitialize = null;\n      pendingSettingsSnapshot = null;\n      previousSettingsSnapshot = snapshotSettingsList(settings);\n    }\n\n    const predators = getPredatorCount();\n    if (typeof boidInstancing.ensurePredatorMeshes === \"function\") {\n      boidInstancing.ensurePredatorMeshes(predators);\n    }\n    const predatorMeshes =\n      typeof boidInstancing.getPredatorMeshes === \"function\"\n        ? boidInstancing.getPredatorMeshes()\n        : [];\n    for (const mesh of predatorMeshes) {\n      mesh.visible = false;\n    }\n  },\n  { deep: true }\n);\n\n// \nfunction resetSettings(presetList) {\n  if (Array.isArray(presetList) && presetList.length > 0) {\n    applySettingsSnapshot(presetList);\n  } else {\n    resetToDefaults();\n  }\n  updateSystemSettings(DEFAULT_TUNING_SETTINGS);\n  saveToStorage();\n  if (tuningInitialized.value) {\n    applySystemSettingsToWasm();\n  }\n}\n\n// Unit \nwatch(showUnits, (newValue) => {\n  console.log(\"showUnits changed to:\", newValue);\n  if (!newValue) {\n    // Unit\n    clearUnitVisuals();\n  }\n});\n\n// Unit\nwatch([showUnitSpheres, showUnitLines], ([newSpheres, newLines]) => {\n  console.log(\n    \"Unit display mode changed - Spheres:\",\n    newSpheres,\n    \"Lines:\",\n    newLines\n  );\n  // \n  if (showUnits.value) {\n    clearUnitVisuals();\n  }\n});\n</script>\n\n<style>\n#app {\n  font-family: Arial, sans-serif;\n  padding: 0;\n  margin: 0;\n  position: relative;\n  z-index: 1;\n}\n\n.settings {\n  margin-bottom: 20px;\n}\n\n.info {\n  margin-top: 20px;\n}\n\n.three-container {\n  position: fixed;\n  left: 0;\n  top: 0;\n  width: 100vw;\n  height: 100vh;\n  z-index: 0;\n  display: block;\n  border: none;\n  overflow: hidden;\n  background: #0a1e3a;\n}\n\n.ui-overlay {\n  position: absolute;\n  top: 0;\n  left: 0;\n  width: 100%;\n  padding: 20px;\n  box-sizing: border-box;\n  color: #fff;\n  z-index: 2;\n  pointer-events: none;\n}\n\n.ui-overlay * {\n  pointer-events: auto;\n}\n\n.add-species-button {\n  margin-top: 10px;\n  margin-bottom: 10px;\n}\n\n.tuning-settings {\n  pointer-events: none;\n  display: inline-block;\n  margin-top: 10px;\n}\n\n.tuning-settings * {\n  pointer-events: auto;\n}\n\n.tuning-settings .species-section {\n  border: 1px solid rgba(255, 255, 255, 0.2);\n  border-radius: 5px;\n  background-color: rgba(255, 255, 255, 0.05);\n  pointer-events: auto;\n  position: relative;\n  overflow: visible;\n  max-width: 100%;\n  width: fit-content;\n  min-width: 260px;\n}\n\n.tuning-settings .species-header {\n  padding: 10px;\n  font-weight: bold;\n  cursor: pointer;\n  background-color: rgba(255, 255, 255, 0.1);\n  border-radius: 5px 5px 0 0;\n  user-select: none;\n  pointer-events: auto;\n  display: flex;\n  align-items: center;\n}\n\n.tuning-settings .species-header:hover {\n  background-color: rgba(255, 255, 255, 0.15);\n}\n\n.tuning-settings .species-title {\n  flex: 1;\n}\n\n.tuning-settings .species-content {\n  padding: 10px;\n  pointer-events: auto;\n  box-sizing: border-box;\n  width: 100%;\n}\n\n.tuning-settings .setting-row {\n  display: flex;\n  align-items: center;\n  margin-bottom: 8px;\n  width: 100%;\n}\n\n.tuning-settings .setting-row label {\n  width: 150px;\n  text-align: left;\n  margin-right: 10px;\n  flex-shrink: 0;\n  line-height: 1.3;\n}\n\n.tuning-settings .setting-row input[type=\"range\"] {\n  width: 140px;\n  min-width: 100px;\n  max-width: 220px;\n  margin: 0 10px;\n}\n\n.tuning-settings .value-input {\n  width: 70px;\n  padding: 2px 4px;\n  border: 1px solid #ccc;\n  border-radius: 3px;\n  background: transparent;\n  color: inherit;\n  font-size: inherit;\n}\n\n.tuning-settings .value-input:focus {\n  outline: none;\n  border-color: #007bff;\n  box-shadow: 0 0 3px rgba(0, 123, 255, 0.3);\n}\n</style>","import script from \"./App.vue?vue&type=script&setup=true&lang=js\"\nexport * from \"./App.vue?vue&type=script&setup=true&lang=js\"\n\nimport \"./App.vue?vue&type=style&index=0&id=e5a2e81c&lang=css\"\n\nconst __exports__ = script;\n\nexport default __exports__","import { createApp } from 'vue';\r\nimport App from './App.vue';\r\n\r\n// SharedArrayBuffer  COOP/COEP  wasm \r\nconst publicBase = (process.env.BASE_URL || '/').replace(/\\/*$/, '/');\r\nconst wasmPublicBase = `${publicBase}static/js`;\r\nconst wasmJsUrl = `${wasmPublicBase}/wasm_boids.js`;\r\nconst wasmBinaryUrl = `${wasmPublicBase}/wasm_boids.wasm`;\r\n\r\nasync function bootstrap() {\r\n    try {\r\n        const BoidsModule = await import(/* webpackIgnore: true */ wasmJsUrl);\r\n        if (!BoidsModule?.default) {\r\n            throw new Error(`WASM module loader not found at: ${wasmJsUrl}`);\r\n        }\r\n\r\n        const Module = await BoidsModule.default({\r\n            locateFile: (path) => (path.endsWith('.wasm') ? wasmBinaryUrl : path),\r\n        });\r\n\r\n        // \r\n        if (typeof window !== 'undefined') {\r\n            window.wasmModule = Module;\r\n        }\r\n        console.log('Wasm module initialized:', Module);\r\n\r\n        const app = createApp(App);\r\n        app.provide('wasmModule', Module);\r\n        app.mount('#app');\r\n    } catch (error) {\r\n        console.error('Failed to initialise WASM module:', error);\r\n    }\r\n}\r\n\r\nbootstrap();","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n// expose the modules object (__webpack_modules__)\n__webpack_require__.m = __webpack_modules__;\n\n","var deferred = [];\n__webpack_require__.O = (result, chunkIds, fn, priority) => {\n\tif(chunkIds) {\n\t\tpriority = priority || 0;\n\t\tfor(var i = deferred.length; i > 0 && deferred[i - 1][2] > priority; i--) deferred[i] = deferred[i - 1];\n\t\tdeferred[i] = [chunkIds, fn, priority];\n\t\treturn;\n\t}\n\tvar notFulfilled = Infinity;\n\tfor (var i = 0; i < deferred.length; i++) {\n\t\tvar [chunkIds, fn, priority] = deferred[i];\n\t\tvar fulfilled = true;\n\t\tfor (var j = 0; j < chunkIds.length; j++) {\n\t\t\tif ((priority & 1 === 0 || notFulfilled >= priority) && Object.keys(__webpack_require__.O).every((key) => (__webpack_require__.O[key](chunkIds[j])))) {\n\t\t\t\tchunkIds.splice(j--, 1);\n\t\t\t} else {\n\t\t\t\tfulfilled = false;\n\t\t\t\tif(priority < notFulfilled) notFulfilled = priority;\n\t\t\t}\n\t\t}\n\t\tif(fulfilled) {\n\t\t\tdeferred.splice(i--, 1)\n\t\t\tvar r = fn();\n\t\t\tif (r !== undefined) result = r;\n\t\t}\n\t}\n\treturn result;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","// no baseURI\n\n// object to store loaded and loading chunks\n// undefined = chunk not loaded, null = chunk preloaded/prefetched\n// [resolve, reject, Promise] = chunk loading, 0 = chunk loaded\nvar installedChunks = {\n\t57: 0\n};\n\n// no chunk on demand loading\n\n// no prefetching\n\n// no preloaded\n\n// no HMR\n\n// no HMR manifest\n\n__webpack_require__.O.j = (chunkId) => (installedChunks[chunkId] === 0);\n\n// install a JSONP callback for chunk loading\nvar webpackJsonpCallback = (parentChunkLoadingFunction, data) => {\n\tvar [chunkIds, moreModules, runtime] = data;\n\t// add \"moreModules\" to the modules object,\n\t// then flag all \"chunkIds\" as loaded and fire callback\n\tvar moduleId, chunkId, i = 0;\n\tif(chunkIds.some((id) => (installedChunks[id] !== 0))) {\n\t\tfor(moduleId in moreModules) {\n\t\t\tif(__webpack_require__.o(moreModules, moduleId)) {\n\t\t\t\t__webpack_require__.m[moduleId] = moreModules[moduleId];\n\t\t\t}\n\t\t}\n\t\tif(runtime) var result = runtime(__webpack_require__);\n\t}\n\tif(parentChunkLoadingFunction) parentChunkLoadingFunction(data);\n\tfor(;i < chunkIds.length; i++) {\n\t\tchunkId = chunkIds[i];\n\t\tif(__webpack_require__.o(installedChunks, chunkId) && installedChunks[chunkId]) {\n\t\t\tinstalledChunks[chunkId][0]();\n\t\t}\n\t\tinstalledChunks[chunkId] = 0;\n\t}\n\treturn __webpack_require__.O(result);\n}\n\nvar chunkLoadingGlobal = self[\"webpackChunkwasm_boids\"] = self[\"webpackChunkwasm_boids\"] || [];\nchunkLoadingGlobal.forEach(webpackJsonpCallback.bind(null, 0));\nchunkLoadingGlobal.push = webpackJsonpCallback.bind(null, chunkLoadingGlobal.push.bind(chunkLoadingGlobal));","// startup\n// Load entry module and return exports\n// This entry module depends on other loaded chunks and execution need to be delayed\nvar __webpack_exports__ = __webpack_require__.O(undefined, [504], () => (__webpack_require__(15)))\n__webpack_exports__ = __webpack_require__.O(__webpack_exports__);\n"],"names":["emit","props","settings","editingCount","editingCohesion","editingCohesionRange","editingSeparation","editingSeparationRange","editingAlignment","editingAlignmentRange","editingMaxSpeed","editingMaxTurnAngle","editingMaxNeighbors","editingHorizontalTorque","editingTorqueStrength","editingLambda","editingTau","editingPredatorAlertRadius","countInput","cohesionInput","cohesionRangeInput","separationInput","separationRangeInput","alignmentInput","alignmentRangeInput","maxSpeedInput","maxTurnAngleInput","maxNeighborsInput","horizontalTorqueInput","torqueStrengthInput","lambdaInput","tauInput","predatorAlertRadiusInput","countDraft","count","async","startEditCount","value","focus","select","cancelCountEdit","applyCountDraft","nextValue","Math","max","round","Number","isFinite","commitCountFromSlider","commitCountFromInput","emitRemove","startEditCohesion","startEditCohesionRange","startEditSeparation","startEditSeparationRange","startEditAlignment","startEditAlignmentRange","startEditPredatorAlertRadius","startEditMaxSpeed","startEditMaxTurnAngle","startEditMaxNeighbors","startEditHorizontalTorque","startEditTorqueStrength","startEditLambda","startEditTau","stopEditCohesion","stopEditCohesionRange","stopEditSeparation","stopEditSeparationRange","stopEditAlignment","stopEditAlignmentRange","stopEditPredatorAlertRadius","stopEditMaxSpeed","stopEditMaxTurnAngle","stopEditMaxNeighbors","stopEditHorizontalTorque","stopEditTorqueStrength","stopEditLambda","stopEditTau","__exports__","BoidInstancing","constructor","tailAnimation","tripleBufferSize","hiddenPosition","identityQuaternion","lodNearDistanceSq","lodMidDistanceSq","this","streamUsage","scene","instancedMeshHigh","instancedMeshLow","instancingMaterials","Set","bufferSetHigh","bufferSetLow","tailPhaseSeeds","bufferCursor","previousVelocities","previousLodFlags","predatorModel","predatorMeshes","predatorMeshCountCache","init","boidModel","boidModelLod","highMaterial","lowMaterial","console","error","children","length","geometry","dispose","highMaterialClone","clone","lowMaterialClone","patchMaterial","highGeometry","lowGeometry","ensureBodyCoordAttribute","configureInstancedMesh","add","createBufferSet","resetBufferSetToHidden","createTailPhaseArray","applyTailPhaseSeeds","applyBufferSet","instanceMatrix","setUsage","ensurePredatorMeshes","update","positions","orientations","velocities","cameraPosition","predatorCount","visibleCount","lodFlags","currentIndex","nextIndex","ensureTailRuntimeBuffers","ensureTailSeedCapacity","ensureLodFlagBuffer","highPosAttr","pos","highQuatAttr","quat","highTailParamsAttr","tailParams","highTailPhaseAttr","tailPhase","lowPosAttr","lowQuatAttr","lowTailParamsAttr","lowTailPhaseAttr","highPosArray","array","highQuatArray","highTailParamsArray","highTailPhaseArray","lowPosArray","lowQuatArray","lowTailParamsArray","lowTailPhaseArray","highTransformTouched","lowTransformTouched","highTailTouched","lowTailTouched","highTailPhaseTouched","lowTailPhaseTouched","camX","x","camY","y","camZ","z","predatorStartIndex","mesh","visible","prevVel","tailSeeds","highWrite","lowWrite","highInstanceToBoid","Uint32Array","lowInstanceToBoid","i","basePos","baseQuat","px","py","pz","qx","qy","qz","qw","predatorLocalIndex","predatorMesh","position","set","quaternion","dx","dy","dz","distSq","isNear","isMid","animateTail","vx","vy","vz","speed","hypot","prevVx","prevVy","prevVz","prevLen","turnAmount","crossY","dot","atan2","tailSpeedValue","tailTurnValue","driveValue","writeIndex","outPos","outQuat","outTail","seedValue","needsUpdate","highCount","lowCount","forEachInstancingMaterial","callback","material","getMeshes","high","low","getPredatorMeshes","setTailUniformTime","time","uniforms","uTailTime","userData","instancingPatched","warn","onBeforeCompile","shader","Object","entries","forEach","key","uniform","vertexShader","replace","createDepthMaterial","sourceMaterial","depthMaterial","depthPacking","alphaTest","map","alphaMap","transparent","createDistanceMaterial","distanceMaterial","castShadow","receiveShadow","frustumCulled","customDepthMaterial","customDistanceMaterial","white","setColorAt","instanceColor","createAttributeSet","itemSize","ArrayType","Float32Array","attributes","attr","push","bufferSet","fill","index","setAttribute","random","PI","seeds","targetLength","Uint8Array","currentLength","next","subarray","getAttribute","minX","Infinity","minY","minZ","maxX","maxY","maxZ","ix","rangeX","rangeY","rangeZ","axis","min","range","bodyCoord","denom","target","pop","remove","traverse","child","isMesh","clear","FogPipeline","fogConfig","config","composer","heightFogPass","heightFogRenderTarget","renderer","camera","heightFog","width","height","rtOptions","depthBuffer","stencilBuffer","depthTexture","format","type","EffectComposer","renderPass","RenderPass","addPass","ssaoPass","SSAOPass","kernelRadius","minDistance","maxDistance","bloomStrength","bloomRadius","bloomThreshold","bloomPass","UnrealBloomPass","createHeightFogShader","ShaderPass","originalRender","render","bind","passRenderer","writeBuffer","readBuffer","deltaTime","maskActive","tDepth","needsSwap","applyFogConfigToUniforms","depthTest","depthWrite","blending","toneMapped","renderToScreen","resize","setSize","delta","isReady","updateCameraUniforms","pass","targetCamera","cameraNear","near","cameraFar","far","projectionMatrixInverse","copy","cameraMatrixWorld","matrixWorld","updateConfig","nextConfig","defaults","buildFogDefaults","finalConfig","tDiffuse","fogColor","cloneColor","color","distanceStart","distanceEnd","distanceExponent","distanceControlPoint1","cloneVector2","distanceControlPoint2","surfaceLevel","heightFalloff","heightExponent","maxOpacity","fragmentShader","PARTICLE_BASE_SPREAD_DESKTOP","PARTICLE_BASE_SPREAD_MOBILE","PARTICLE_BASE_MAX_DISTANCE_DESKTOP","PARTICLE_BASE_MAX_DISTANCE_MOBILE","FLOW_TILT_DEGREES","DEFAULT_FLOW_DIR","cos","degToRad","sin","DEFAULT_LAT1","DEFAULT_LAT2","TEMP_DIR","TEMP_AXIS","TEMP_LAT1","TEMP_LAT2","ParticleField","isMobileDevice","Boolean","controls","particlePoints","particleMaterial","elapsedTime","capabilities","isWebGL2","setDrawRange","baseSpread","baseMaxDistance","glslVersion","uTime","uOrigin","uFlowDir","uLat1","uLat2","uSpread","uMaxDistance","uBaseSpeed","uJitterAmp","uSizePx","uFadeNear","uFadeFar","uColorNear","uColorFar","PARTICLE_VERTEX_SHADER","PARTICLE_FRAGMENT_SHADER","baseTargetDistance","distanceTo","renderOrder","setWorldBasis","setTime","timeSeconds","advanceTime","deltaSeconds","flowDir","dir","normalize","abs","lat1","cross","lengthSq","lat2","targetScene","getMaterial","WasmtimeBridge","wasmModule","Error","wasm","latestStatePtr","latestStateHeaderPtr","latestStateHeaderView","latestPositionsPtr","latestVelocitiesPtr","latestOrientationsPtr","latestBoidCount","cachedHeapBuffer","cachedPositionsPtr","cachedOrientationsPtr","cachedVelocitiesPtr","cachedSpeciesIdsPtr","cachedPositionsView","cachedOrientationsView","cachedVelocitiesView","cachedSpeciesIdsView","cachedPositionsCount","cachedOrientationsCount","cachedVelocitiesCount","cachedSpeciesIdsCount","cachedSpeciesIdsBuffer","stepSimulationHandle","createWrappedFunction","buildHandle","exportTreeStructureHandle","boidUnitMappingPtrHandle","currentFirstBoidXHandle","speciesIdsPtrHandle","syncReadToWriteBuffersHandle","getSimulationTuningParamsHandle","setSimulationTuningParamsHandle","getSimulationTuningParams","handle","ensureHandle","setSimulationTuningParams","params","toNumber","fallback","num","threatDecay","threatGain","maxEscapeWeight","baseEscapeStrength","escapeStrengthPerThreat","cohesionBoost","separationMinFactor","alignmentBoost","buildSpeciesParams","Array","isArray","vector","VectorSpeciesParams","raw","push_back","species","floor","speciesId","cohesion","separation","alignment","maxSpeed","minSpeed","maxTurnAngle","separationRange","alignmentRange","cohesionRange","maxNeighbors","lambda","tau","horizontalTorque","velocityEpsilon","torqueStrength","bodyHeadLength","bodyTailLength","bodyRadius","predatorAlertRadius","isPredator","stepSimulation","dt","statePtr","heapU8Buffer","HEAPU8","buffer","DataView","getUint32","getInt32","getBuffers","speciesIds","Int32Array","heapBuffer","HEAPF32","heapBufferI32","HEAP32","speciesPtr","captureState","currentCount","restoreState","previousState","oldSettings","newSettings","prevPositions","prevVelocities","prevOrientations","oldRanges","buildSpeciesRanges","newRanges","oldRangeMap","Map","info","name","restored","newInfo","oldInfo","get","transferable","srcIndex","start","dstIndex","srcPosBase","dstPosBase","srcVelBase","dstVelBase","srcOriBase","dstOriBase","syncReadToWriteBuffers","buildSpatialIndex","arg0","arg1","exportTreeStructure","currentFirstBoidX","getUnitMappings","ptr","returnType","argTypes","cwrap","list","ranges","offset","item","STORAGE_KEY","DEFAULT_SPECIES_FALLBACK","createFlockSettingsStore","defaultSettings","defaultSystem","defaultTemplates","sanitizeSpeciesList","systemDefaults","systemSettings","replaceSettings","assignSystemSettings","loadFromStorage","totalBoids","getTotalBoidCount","localStorage","saved","getItem","parsed","JSON","parse","system","saveToStorage","snapshot","entry","setItem","stringify","nextList","sanitized","splice","patch","merged","keys","resetToDefaults","addSpecies","template","basePool","fallbackTemplate","find","candidate","sanitizeSpeciesEntry","cloneSpeciesTemplate","ensureUniqueName","s","removeSpecies","removed","reduce","sum","fallbackList","takenNames","clean","base","toFinite","fallbackValue","result","speciesName","trim","taken","defaultName","has","FRAME_INTERVAL","COUNT_REINIT_DELAY_MS","TRIPLE_BUFFER_SIZE","HIDDEN_POSITION","SIN_LUT_SIZE","wasmBridge","detectDeviceProfile","profile","isMobile","hasIntegratedGpu","navigator","test","userAgent","canvas","document","createElement","gl","getContext","debugInfo","getExtension","getParameter","UNMASKED_RENDERER_WEBGL","log","window","readLbvhStats","getLbvhQueryStatsSnapshot","deviceProfile","useLowSpecPreset","mobileBoidCount","DEFAULT_SETTINGS","DEFAULT_TUNING_SETTINGS","antiMillGain","flockStore","syncSystemSettings","addSpeciesFromStore","removeSpeciesFromStore","tuningInitialized","sanitizeTuningParams","updateSystemSettings","newValues","payload","applySystemSettingsToWasm","snapshotSettingsList","cachedTotalBoidCount","lastSpeciesSignature","getSpeciesSignature","previousSettingsSnapshot","pendingStateForReinitialize","pendingSettingsSnapshot","applySettingsSnapshot","added","threeContainer","backgroundAudio","fogPipeline","particleField","paused","showUnits","showUnitSpheres","showUnitLines","showUnitColors","unitLayer","unitSpheres","unitLines","stats","glContext","frameCounter","flockReinitTimer","animationTimer","positionStatsOverlay","element","style","top","right","left","bottom","zIndex","pointerEvents","transform","handleKeydown","e","code","initThreeJS","innerWidth","innerHeight","background","OCEAN_COLORS","DEEP_BLUE","createOceanSphere","lookAt","antialias","depth","toneMapping","toneMappingExposure","setPixelRatio","devicePixelRatio","shadowMap","enabled","appendChild","domElement","aspect","updateProjectionMatrix","OrbitControls","enableDamping","dampingFactor","groundGeo","groundMat","createFadeOutGroundMaterial","ground","rotation","ambientLight","toHex","AMBIENT_LIGHT","dirLight","SUN_LIGHT","shadow","mapSize","bias","normalBias","initParticleSystem","heightFogConfig","addEventListener","onWindowResize","createSinCosLutTexture","size","data","angle","sinValue","cosValue","texture","wrapS","wrapT","magFilter","minFilter","generateMipmaps","flipY","IDENTITY_QUATERNION","sinCosLutTexture","LOD_DISTANCE_PRESET","nearSq","midSq","LOD_NEAR_DISTANCE_SQ","LOD_MID_DISTANCE_SQ","uTailAmplitude","uTailFrequency","uTailPhaseStride","uTailTurnStrength","uTailSpeedScale","uTailRight","uTailForward","uTailUp","uTailEnable","uSinLut","uLutSize","boidInstancing","SKY_HIGHLIGHT","SKY_BLUE","SEAFLOOR","FOG","SIDE_LIGHT1","SIDE_LIGHT2","BOTTOM_LIGHT","colorStr","parseInt","context","gradient","createLinearGradient","addColorStop","fillStyle","fillRect","colorSpace","sphereGeo","sphereMat","side","fog","oceanSphere","textureLoader","load","roughness","metalness","updateInstancingMaterialUniforms","shaderTime","updateParticleUniforms","initBackgroundAudioPlayback","audioEl","volume","loop","tryPlay","playResult","play","then","catch","resume","removeEventListener","once","stepSimulationAndUpdateState","getWasmViews","captureFlockState","restoreFlockState","originalMaterial","originalMaterialLod","predatorMaterial","lastShowUnitColors","getPredatorCount","specList","join","createSpeciesParamsVector","rawSettings","source","from","reinitializeFlockNow","pendingState","state","oldSettingsRef","newSettingsRef","targetSignature","callInitBoids","delete","total","initInstancedBoids","scheduleFlockReinitialize","clearTimeout","setTimeout","initialized","meshes","loadBoidModel","loader","GLTFLoader","pendingAssets","notifyReady","undefined","textureLod","predatorTexture","boidMaterial","vertexColors","vertexColor","boidLodMaterial","gltf","clearUnitVisuals","line","lastTime","performance","now","animate","begin","currentTime","pipelineReady","end","updateInfo","unitMappings","highMap","lowMap","inst","boidIndex","unitId","j","setHSL","whiteColor","startSimulation","resetSettings","presetList","trackGPU","trackHz","trackCPT","logsPerSecond","graphsPerSecond","samplesLog","samplesGraph","precision","horizontal","minimal","mode","statsInitTarget","body","ensureStatsOverlay","statsElement","getDom","dom","container","wrapper","parentElement","initPromise","Promise","resolve","patchThreeRenderer","deep","setGlobalSpeciesParamsFromJS","signature","predators","newValue","newSpheres","newLines","publicBase","wasmPublicBase","wasmJsUrl","wasmBinaryUrl","bootstrap","BoidsModule","import","default","Module","locateFile","path","endsWith","app","App","provide","mount","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","exports","module","__webpack_modules__","m","deferred","O","chunkIds","fn","priority","notFulfilled","fulfilled","every","r","d","definition","o","defineProperty","enumerable","g","globalThis","Function","obj","prop","prototype","hasOwnProperty","call","installedChunks","chunkId","webpackJsonpCallback","parentChunkLoadingFunction","moreModules","runtime","some","id","chunkLoadingGlobal","self","__webpack_exports__"],"sourceRoot":""}