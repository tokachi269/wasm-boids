(()=>{var e={450:(e,n,t)=>{e.exports=t.p+"251ebe2bd418f718.wasm"},466:(e,n,t)=>{var a=t(751),o=t(641),l=t(33),i=t(953),r=t(922),s=t(437),u=t(24);const c={class:"settings"},d={class:"species-section",open:!1},p={class:"species-header"},m={class:"species-content"},v={class:"setting-row"},f={class:"setting-row"},g={class:"setting-row"},b={class:"setting-row"},h={class:"setting-row"},y={class:"setting-row"},w={class:"setting-row"},k={class:"setting-row"},x={class:"setting-row"},T={class:"setting-row"},S={class:"setting-row"},R={class:"setting-row"},L={class:"setting-row"},C={class:"setting-row"},_={class:"setting-row"},P={class:"setting-row"},A={__name:"Settings",props:{settings:{type:Object,required:!0}},setup(e){const n=(0,i.KR)(!1),t=(0,i.KR)(!1),r=(0,i.KR)(!1),s=(0,i.KR)(!1),u=(0,i.KR)(!1),A=(0,i.KR)(!1),E=(0,i.KR)(!1),U=(0,i.KR)(!1),W=(0,i.KR)(!1),q=(0,i.KR)(!1),K=(0,i.KR)(!1),X=(0,i.KR)(!1),j=(0,i.KR)(!1),Q=(0,i.KR)(!1),M=(0,i.KR)(null),V=(0,i.KR)(null),F=(0,i.KR)(null),I=(0,i.KR)(null),B=(0,i.KR)(null),J=(0,i.KR)(null),O=(0,i.KR)(null),z=(0,i.KR)(null),Y=(0,i.KR)(null),D=(0,i.KR)(null),N=(0,i.KR)(null),H=(0,i.KR)(null),G=(0,i.KR)(null),Z=(0,i.KR)(null);async function $(){n.value=!0,await(0,o.dY)(),M.value&&(M.value.focus(),M.value.select())}async function ee(){t.value=!0,await(0,o.dY)(),V.value&&(V.value.focus(),V.value.select())}async function ne(){r.value=!0,await(0,o.dY)(),F.value&&(F.value.focus(),F.value.select())}async function te(){s.value=!0,await(0,o.dY)(),I.value&&(I.value.focus(),I.value.select())}async function ae(){u.value=!0,await(0,o.dY)(),B.value&&(B.value.focus(),B.value.select())}async function oe(){A.value=!0,await(0,o.dY)(),J.value&&(J.value.focus(),J.value.select())}async function le(){E.value=!0,await(0,o.dY)(),O.value&&(O.value.focus(),O.value.select())}async function ie(){U.value=!0,await(0,o.dY)(),z.value&&(z.value.focus(),z.value.select())}async function re(){W.value=!0,await(0,o.dY)(),Y.value&&(Y.value.focus(),Y.value.select())}async function se(){q.value=!0,await(0,o.dY)(),D.value&&(D.value.focus(),D.value.select())}async function ue(){K.value=!0,await(0,o.dY)(),N.value&&(N.value.focus(),N.value.select())}async function ce(){X.value=!0,await(0,o.dY)(),H.value&&(H.value.focus(),H.value.select())}async function de(){j.value=!0,await(0,o.dY)(),G.value&&(G.value.focus(),G.value.select())}async function pe(){Q.value=!0,await(0,o.dY)(),Z.value&&(Z.value.focus(),Z.value.select())}function me(){n.value=!1}function ve(){t.value=!1}function fe(){r.value=!1}function ge(){s.value=!1}function be(){u.value=!1}function he(){A.value=!1}function ye(){E.value=!1}function we(){U.value=!1}function ke(){W.value=!1}function xe(){q.value=!1}function Te(){K.value=!1}function Se(){X.value=!1}function Re(){j.value=!1}function Le(){Q.value=!1}return(i,Ce)=>((0,o.uX)(),(0,o.CE)("div",c,[(0,o.Lk)("details",d,[(0,o.Lk)("summary",p,(0,l.v_)(e.settings.species)+" ("+(0,l.v_)(e.settings.count)+"匹) ",1),(0,o.Lk)("div",m,[(0,o.Lk)("div",v,[Ce[29]||(Ce[29]=(0,o.Lk)("label",null,[(0,o.eW)("種族名"),(0,o.Lk)("br"),(0,o.eW)("(Species):")],-1)),(0,o.Lk)("span",null,(0,l.v_)(e.settings.species),1)]),(0,o.Lk)("div",f,[Ce[30]||(Ce[30]=(0,o.Lk)("label",null,[(0,o.eW)("群れの数(要更新)"),(0,o.Lk)("br"),(0,o.eW)("(Count):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[0]||(Ce[0]=n=>e.settings.count=n),min:"0",max:"50000",step:"1"},null,512),[[a.Jo,e.settings.count,void 0,{number:!0}]]),n.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:$,title:"クリックして編集"},(0,l.v_)(e.settings.count),1)),n.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[1]||(Ce[1]=n=>e.settings.count=n),min:"0",max:"20000",class:"value-input",onBlur:me,onKeyup:(0,a.jR)(me,["enter"]),ref_key:"countInput",ref:M},null,544)),[[a.Jo,e.settings.count,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",g,[Ce[31]||(Ce[31]=(0,o.Lk)("label",null,[(0,o.eW)("凝集"),(0,o.Lk)("br"),(0,o.eW)("(Cohesion):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[2]||(Ce[2]=n=>e.settings.cohesion=n),min:"0",max:"40",step:"0.01"},null,512),[[a.Jo,e.settings.cohesion,void 0,{number:!0}]]),t.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ee,title:"クリックして編集"},(0,l.v_)(e.settings.cohesion),1)),t.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[3]||(Ce[3]=n=>e.settings.cohesion=n),min:"0",max:"40",step:"0.01",class:"value-input",onBlur:ve,onKeyup:(0,a.jR)(ve,["enter"]),ref_key:"cohesionInput",ref:V},null,544)),[[a.Jo,e.settings.cohesion,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",b,[Ce[32]||(Ce[32]=(0,o.Lk)("label",null,[(0,o.eW)("凝集範囲"),(0,o.Lk)("br"),(0,o.eW)("(Cohesion Range):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[4]||(Ce[4]=n=>e.settings.cohesionRange=n),min:"1",max:"300",step:"1"},null,512),[[a.Jo,e.settings.cohesionRange,void 0,{number:!0}]]),r.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ne,title:"クリックして編集"},(0,l.v_)(e.settings.cohesionRange),1)),r.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[5]||(Ce[5]=n=>e.settings.cohesionRange=n),min:"1",max:"300",step:"1",class:"value-input",onBlur:fe,onKeyup:(0,a.jR)(fe,["enter"]),ref_key:"cohesionRangeInput",ref:F},null,544)),[[a.Jo,e.settings.cohesionRange,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",h,[Ce[33]||(Ce[33]=(0,o.Lk)("label",null,[(0,o.eW)("分離"),(0,o.Lk)("br"),(0,o.eW)("(Separation):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[6]||(Ce[6]=n=>e.settings.separation=n),min:"0",max:"10",step:"0.01"},null,512),[[a.Jo,e.settings.separation,void 0,{number:!0}]]),s.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:te,title:"クリックして編集"},(0,l.v_)(e.settings.separation),1)),s.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[7]||(Ce[7]=n=>e.settings.separation=n),min:"0",max:"10",step:"0.01",class:"value-input",onBlur:ge,onKeyup:(0,a.jR)(ge,["enter"]),ref_key:"separationInput",ref:I},null,544)),[[a.Jo,e.settings.separation,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",y,[Ce[34]||(Ce[34]=(0,o.Lk)("label",null,[(0,o.eW)("分離範囲"),(0,o.Lk)("br"),(0,o.eW)("(Separation Range):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[8]||(Ce[8]=n=>e.settings.separationRange=n),min:"0.1",max:"10",step:"0.1"},null,512),[[a.Jo,e.settings.separationRange,void 0,{number:!0}]]),u.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ae,title:"クリックして編集"},(0,l.v_)(e.settings.separationRange),1)),u.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[9]||(Ce[9]=n=>e.settings.separationRange=n),min:"0.1",max:"10",step:"0.1",class:"value-input",onBlur:be,onKeyup:(0,a.jR)(be,["enter"]),ref_key:"separationRangeInput",ref:B},null,544)),[[a.Jo,e.settings.separationRange,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),Ce[45]||(Ce[45]=(0,o.eW)()),(0,o.Lk)("div",w,[Ce[35]||(Ce[35]=(0,o.Lk)("label",null,[(0,o.eW)("整列"),(0,o.Lk)("br"),(0,o.eW)("(Alignment):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[10]||(Ce[10]=n=>e.settings.alignment=n),min:"0",max:"20",step:"0.01"},null,512),[[a.Jo,e.settings.alignment,void 0,{number:!0}]]),A.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:oe,title:"クリックして編集"},(0,l.v_)(e.settings.alignment),1)),A.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[11]||(Ce[11]=n=>e.settings.alignment=n),min:"0",max:"20",step:"0.01",class:"value-input",onBlur:he,onKeyup:(0,a.jR)(he,["enter"]),ref_key:"alignmentInput",ref:J},null,544)),[[a.Jo,e.settings.alignment,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",k,[Ce[36]||(Ce[36]=(0,o.Lk)("label",null,[(0,o.eW)("整列範囲"),(0,o.Lk)("br"),(0,o.eW)("(Alignment Range):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[12]||(Ce[12]=n=>e.settings.alignmentRange=n),min:"1",max:"100",step:"1"},null,512),[[a.Jo,e.settings.alignmentRange,void 0,{number:!0}]]),E.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:le,title:"クリックして編集"},(0,l.v_)(e.settings.alignmentRange),1)),E.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[13]||(Ce[13]=n=>e.settings.alignmentRange=n),min:"1",max:"100",step:"1",class:"value-input",onBlur:ye,onKeyup:(0,a.jR)(ye,["enter"]),ref_key:"alignmentRangeInput",ref:O},null,544)),[[a.Jo,e.settings.alignmentRange,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",x,[Ce[37]||(Ce[37]=(0,o.Lk)("label",null,[(0,o.eW)("最大速度"),(0,o.Lk)("br"),(0,o.eW)("(Max Speed):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[14]||(Ce[14]=n=>e.settings.maxSpeed=n),min:"0.1",max:"2",step:"0.01"},null,512),[[a.Jo,e.settings.maxSpeed,void 0,{number:!0}]]),U.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ie,title:"クリックして編集"},(0,l.v_)(e.settings.maxSpeed),1)),U.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[15]||(Ce[15]=n=>e.settings.maxSpeed=n),min:"0.1",max:"2",step:"0.01",class:"value-input",onBlur:we,onKeyup:(0,a.jR)(we,["enter"]),ref_key:"maxSpeedInput",ref:z},null,544)),[[a.Jo,e.settings.maxSpeed,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),Ce[46]||(Ce[46]=(0,o.eW)()),(0,o.Lk)("div",T,[Ce[38]||(Ce[38]=(0,o.Lk)("label",null,[(0,o.eW)("最大旋回角"),(0,o.Lk)("br"),(0,o.eW)("(Max Turn Angle):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[16]||(Ce[16]=n=>e.settings.maxTurnAngle=n),min:"0.001",max:"0.3",step:"0.001"},null,512),[[a.Jo,e.settings.maxTurnAngle,void 0,{number:!0}]]),W.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:re,title:"クリックして編集"},(0,l.v_)(e.settings.maxTurnAngle),1)),W.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[17]||(Ce[17]=n=>e.settings.maxTurnAngle=n),min:"0.001",max:"0.3",step:"0.001",class:"value-input",onBlur:ke,onKeyup:(0,a.jR)(ke,["enter"]),ref_key:"maxTurnAngleInput",ref:Y},null,544)),[[a.Jo,e.settings.maxTurnAngle,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",S,[Ce[39]||(Ce[39]=(0,o.Lk)("label",null,[(0,o.eW)("最大近傍数"),(0,o.Lk)("br"),(0,o.eW)("(Max Neighbors):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[18]||(Ce[18]=n=>e.settings.maxNeighbors=n),min:"0",max:"32",step:"1"},null,512),[[a.Jo,e.settings.maxNeighbors,void 0,{number:!0}]]),q.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:se,title:"クリックして編集"},(0,l.v_)(e.settings.maxNeighbors),1)),q.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[19]||(Ce[19]=n=>e.settings.maxNeighbors=n),min:"0",max:"32",step:"1",class:"value-input",onBlur:xe,onKeyup:(0,a.jR)(xe,["enter"]),ref_key:"maxNeighborsInput",ref:D},null,544)),[[a.Jo,e.settings.maxNeighbors,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",R,[Ce[40]||(Ce[40]=(0,o.Lk)("label",null,[(0,o.eW)("水平化トルク"),(0,o.Lk)("br"),(0,o.eW)("(Horizontal Torque):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[20]||(Ce[20]=n=>e.settings.horizontalTorque=n),min:"0.0",max:"0.2",step:"0.001"},null,512),[[a.Jo,e.settings.horizontalTorque,void 0,{number:!0}]]),K.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ue,title:"クリックして編集"},(0,l.v_)(e.settings.horizontalTorque),1)),K.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[21]||(Ce[21]=n=>e.settings.horizontalTorque=n),min:"0.0",max:"0.2",step:"0.001",class:"value-input",onBlur:Te,onKeyup:(0,a.jR)(Te,["enter"]),ref_key:"horizontalTorqueInput",ref:N},null,544)),[[a.Jo,e.settings.horizontalTorque,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",L,[Ce[41]||(Ce[41]=(0,o.Lk)("label",null,[(0,o.eW)("回転トルク強度"),(0,o.Lk)("br"),(0,o.eW)("(Torque Strength):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[22]||(Ce[22]=n=>e.settings.torqueStrength=n),min:"0.0",max:"20",step:"0.001"},null,512),[[a.Jo,e.settings.torqueStrength,void 0,{number:!0}]]),X.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ce,title:"クリックして編集"},(0,l.v_)(e.settings.torqueStrength),1)),X.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[23]||(Ce[23]=n=>e.settings.torqueStrength=n),min:"0.0",max:"5",step:"0.001",class:"value-input",onBlur:Se,onKeyup:(0,a.jR)(Se,["enter"]),ref_key:"torqueStrengthInput",ref:H},null,544)),[[a.Jo,e.settings.torqueStrength,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",C,[Ce[42]||(Ce[42]=(0,o.Lk)("label",null,[(0,o.eW)("減衰係数"),(0,o.Lk)("br"),(0,o.eW)("(Damping Coefficient):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[24]||(Ce[24]=n=>e.settings.lambda=n),min:"0",max:"1",step:"0.001"},null,512),[[a.Jo,e.settings.lambda,void 0,{number:!0}]]),j.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:de,title:"クリックして編集"},(0,l.v_)(e.settings.lambda),1)),j.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[25]||(Ce[25]=n=>e.settings.lambda=n),min:"0",max:"1",step:"0.001",class:"value-input",onBlur:Re,onKeyup:(0,a.jR)(Re,["enter"]),ref_key:"lambdaInput",ref:G},null,544)),[[a.Jo,e.settings.lambda,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",_,[Ce[43]||(Ce[43]=(0,o.Lk)("label",null,[(0,o.eW)("記憶時間"),(0,o.Lk)("br"),(0,o.eW)("(Memory Time):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Ce[26]||(Ce[26]=n=>e.settings.tau=n),min:"0",max:"5",step:"0.01"},null,512),[[a.Jo,e.settings.tau,void 0,{number:!0}]]),Q.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:pe,title:"クリックして編集"},(0,l.v_)(e.settings.tau),1)),Q.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Ce[27]||(Ce[27]=n=>e.settings.tau=n),min:"0",max:"5",step:"0.01",class:"value-input",onBlur:Le,onKeyup:(0,a.jR)(Le,["enter"]),ref_key:"tauInput",ref:Z},null,544)),[[a.Jo,e.settings.tau,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",P,[Ce[44]||(Ce[44]=(0,o.Lk)("label",null,[(0,o.eW)("捕食者フラグ"),(0,o.Lk)("br"),(0,o.eW)("(Is Predator):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":Ce[28]||(Ce[28]=n=>e.settings.isPredator=n)},null,512),[[a.lH,e.settings.isPredator]]),(0,o.Lk)("span",null,(0,l.v_)(e.settings.isPredator),1)])])])]))}};var E=t(262);const U=(0,E.A)(A,[["__scopeId","data-v-e35dcab8"]]),W=U;var q=t(777),K=t(540),X=t(804),j=t(741),Q=t(579),M=t(763);const V={id:"app"},F={class:"ui-overlay"},I={style:{"margin-left":"1em"}},B={style:{"margin-left":"1em"}},J={style:{"margin-left":"1em"}},O={style:{"margin-left":"1em"}},z={class:"info"},Y=1,D=3,N=1e6,H=4,G=25,Z={__name:"App",setup(e){const n=(0,o.WQ)("wasmModule");n||console.error("wasmModule not provided");const t=n.cwrap("stepSimulation","number",["number"]),c=n.cwrap("build","void",["number","number"]),d=n.cwrap("setFlockSize","void",["number","number","number"]),p=(n.cwrap("exportTreeStructure","object",[]),n.cwrap("boidUnitMappingPtr","number",[])),m=n.cwrap("currentFirstBoidX","number",[]);const v=yn()?6e3:1e4,f=[{species:"Boids",count:v,cohesion:32,cohesionRange:30,separation:8,separationRange:.6,alignment:17,alignmentRange:6,maxSpeed:.26,maxTurnAngle:.25,maxNeighbors:6,horizontalTorque:.019,torqueStrength:10,lambda:.62,tau:1.5},{species:"Predator",count:1,cohesion:5.58,separation:0,alignment:0,maxSpeed:1.37,minSpeed:.4,maxTurnAngle:.2,separationRange:14,alignmentRange:11,cohesionRange:77,maxNeighbors:0,lambda:.05,tau:1,horizontalTorque:.022,torqueStrength:0,isPredator:!0}];function g(){try{const e=localStorage.getItem("boids_settings");if(e){const n=JSON.parse(e);if(Array.isArray(n))return n}}catch(e){console.error("Failed to load settings from localStorage:",e)}return f}const b=(0,i.Kh)(g());let h=pn();const y=(0,o.EW)((()=>pn())),w=(0,i.KR)(null);let k,x,T,S,R;const L=(0,i.KR)(!1),C=(0,i.KR)(!0),_=(0,i.KR)(!1),P=(0,i.KR)(!1),A=(0,i.KR)(!1),E=(0,i.KR)(1);let U=[],Z=[],$=null,ee=null,ne=null,te=null,ae=null,oe=null,le=0,ie=0,re=0,se=null,ue=0,ce=0,de=0,pe=0,me=0,ve=null;function fe(e){"Space"===e.code&&(L.value=!L.value)}function ge(){const e=window.innerWidth,n=window.innerHeight;k=new r.Z58,k.background=new r.Q1f(1651285),k.fog=new r.jUj(1651285,0,28);const t=new r.Gu$(500,32,32),a=new r.V9B({color:1057085,side:r.hsX}),o=new r.eaF(t,a);k.add(o),x=new r.ubm(75,e/n,.1,1e3),x.position.set(4,7,7),x.lookAt(0,0,0),T=new s.JeP({antialias:!0,depth:!0}),T.setPixelRatio(window.devicePixelRatio),T.setSize(e,n),T.shadowMap.enabled=!0,T.shadowMap.type=r.Wk7,ne=T.getContext(),"undefined"!==typeof WebGL2RenderingContext&&ne instanceof WebGL2RenderingContext?(te=ne.getExtension("EXT_disjoint_timer_query_webgl2"),te||console.warn("EXT_disjoint_timer_query_webgl2 is not available; GPU timing disabled.")):te=null,w.value.appendChild(T.domElement),x.aspect=e/n,x.updateProjectionMatrix(),S=new u.N(x,T.domElement),S.enableDamping=!0,S.dampingFactor=.1;const l=new r.bdM(1e3,1e3),i=new r._4j({color:1585232,roughness:.8,depthTest:!0}),c=new r.eaF(l,i);c.rotation.x=-Math.PI/2,c.position.y=-10,c.receiveShadow=!0,k.add(c);const d=new r.$p8(10663892,1);k.add(d);const p=new r.ZyN(8955343,15);if(p.position.set(300,500,200),p.castShadow=!0,p.shadow.camera.left=-100,p.shadow.camera.right=100,p.shadow.camera.top=100,p.shadow.camera.bottom=-100,p.shadow.camera.near=1,p.shadow.camera.far=1e3,p.shadow.mapSize.width=2048,p.shadow.mapSize.height=2048,p.shadow.bias=-.001,p.shadow.normalBias=.01,k.add(p),!yn()){R=new K.s(T);const t=new X.A(k,x);R.addPass(t);const a=new j.C(k,x,e,n);a.kernelRadius=8,a.minDistance=.001,a.maxDistance=.01,R.addPass(a);const o=new Q.C(new r.I9Y(e,n),1.5,.4,.85);R.addPass(o)}window.addEventListener("resize",be)}function be(){const e=window.innerWidth,n=window.innerHeight;x.aspect=e/n,x.updateProjectionMatrix(),T.setSize(e,n)}let he=null,ye=null;const we=new Set,ke=[0,0,0,1],xe=r.Ktl??r.Vnu,Te={uniforms:{uTailTime:{value:0},uTailAmplitude:{value:.14},uTailFrequency:{value:10},uTailPhaseStride:{value:5},uTailTurnStrength:{value:.1},uTailSpeedScale:{value:1},uTailRight:{value:new r.Pq0(1,0,0)},uTailForward:{value:new r.Pq0(0,0,1)},uTailUp:{value:new r.Pq0(0,1,0)},uTailEnable:{value:1}}};function Se(e){Te.uniforms.uTailTime.value=e}let Re=0,Le=null,Ce=null,_e=null,Pe=0,Ae=0,Ee=null,Ue=null,We=0,qe=0,Ke=0,Xe=0,je=null,Qe=0,Me=null,Ve=null;function Fe(e,n){const t=e*n,a=[];for(let o=0;o<D;o++){const e=new r.uWO(new Float32Array(t),n);e.setUsage(xe),a.push(e)}return a}function Ie(e){return{pos:Fe(e,3),quat:Fe(e,4),tailPhase:Fe(e,1),tailSpeed:Fe(e,1),tailTurn:Fe(e,1),tailDrive:Fe(e,1)}}function Be(e){for(const n of e.pos){const e=n.array;for(let n=0;n<e.length;n+=3)e[n]=N,e[n+1]=N,e[n+2]=N}for(const n of e.quat){const e=n.array;for(let n=0;n<e.length;n+=4)e[n]=0,e[n+1]=0,e[n+2]=0,e[n+3]=1}for(const n of e.tailPhase)n.array.fill(0);for(const n of e.tailSpeed)n.array.fill(0);for(const n of e.tailTurn)n.array.fill(0);for(const n of e.tailDrive)n.array.fill(0)}function Je(e,n,t){e.geometry.setAttribute("instancePos",n.pos[t]),e.geometry.setAttribute("instanceQuat",n.quat[t]),e.geometry.setAttribute("instanceTailPhase",n.tailPhase[t]),e.geometry.setAttribute("instanceTailSpeed",n.tailSpeed[t]),e.geometry.setAttribute("instanceTailTurn",n.tailTurn[t]),e.geometry.setAttribute("instanceTailDrive",n.tailDrive[t])}function Oe(e){e.userData?.quaternionInstancingPatched||(e.onBeforeCompile=n=>{Object.entries(Te.uniforms).forEach((([e,t])=>{n.uniforms[e]=t})),n.vertexShader=n.vertexShader.replace("#include <common>","#include <common>\nattribute vec3 instancePos;\nattribute vec4 instanceQuat;\nattribute float aBodyCoord;\nattribute float instanceTailPhase;\nattribute float instanceTailSpeed;\nattribute float instanceTailTurn;\nattribute float instanceTailDrive;\nuniform float uTailTime;\nuniform float uTailAmplitude;\nuniform float uTailFrequency;\nuniform float uTailPhaseStride;\nuniform float uTailTurnStrength;\nuniform float uTailSpeedScale;\nuniform vec3 uTailRight;\nuniform vec3 uTailForward;\nuniform vec3 uTailUp;\nuniform float uTailEnable;\nvec3 quatTransform(vec3 v, vec4 q) {\n  vec3 t = 2.0 * cross(q.xyz, v);\n  return v + q.w * t + cross(q.xyz, t);\n}").replace("#include <instancing_vertex>","#ifdef USE_INSTANCING\n#endif").replace("#include <begin_vertex>","#include <begin_vertex>\nif (uTailEnable > 0.5) {\n  float driveRaw = instanceTailDrive;\n  if (driveRaw > 0.01) {\n    float drive = clamp(driveRaw, 0.0, 1.0);\n    vec3 originalPos = transformed;\n    vec3 right = normalize(uTailRight);\n    vec3 forward = normalize(uTailForward);\n    vec3 up = normalize(uTailUp);\n\n    float localX = dot(originalPos, right);\n    float localY = dot(originalPos, forward);\n    float localZ = dot(originalPos, up);\n\n    float bodyCoord = clamp(aBodyCoord, 0.0, 1.0);\n    float tailWeight = smoothstep(0.0, 0.35, bodyCoord);\n    float speedFactor = clamp(instanceTailSpeed * uTailSpeedScale, 0.0, 2.0);\n\n    float phase = instanceTailPhase + uTailTime * uTailFrequency;\n    float wavePhase = phase + bodyCoord * uTailPhaseStride;\n    float wag = sin(wavePhase) * uTailAmplitude * drive;\n    float turnOffset = instanceTailTurn * uTailTurnStrength * drive;\n    float motion = wag * (0.4 + 0.6 * speedFactor) + turnOffset;\n\n    float tipDamping = 1.0 - smoothstep(0.7, 1.0, bodyCoord) * 0.3;\n    float bendStrength = mix(0.02, 1.0, tailWeight) * tipDamping;\n\n    float bendAngle = motion * bendStrength;\n    float s = sin(bendAngle);\n    float c = cos(bendAngle);\n    float rotX = localX * c - localY * s;\n    float rotY = localX * s + localY * c;\n\n    float sway = motion * 0.4 * tipDamping;\n    rotX += sway * (0.05 + 0.95 * bodyCoord);\n\n    vec3 rotated = right * rotX + forward * rotY + up * localZ;\n    transformed = rotated;\n  }\n}\ntransformed = quatTransform(transformed, instanceQuat) + instancePos;").replace("#include <beginnormal_vertex>","#include <beginnormal_vertex>\nobjectNormal = quatTransform(objectNormal, instanceQuat);").replace("#include <project_vertex>","#include <project_vertex>\n#ifdef DEPTH_PACKING\nif (uTailEnable > 0.5) {\n  float driveRaw = instanceTailDrive;\n  if (driveRaw > 0.01) {\n    float drive = clamp(driveRaw, 0.0, 1.0);\n    vec3 viewPos = mvPosition.xyz;\n    mat3 normalMatrix3 = mat3(normalMatrix);\n    vec3 right = normalize(normalMatrix3 * uTailRight);\n    vec3 forward = normalize(normalMatrix3 * uTailForward);\n    vec3 up = normalize(normalMatrix3 * uTailUp);\n\n    float localX = dot(viewPos, right);\n    float localY = dot(viewPos, forward);\n    float localZ = dot(viewPos, up);\n\n    float bodyCoord = clamp(aBodyCoord, 0.0, 1.0);\n    float tailWeight = smoothstep(0.0, 0.35, bodyCoord);\n    float speedFactor = clamp(instanceTailSpeed * uTailSpeedScale, 0.0, 2.0);\n\n    float phase = instanceTailPhase + uTailTime * uTailFrequency;\n    float wavePhase = phase + bodyCoord * uTailPhaseStride;\n    float wag = sin(wavePhase) * uTailAmplitude * drive;\n    float turnOffset = instanceTailTurn * uTailTurnStrength * drive;\n    float motion = wag * (0.4 + 0.6 * speedFactor) + turnOffset;\n\n    float tipDamping = 1.0 - smoothstep(0.7, 1.0, bodyCoord) * 0.3;\n    float bendStrength = mix(0.02, 1.0, tailWeight) * tipDamping;\n\n    float bendAngle = motion * bendStrength;\n    float s = sin(bendAngle);\n    float c = cos(bendAngle);\n    float rotX = localX * c - localY * s;\n    float rotY = localX * s + localY * c;\n\n    float sway = motion * 0.4 * tipDamping;\n    rotX += sway * (0.05 + 0.95 * bodyCoord);\n\n    vec3 rotated = right * rotX + forward * rotY + up * localZ;\n    mvPosition.xyz = rotated;\n    gl_Position = projectionMatrix * mvPosition;\n  }\n}\n#endif"),e.userData={...e.userData||{},quaternionInstancingPatched:!0}},e.needsUpdate=!0,we.add(e))}function ze(e){const a=t(e);if(!a)return pe;ie=a;const o=n.HEAPU8.buffer;return se&&re===a&&se.buffer===o||(se=new DataView(o,a,16),re=a),ue=se.getUint32(0,!0),ce=se.getUint32(4,!0),de=se.getUint32(8,!0),pe=se.getInt32(12,!0),pe}function Ye(e){const t=n.HEAPF32.buffer;_e!==t&&(_e=t,Pe=0,Ae=0,Xe=0,Ee=null,Ue=null,je=null,We=0,qe=0,Qe=0);const a=ue,o=de,l=ce;return!a||!o||!l||e<=0?{positions:Ee??new Float32Array(0),orientations:Ue??new Float32Array(0),velocities:je??new Float32Array(0)}:(null!==Ee&&We===e&&Pe===a||(Pe=a,Ee=new Float32Array(t,Pe,3*e),We=e),null!==Ue&&qe===e&&Ae===o||(Ae=o,Ue=new Float32Array(t,Ae,4*e),qe=e),null!==je&&Qe===e&&Xe===l||(Xe=l,je=new Float32Array(t,Xe,3*e),Qe=e),{positions:Ee,orientations:Ue,velocities:je})}const De=new r.Gu$(1,8,8),Ne=new r.Gu$(1,3,2);De.scale(.5,.5,2),Ne.scale(.5,.5,2);let He=null,Ge=null,Ze=null,$e=null,en=null,nn=null,tn=[],an=-1,on=!1;function ln(){return b.reduce(((e,n)=>e+(n.isPredator&&n.count?n.count:0)),0)}function rn(e){if(!en)return!1;while(tn.length>e){const e=tn.pop();e&&k.remove(e)}while(tn.length<e){const e=en.clone(!0);e.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),e.visible=!1,k.add(e),tn.push(e)}return tn.length===e}function sn(e){const n=new Float32Array(e);for(let t=0;t<e;t++)n[t]=Math.random()*Math.PI*2;return n}function un(e,n){if(e&&e.tailPhase)for(const t of e.tailPhase)t.array.set(n),t.needsUpdate=!0}function cn(e){Ve&&Ve.length===3*e||(Ve=new Float32Array(3*e))}function dn(e){if(e.getAttribute("aBodyCoord"))return;const n=e.getAttribute("position");if(!n)return;const t=n.count,a=n.array;let o=1/0,l=1/0,i=1/0,s=-1/0,u=-1/0,c=-1/0;for(let r=0;r<t;r++){const e=3*r,n=a[e],t=a[e+1],d=a[e+2];n<o&&(o=n),n>s&&(s=n),t<l&&(l=t),t>u&&(u=t),d<i&&(i=d),d>c&&(c=d)}const d=s-o,p=u-l,m=c-i;let v="z",f=i,g=m;d>p&&d>m?(v="x",f=o,g=d):p>m&&(v="y",f=l,g=p);const b=new Float32Array(t),h=g>0?g:1;for(let r=0;r<t;r++){const e=3*r,n="x"===v?a[e]:"y"===v?a[e+1]:a[e+2];b[r]=(n-f)/h}e.setAttribute("aBodyCoord",new r.THS(b,1))}function pn(){return b.reduce(((e,n)=>e+(n.count||0)),0)}function mn(e){if(!He.children||!He.children[0])return void console.error("Boid model does not have valid children.");he&&(k.remove(he),we.delete(he.material)),ye&&(k.remove(ye),we.delete(ye.material)),we.clear();const n=Ze.clone();n.vertexColors=!1;const t=$e.clone();t.vertexColors=!1,Oe(n),Oe(t);const a=He.children[0].geometry,o=Ge.children[0].geometry;dn(a),dn(o),he=new r.ZLX(a,n,e),he.castShadow=!0,he.receiveShadow=!0,ye=new r.ZLX(o,t,e),ye.castShadow=!0,ye.receiveShadow=!0;const l=new r.Q1f(1,1,1);for(let r=0;r<e;r++)he.setColorAt(r,l),ye.setColorAt(r,l);he.instanceColor.needsUpdate=!0,ye.instanceColor.needsUpdate=!0,k.add(he),k.add(ye),Le=Ie(e),Ce=Ie(e),Be(Le),Be(Ce),Me=sn(e),un(Le,Me),un(Ce,Me),Re=0,Je(he,Le,Re),Je(ye,Ce,Re),he.instanceMatrix.setUsage(r.agE),ye.instanceMatrix.setUsage(r.agE),he.count=e,ye.count=e,Ee=null,Ue=null,We=0,qe=0,Pe=0,Ae=0,je=null,Qe=0,Xe=0,Ve=null,Ke=0,cn(e);const i=ln();rn(i)&&(an=i);for(const r of tn)r.visible=!1;console.log("InstancedMeshes created with vertex colors enabled")}function vn(e){const n=new M.B,t=new r.Tap;let a=3;const o=()=>{a=Math.max(0,a-1),0===a&&e()},l=t.load("./models/fish.png",(()=>{console.log("Texture loaded successfully.")}),void 0,(e=>{console.error("An error occurred while loading the texture:",e)})),i=t.load("./models/fish_lod.png",(()=>{console.log("Texture loaded successfully.")}),void 0,(e=>{console.error("An error occurred while loading the texture:",e)}));l.flipY=!1,l.colorSpace=r.er$,i.flipY=!1,i.colorSpace=r.er$;const s=t.load("./models/fishPredetor.png",(()=>{console.log("Predator texture loaded successfully.")}),void 0,(e=>{console.error("An error occurred while loading the predator texture:",e)}));s.flipY=!1,s.colorSpace=r.er$;let u=new r._4j({color:16777215,roughness:.5,metalness:0,transparent:!1,alphaTest:.5,map:l,vertexColors:!0,vertexColor:16777215}),c=new r._4j({color:16777215,roughness:.5,metalness:0,transparent:!1,alphaTest:.5,map:i,vertexColors:!1,vertexColor:16777215});Ze=u,$e=c,nn=new r._4j({color:16777215,roughness:.5,metalness:0,transparent:!1,alphaTest:.5,map:s,vertexColors:!1,vertexColor:16777215}),n.load("./models/boidModel.glb",(e=>{He=e.scene,He.traverse((e=>{e.isMesh&&(e.material=u)})),o()}),void 0,(e=>{console.error("An error occurred while loading the model:",e),o()})),n.load("./models/boidModel_lod.glb",(e=>{Ge=e.scene,Ge.traverse((e=>{e.isMesh&&(e.material=c)})),o()}),void 0,(e=>{console.error("An error occurred while loading the LOD model:",e),o()})),n.load("./models/boidPredetorModel.glb",(e=>{en=e.scene,en.traverse((e=>{e.isMesh&&(e.material=nn,e.castShadow=!0,e.receiveShadow=!0)})),an=-1,o()}),void 0,(e=>{console.error("An error occurred while loading the predator model:",e),o()}))}function fn(){for(const e of U)k.remove(e);for(const e of Z)k.remove(e);U=[],Z=[]}let gn=performance.now();function bn(){$?.begin();const e=performance.now(),t=(e-gn)/1e3;gn=e,L.value||(Ke+=t),Se(Ke);const a=ze(L.value?0:t);if(!he||!ye||!Le||!Ce)return S.update(),(yn()?T:R).render(k,x),$?.end(),void(ve=setTimeout(bn,Y));if(te&&ne&&!ae&&!oe){const e=ne.createQuery();e&&(ne.beginQuery(te.TIME_ELAPSED_EXT,e),ae=e)}const{positions:o,orientations:l,velocities:i}=Ye(a);0===(63&me++)&&m(),cn(a);const s=Re,u=(s+1)%D,c=Le.pos[s],d=Le.quat[s],v=Ce.pos[s],f=Ce.quat[s],g=(Le.tailPhase[s],Le.tailSpeed[s]),b=Le.tailTurn[s],h=Le.tailDrive[s],y=(Ce.tailPhase[s],Ce.tailSpeed[s]),w=Ce.tailTurn[s],C=Ce.tailDrive[s],_=c.array,P=d.array,E=v.array,U=f.array,W=g.array,K=b.array,X=h.array,j=y.array,Q=w.array,M=C.array,V=x.position,F=V.x,I=V.y,B=V.z,J=ln(),O=J>0?Math.max(0,a-J):a;an!==J&&rn(J)&&(an=J);for(const n of tn)n.visible=!1;const z=N,[Z,ie,re,se]=ke;for(let n=0;n<a;++n){const e=3*n,t=o[e],a=o[e+1],r=o[e+2],s=i?i[e]:0,u=i?i[e+1]:0,c=i?i[e+2]:0,d=t-F,p=a-I,m=r-B,v=d*d+p*p+m*m,f=v<H,g=!f&&v<G,b=f||g,h=4*n,y=l[h],w=l[h+1],k=l[h+2],x=l[h+3],T=n>=O&&J>0;if(T){const o=n-O,l=tn[o];l&&(l.visible=!0,l.position.set(t,a,r),l.quaternion.set(y,w,k,x)),_[e]=z,_[e+1]=z,_[e+2]=z,P[h]=Z,P[h+1]=ie,P[h+2]=re,P[h+3]=se,E[e]=z,E[e+1]=z,E[e+2]=z,U[h]=Z,U[h+1]=ie,U[h+2]=re,U[h+3]=se,W[n]=0,j[n]=0,K[n]=0,Q[n]=0,X[n]=0,M[n]=0,Ve&&(Ve[e]=0,Ve[e+1]=0,Ve[e+2]=0);continue}const S=Math.hypot(s,u,c),R=Ve?Ve[e]:0,L=Ve?Ve[e+1]:0,C=Ve?Ve[e+2]:0,A=Math.hypot(R,L,C);let q=0;if(A>1e-5&&S>1e-5){const e=C*s-R*c,n=R*s+L*u+C*c;q=Math.atan2(e,n)}const V=S,Y=q;f?(_[e]=t,_[e+1]=a,_[e+2]=r,P[h]=y,P[h+1]=w,P[h+2]=k,P[h+3]=x,E[e]=z,E[e+1]=z,E[e+2]=z,U[h]=Z,U[h+1]=ie,U[h+2]=re,U[h+3]=se):(E[e]=t,E[e+1]=a,E[e+2]=r,U[h]=y,U[h+1]=w,U[h+2]=k,U[h+3]=x,_[e]=z,_[e+1]=z,_[e+2]=z,P[h]=Z,P[h+1]=ie,P[h+2]=re,P[h+3]=se);const D=b?V:0,N=b?Y:0,$=b?1:0;f?(W[n]=D,K[n]=N,j[n]=0,Q[n]=0,X[n]=$,M[n]=0):(W[n]=0,K[n]=0,j[n]=D,Q[n]=N,X[n]=0,M[n]=$),Ve&&(Ve[e]=s,Ve[e+1]=u,Ve[e+2]=c)}const ue=J>0?Math.max(0,a-J):a;if(he.count=ue,ye.count=ue,Je(he,Le,s),Je(ye,Ce,s),c.needsUpdate=!0,d.needsUpdate=!0,v.needsUpdate=!0,f.needsUpdate=!0,g.needsUpdate=!0,b.needsUpdate=!0,h.needsUpdate=!0,y.needsUpdate=!0,w.needsUpdate=!0,C.needsUpdate=!0,Re=u,A.value){const e=p(),t=n.HEAP32.buffer,o=new Int32Array(t,e,2*a);for(let n=0;n<ue;n++){let e=-1;for(let a=0;a<o.length;a+=2)if(o[a]===n){e=o[a+1];break}const t=e>=0?(new r.Q1f).setHSL(e%100/100,.8,.6):new r.Q1f(1,0,0);he.setColorAt(n,t),ye.setColorAt(n,t)}he.instanceColor.needsUpdate=!0,ye.instanceColor.needsUpdate=!0}else if(on){const e=new r.Q1f(1,1,1);for(let n=0;n<ue;n++)he.setColorAt(n,e),ye.setColorAt(n,e);he.instanceColor.needsUpdate=!0,ye.instanceColor.needsUpdate=!0,console.log("✓ Reset vertex colors to white (OFF mode)")}on=A.value,S.update();const ce=yn()?T:R;if(ce.render(k,x),te&&ne&&ae&&(ne.endQuery(te.TIME_ELAPSED_EXT),oe=ae,ae=null),te&&ne&&oe){const e=ne.getQueryParameter(oe,ne.QUERY_RESULT_AVAILABLE),n=ne.getParameter(te.GPU_DISJOINT_EXT);if(e){if(!n){const e=ne.getQueryParameter(oe,ne.QUERY_RESULT);le=e/1e6,!ee&&$&&"function"===typeof q.A.Panel&&(ee=$.addPanel(new q.A.Panel("GPU (ms)","#ff8","#221")),$.showPanel(0)),ee?.update(le,33)}ne.deleteQuery(oe),oe=null}}$?.end(),ve=setTimeout(bn,Y)}function hn(){const e=new n.VectorSpeciesParams;b.forEach((n=>{const t="number"===typeof n.tau?n.tau:0;e.push_back({species:n.species||"default",count:n.count||0,cohesion:n.cohesion||0,separation:n.separation||0,alignment:n.alignment||0,maxSpeed:n.maxSpeed||1,minSpeed:n.minSpeed||0,maxTurnAngle:n.maxTurnAngle||0,separationRange:n.separationRange||0,alignmentRange:n.alignmentRange||0,cohesionRange:n.cohesionRange||0,maxNeighbors:n.maxNeighbors||0,lambda:n.lambda||0,horizontalTorque:n.horizontalTorque||0,velocityEpsilon:n.velocityEpsilon||0,torqueStrength:n.torqueStrength||0,tau:t,isPredator:n.isPredator||!1})})),n.callInitBoids(e,1,6,.25),c(16,0);const t=pn();d&&d(t,40,.25),h=t,mn(t),bn()}function yn(){return/Mobi|Android/i.test(navigator.userAgent)}function wn(){b.length=0,f.forEach((e=>b.push({...e})))}return(0,o.sV)((()=>{ge(),vn((()=>{console.log("Boid model loaded successfully."),$=new q.A,$.showPanel(0),document.body.appendChild($.dom),$.dom.style.position="fixed",$.dom.style.right="0px",$.dom.style.top="0px",$.dom.style.left="auto",$.dom.style.zIndex=1e3,te&&"function"===typeof q.A.Panel&&!ee&&(ee=$.addPanel(new q.A.Panel("GPU (ms)","#ff8","#221")),$.showPanel(0)),hn()})),window.addEventListener("keydown",fe)})),(0,o.wB)(b,(()=>{if(n&&n.setGlobalSpeciesParamsFromJS){const e=new n.VectorSpeciesParams;b.forEach((n=>{const t="number"===typeof n.tau?n.tau:0;e.push_back({species:n.species||"default",count:n.count||0,cohesion:n.cohesion||0,separation:n.separation||0,alignment:n.alignment||0,maxSpeed:n.maxSpeed||1,minSpeed:n.minSpeed||0,maxTurnAngle:n.maxTurnAngle||0,separationRange:n.separationRange||0,alignmentRange:n.alignmentRange||0,cohesionRange:n.cohesionRange||0,maxNeighbors:n.maxNeighbors||0,lambda:n.lambda||0,horizontalTorque:n.horizontalTorque||0,velocityEpsilon:n.velocityEpsilon||0,torqueStrength:n.torqueStrength||0,tau:t,isPredator:n.isPredator||!1})})),n.setGlobalSpeciesParamsFromJS(e,1);try{const e=b.map((e=>({...(0,i.ux)(e)})));localStorage.setItem("boids_settings",JSON.stringify(e))}catch(a){console.error("Failed to save settings to localStorage:",a)}}const e=pn();e!==h&&(h=e,d&&d(e,40,.25),mn(e));const t=ln();rn(t)&&(an=t);for(const n of tn)n.visible=!1}),{deep:!0}),(0,o.wB)(C,(e=>{console.log("showUnits changed to:",e),e||fn()})),(0,o.wB)([_,P],(([e,n])=>{console.log("Unit display mode changed - Spheres:",e,"Lines:",n),C.value&&fn()})),(e,n)=>((0,o.uX)(),(0,o.CE)("div",V,[(0,o.Lk)("div",F,[n[12]||(n[12]=(0,o.Lk)("h1",null,"Boids Simulation",-1)),(0,o.Lk)("details",null,[n[11]||(n[11]=(0,o.Lk)("summary",null,"Settings",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(b,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n},[(0,o.bF)(W,{settings:e},null,8,["settings"])])))),128)),(0,o.Lk)("button",{onClick:wn,style:{"margin-bottom":"1em"}},"リセット"),(0,o.Lk)("div",null,[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[0]||(n[0]=e=>C.value=e)},null,512),[[a.lH,C.value]]),n[5]||(n[5]=(0,o.eW)(" Unit可視化 "))]),(0,o.Lk)("label",I,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=e=>_.value=e)},null,512),[[a.lH,_.value]]),n[6]||(n[6]=(0,o.eW)(" スフィアのみ表示 "))]),n[10]||(n[10]=(0,o.eW)()),(0,o.Lk)("label",B,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=e=>P.value=e)},null,512),[[a.lH,P.value]]),n[7]||(n[7]=(0,o.eW)(" 線のみ表示 "))]),(0,o.Lk)("label",J,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=e=>A.value=e)},null,512),[[a.lH,A.value]]),n[8]||(n[8]=(0,o.eW)(" Unit色分け "))]),(0,o.Lk)("label",O,[n[9]||(n[9]=(0,o.eW)(" 表示レイヤ下限: ")),(0,o.bo)((0,o.Lk)("input",{type:"range",min:"1",max:"20","onUpdate:modelValue":n[4]||(n[4]=e=>E.value=e)},null,512),[[a.Jo,E.value]]),(0,o.eW)(" "+(0,l.v_)(E.value),1)])])]),(0,o.Lk)("div",z,[(0,o.Lk)("p",null,"Boids Count: "+(0,l.v_)(y.value),1)])]),(0,o.Lk)("div",{ref_key:"threeContainer",ref:w,class:"three-container"},null,512)]))}},$=Z,ee=$,ne="prod";let te,ae;"prod"===ne?(te=t.e(807).then(t.bind(t,456)),ae=new URL(t(980),t.b).href):(te=t.e(453).then(t.bind(t,584)),ae=new URL(t(450),t.b).href),te.then((e=>e.default({locateFile:e=>e.endsWith(".wasm")?ae:e}))).then((e=>{const n=(0,a.Ef)(ee);n.provide("wasmModule",e),n.mount("#app")})).catch((e=>{console.error("Failed to initialise WASM module:",e)}))},980:(e,n,t)=>{e.exports=t.p+"43c6df340a87b9b3.wasm"}},n={};function t(a){var o=n[a];if(void 0!==o)return o.exports;var l=n[a]={exports:{}};return e[a](l,l.exports,t),l.exports}t.m=e,(()=>{var e="function"===typeof Symbol?Symbol("webpack queues"):"__webpack_queues__",n="function"===typeof Symbol?Symbol("webpack exports"):"__webpack_exports__",a="function"===typeof Symbol?Symbol("webpack error"):"__webpack_error__",o=e=>{e&&e.d<1&&(e.d=1,e.forEach((e=>e.r--)),e.forEach((e=>e.r--?e.r++:e())))},l=t=>t.map((t=>{if(null!==t&&"object"===typeof t){if(t[e])return t;if(t.then){var l=[];l.d=0,t.then((e=>{i[n]=e,o(l)}),(e=>{i[a]=e,o(l)}));var i={};return i[e]=e=>e(l),i}}var r={};return r[e]=e=>{},r[n]=t,r}));t.a=(t,i,r)=>{var s;r&&((s=[]).d=-1);var u,c,d,p=new Set,m=t.exports,v=new Promise(((e,n)=>{d=n,c=e}));v[n]=m,v[e]=e=>(s&&e(s),p.forEach(e),v["catch"]((e=>{}))),t.exports=v,i((t=>{var o;u=l(t);var i=()=>u.map((e=>{if(e[a])throw e[a];return e[n]})),r=new Promise((n=>{o=()=>n(i),o.r=0;var t=e=>e!==s&&!p.has(e)&&(p.add(e),e&&!e.d&&(o.r++,e.push(o)));u.map((n=>n[e](t)))}));return o.r?r:i()}),(e=>(e?d(v[a]=e):c(m),o(s)))),s&&s.d<0&&(s.d=0)}})(),(()=>{var e=[];t.O=(n,a,o,l)=>{if(!a){var i=1/0;for(c=0;c<e.length;c++){for(var[a,o,l]=e[c],r=!0,s=0;s<a.length;s++)(!1&l||i>=l)&&Object.keys(t.O).every((e=>t.O[e](a[s])))?a.splice(s--,1):(r=!1,l<i&&(i=l));if(r){e.splice(c--,1);var u=o();void 0!==u&&(n=u)}}return n}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[a,o,l]}})(),(()=>{var e,n=Object.getPrototypeOf?e=>Object.getPrototypeOf(e):e=>e.__proto__;t.t=function(a,o){if(1&o&&(a=this(a)),8&o)return a;if("object"===typeof a&&a){if(4&o&&a.__esModule)return a;if(16&o&&"function"===typeof a.then)return a}var l=Object.create(null);t.r(l);var i={};e=e||[null,n({}),n([]),n(n)];for(var r=2&o&&a;"object"==typeof r&&!~e.indexOf(r);r=n(r))Object.getOwnPropertyNames(r).forEach((e=>i[e]=()=>a[e]));return i["default"]=()=>a,t.d(l,i),l}})(),(()=>{t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}})(),(()=>{t.f={},t.e=e=>Promise.all(Object.keys(t.f).reduce(((n,a)=>(t.f[a](e,n),n)),[]))})(),(()=>{t.u=e=>"static/js/"+({453:"wasm-dev",807:"wasm-prod"}[e]||e)+"."+{116:"7808f10d",268:"a37db019",372:"202a8e6a",453:"53e13de4",456:"f85c30dc",584:"1973008c",807:"26bbab2b",940:"e38b148b"}[e]+".js"})(),(()=>{t.miniCssF=e=>{}})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n)})(),(()=>{var e={},n="wasm-boids:";t.l=(a,o,l,i)=>{if(e[a])e[a].push(o);else{var r,s;if(void 0!==l)for(var u=document.getElementsByTagName("script"),c=0;c<u.length;c++){var d=u[c];if(d.getAttribute("src")==a||d.getAttribute("data-webpack")==n+l){r=d;break}}r||(s=!0,r=document.createElement("script"),r.charset="utf-8",r.timeout=120,t.nc&&r.setAttribute("nonce",t.nc),r.setAttribute("data-webpack",n+l),r.src=a),e[a]=[o];var p=(n,t)=>{r.onerror=r.onload=null,clearTimeout(m);var o=e[a];if(delete e[a],r.parentNode&&r.parentNode.removeChild(r),o&&o.forEach((e=>e(t))),n)return n(t)},m=setTimeout(p.bind(null,void 0,{type:"timeout",target:r}),12e4);r.onerror=p.bind(null,r.onerror),r.onload=p.bind(null,r.onload),s&&document.head.appendChild(r)}}})(),(()=>{t.r=e=>{"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}})(),(()=>{t.p="/wasm-boids/"})(),(()=>{t.b=document.baseURI||self.location.href;var e={57:0};t.f.j=(n,a)=>{var o=t.o(e,n)?e[n]:void 0;if(0!==o)if(o)a.push(o[2]);else{var l=new Promise(((t,a)=>o=e[n]=[t,a]));a.push(o[2]=l);var i=t.p+t.u(n),r=new Error,s=a=>{if(t.o(e,n)&&(o=e[n],0!==o&&(e[n]=void 0),o)){var l=a&&("load"===a.type?"missing":a.type),i=a&&a.target&&a.target.src;r.message="Loading chunk "+n+" failed.\n("+l+": "+i+")",r.name="ChunkLoadError",r.type=l,r.request=i,o[1](r)}};t.l(i,s,"chunk-"+n,n)}},t.O.j=n=>0===e[n];var n=(n,a)=>{var o,l,[i,r,s]=a,u=0;if(i.some((n=>0!==e[n]))){for(o in r)t.o(r,o)&&(t.m[o]=r[o]);if(s)var c=s(t)}for(n&&n(a);u<i.length;u++)l=i[u],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(c)},a=self["webpackChunkwasm_boids"]=self["webpackChunkwasm_boids"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))})();var a=t.O(void 0,[504],(()=>t(466)));a=t.O(a)})();
//# sourceMappingURL=index.7613a529.js.map