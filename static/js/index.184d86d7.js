(()=>{var e={979:(e,n,t)=>{var a=t(751),o=t(641),l=t(33),i=t(953),r=t(922),s=t(437),u=t(24);const c={class:"settings"},d={class:"species-section",open:!1},p={class:"species-header"},m={class:"species-content"},f={class:"setting-row"},v={class:"setting-row"},g={class:"setting-row"},h={class:"setting-row"},b={class:"setting-row"},y={class:"setting-row"},w={class:"setting-row"},x={class:"setting-row"},k={class:"setting-row"},T={class:"setting-row"},S={class:"setting-row"},C={class:"setting-row"},L={class:"setting-row"},P={class:"setting-row"},E={class:"setting-row"},R={class:"setting-row"},_={__name:"Settings",props:{settings:{type:Object,required:!0}},setup(e){const n=(0,i.KR)(!1),t=(0,i.KR)(!1),r=(0,i.KR)(!1),s=(0,i.KR)(!1),u=(0,i.KR)(!1),_=(0,i.KR)(!1),U=(0,i.KR)(!1),A=(0,i.KR)(!1),F=(0,i.KR)(!1),M=(0,i.KR)(!1),W=(0,i.KR)(!1),I=(0,i.KR)(!1),D=(0,i.KR)(!1),K=(0,i.KR)(!1),q=(0,i.KR)(null),X=(0,i.KR)(null),B=(0,i.KR)(null),Q=(0,i.KR)(null),j=(0,i.KR)(null),V=(0,i.KR)(null),z=(0,i.KR)(null),O=(0,i.KR)(null),Y=(0,i.KR)(null),J=(0,i.KR)(null),N=(0,i.KR)(null),G=(0,i.KR)(null),H=(0,i.KR)(null),$=(0,i.KR)(null);async function Z(){n.value=!0,await(0,o.dY)(),q.value&&(q.value.focus(),q.value.select())}async function ee(){t.value=!0,await(0,o.dY)(),X.value&&(X.value.focus(),X.value.select())}async function ne(){r.value=!0,await(0,o.dY)(),B.value&&(B.value.focus(),B.value.select())}async function te(){s.value=!0,await(0,o.dY)(),Q.value&&(Q.value.focus(),Q.value.select())}async function ae(){u.value=!0,await(0,o.dY)(),j.value&&(j.value.focus(),j.value.select())}async function oe(){_.value=!0,await(0,o.dY)(),V.value&&(V.value.focus(),V.value.select())}async function le(){U.value=!0,await(0,o.dY)(),z.value&&(z.value.focus(),z.value.select())}async function ie(){A.value=!0,await(0,o.dY)(),O.value&&(O.value.focus(),O.value.select())}async function re(){F.value=!0,await(0,o.dY)(),Y.value&&(Y.value.focus(),Y.value.select())}async function se(){M.value=!0,await(0,o.dY)(),J.value&&(J.value.focus(),J.value.select())}async function ue(){W.value=!0,await(0,o.dY)(),N.value&&(N.value.focus(),N.value.select())}async function ce(){I.value=!0,await(0,o.dY)(),G.value&&(G.value.focus(),G.value.select())}async function de(){D.value=!0,await(0,o.dY)(),H.value&&(H.value.focus(),H.value.select())}async function pe(){K.value=!0,await(0,o.dY)(),$.value&&($.value.focus(),$.value.select())}function me(){n.value=!1}function fe(){t.value=!1}function ve(){r.value=!1}function ge(){s.value=!1}function he(){u.value=!1}function be(){_.value=!1}function ye(){U.value=!1}function we(){A.value=!1}function xe(){F.value=!1}function ke(){M.value=!1}function Te(){W.value=!1}function Se(){I.value=!1}function Ce(){D.value=!1}function Le(){K.value=!1}return(i,Pe)=>((0,o.uX)(),(0,o.CE)("div",c,[(0,o.Lk)("details",d,[(0,o.Lk)("summary",p,(0,l.v_)(e.settings.species)+" ("+(0,l.v_)(e.settings.count)+"匹) ",1),(0,o.Lk)("div",m,[(0,o.Lk)("div",f,[Pe[29]||(Pe[29]=(0,o.Lk)("label",null,[(0,o.eW)("種族名"),(0,o.Lk)("br"),(0,o.eW)("(Species):")],-1)),(0,o.Lk)("span",null,(0,l.v_)(e.settings.species),1)]),(0,o.Lk)("div",v,[Pe[30]||(Pe[30]=(0,o.Lk)("label",null,[(0,o.eW)("群れの数(要更新)"),(0,o.Lk)("br"),(0,o.eW)("(Count):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[0]||(Pe[0]=n=>e.settings.count=n),min:"0",max:"50000",step:"1"},null,512),[[a.Jo,e.settings.count,void 0,{number:!0}]]),n.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:Z,title:"クリックして編集"},(0,l.v_)(e.settings.count),1)),n.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[1]||(Pe[1]=n=>e.settings.count=n),min:"0",max:"20000",class:"value-input",onBlur:me,onKeyup:(0,a.jR)(me,["enter"]),ref_key:"countInput",ref:q},null,544)),[[a.Jo,e.settings.count,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",g,[Pe[31]||(Pe[31]=(0,o.Lk)("label",null,[(0,o.eW)("凝集"),(0,o.Lk)("br"),(0,o.eW)("(Cohesion):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[2]||(Pe[2]=n=>e.settings.cohesion=n),min:"0",max:"40",step:"0.01"},null,512),[[a.Jo,e.settings.cohesion,void 0,{number:!0}]]),t.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ee,title:"クリックして編集"},(0,l.v_)(e.settings.cohesion),1)),t.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[3]||(Pe[3]=n=>e.settings.cohesion=n),min:"0",max:"40",step:"0.01",class:"value-input",onBlur:fe,onKeyup:(0,a.jR)(fe,["enter"]),ref_key:"cohesionInput",ref:X},null,544)),[[a.Jo,e.settings.cohesion,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",h,[Pe[32]||(Pe[32]=(0,o.Lk)("label",null,[(0,o.eW)("凝集範囲"),(0,o.Lk)("br"),(0,o.eW)("(Cohesion Range):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[4]||(Pe[4]=n=>e.settings.cohesionRange=n),min:"1",max:"300",step:"1"},null,512),[[a.Jo,e.settings.cohesionRange,void 0,{number:!0}]]),r.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ne,title:"クリックして編集"},(0,l.v_)(e.settings.cohesionRange),1)),r.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[5]||(Pe[5]=n=>e.settings.cohesionRange=n),min:"1",max:"300",step:"1",class:"value-input",onBlur:ve,onKeyup:(0,a.jR)(ve,["enter"]),ref_key:"cohesionRangeInput",ref:B},null,544)),[[a.Jo,e.settings.cohesionRange,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",b,[Pe[33]||(Pe[33]=(0,o.Lk)("label",null,[(0,o.eW)("分離"),(0,o.Lk)("br"),(0,o.eW)("(Separation):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[6]||(Pe[6]=n=>e.settings.separation=n),min:"0",max:"10",step:"0.01"},null,512),[[a.Jo,e.settings.separation,void 0,{number:!0}]]),s.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:te,title:"クリックして編集"},(0,l.v_)(e.settings.separation),1)),s.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[7]||(Pe[7]=n=>e.settings.separation=n),min:"0",max:"10",step:"0.01",class:"value-input",onBlur:ge,onKeyup:(0,a.jR)(ge,["enter"]),ref_key:"separationInput",ref:Q},null,544)),[[a.Jo,e.settings.separation,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",y,[Pe[34]||(Pe[34]=(0,o.Lk)("label",null,[(0,o.eW)("分離範囲"),(0,o.Lk)("br"),(0,o.eW)("(Separation Range):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[8]||(Pe[8]=n=>e.settings.separationRange=n),min:"0.1",max:"10",step:"0.1"},null,512),[[a.Jo,e.settings.separationRange,void 0,{number:!0}]]),u.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ae,title:"クリックして編集"},(0,l.v_)(e.settings.separationRange),1)),u.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[9]||(Pe[9]=n=>e.settings.separationRange=n),min:"0.1",max:"10",step:"0.1",class:"value-input",onBlur:he,onKeyup:(0,a.jR)(he,["enter"]),ref_key:"separationRangeInput",ref:j},null,544)),[[a.Jo,e.settings.separationRange,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),Pe[45]||(Pe[45]=(0,o.eW)()),(0,o.Lk)("div",w,[Pe[35]||(Pe[35]=(0,o.Lk)("label",null,[(0,o.eW)("整列"),(0,o.Lk)("br"),(0,o.eW)("(Alignment):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[10]||(Pe[10]=n=>e.settings.alignment=n),min:"0",max:"20",step:"0.01"},null,512),[[a.Jo,e.settings.alignment,void 0,{number:!0}]]),_.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:oe,title:"クリックして編集"},(0,l.v_)(e.settings.alignment),1)),_.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[11]||(Pe[11]=n=>e.settings.alignment=n),min:"0",max:"20",step:"0.01",class:"value-input",onBlur:be,onKeyup:(0,a.jR)(be,["enter"]),ref_key:"alignmentInput",ref:V},null,544)),[[a.Jo,e.settings.alignment,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",x,[Pe[36]||(Pe[36]=(0,o.Lk)("label",null,[(0,o.eW)("整列範囲"),(0,o.Lk)("br"),(0,o.eW)("(Alignment Range):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[12]||(Pe[12]=n=>e.settings.alignmentRange=n),min:"1",max:"100",step:"1"},null,512),[[a.Jo,e.settings.alignmentRange,void 0,{number:!0}]]),U.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:le,title:"クリックして編集"},(0,l.v_)(e.settings.alignmentRange),1)),U.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[13]||(Pe[13]=n=>e.settings.alignmentRange=n),min:"1",max:"100",step:"1",class:"value-input",onBlur:ye,onKeyup:(0,a.jR)(ye,["enter"]),ref_key:"alignmentRangeInput",ref:z},null,544)),[[a.Jo,e.settings.alignmentRange,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",k,[Pe[37]||(Pe[37]=(0,o.Lk)("label",null,[(0,o.eW)("最大速度"),(0,o.Lk)("br"),(0,o.eW)("(Max Speed):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[14]||(Pe[14]=n=>e.settings.maxSpeed=n),min:"0.1",max:"2",step:"0.01"},null,512),[[a.Jo,e.settings.maxSpeed,void 0,{number:!0}]]),A.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ie,title:"クリックして編集"},(0,l.v_)(e.settings.maxSpeed),1)),A.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[15]||(Pe[15]=n=>e.settings.maxSpeed=n),min:"0.1",max:"2",step:"0.01",class:"value-input",onBlur:we,onKeyup:(0,a.jR)(we,["enter"]),ref_key:"maxSpeedInput",ref:O},null,544)),[[a.Jo,e.settings.maxSpeed,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),Pe[46]||(Pe[46]=(0,o.eW)()),(0,o.Lk)("div",T,[Pe[38]||(Pe[38]=(0,o.Lk)("label",null,[(0,o.eW)("最大旋回角"),(0,o.Lk)("br"),(0,o.eW)("(Max Turn Angle):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[16]||(Pe[16]=n=>e.settings.maxTurnAngle=n),min:"0.001",max:"0.3",step:"0.001"},null,512),[[a.Jo,e.settings.maxTurnAngle,void 0,{number:!0}]]),F.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:re,title:"クリックして編集"},(0,l.v_)(e.settings.maxTurnAngle),1)),F.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[17]||(Pe[17]=n=>e.settings.maxTurnAngle=n),min:"0.001",max:"0.3",step:"0.001",class:"value-input",onBlur:xe,onKeyup:(0,a.jR)(xe,["enter"]),ref_key:"maxTurnAngleInput",ref:Y},null,544)),[[a.Jo,e.settings.maxTurnAngle,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",S,[Pe[39]||(Pe[39]=(0,o.Lk)("label",null,[(0,o.eW)("最大近傍数"),(0,o.Lk)("br"),(0,o.eW)("(Max Neighbors):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[18]||(Pe[18]=n=>e.settings.maxNeighbors=n),min:"0",max:"32",step:"1"},null,512),[[a.Jo,e.settings.maxNeighbors,void 0,{number:!0}]]),M.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:se,title:"クリックして編集"},(0,l.v_)(e.settings.maxNeighbors),1)),M.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[19]||(Pe[19]=n=>e.settings.maxNeighbors=n),min:"0",max:"32",step:"1",class:"value-input",onBlur:ke,onKeyup:(0,a.jR)(ke,["enter"]),ref_key:"maxNeighborsInput",ref:J},null,544)),[[a.Jo,e.settings.maxNeighbors,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",C,[Pe[40]||(Pe[40]=(0,o.Lk)("label",null,[(0,o.eW)("水平化トルク"),(0,o.Lk)("br"),(0,o.eW)("(Horizontal Torque):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[20]||(Pe[20]=n=>e.settings.horizontalTorque=n),min:"0.0",max:"0.2",step:"0.001"},null,512),[[a.Jo,e.settings.horizontalTorque,void 0,{number:!0}]]),W.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ue,title:"クリックして編集"},(0,l.v_)(e.settings.horizontalTorque),1)),W.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[21]||(Pe[21]=n=>e.settings.horizontalTorque=n),min:"0.0",max:"0.2",step:"0.001",class:"value-input",onBlur:Te,onKeyup:(0,a.jR)(Te,["enter"]),ref_key:"horizontalTorqueInput",ref:N},null,544)),[[a.Jo,e.settings.horizontalTorque,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",L,[Pe[41]||(Pe[41]=(0,o.Lk)("label",null,[(0,o.eW)("回転トルク強度"),(0,o.Lk)("br"),(0,o.eW)("(Torque Strength):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[22]||(Pe[22]=n=>e.settings.torqueStrength=n),min:"0.0",max:"20",step:"0.001"},null,512),[[a.Jo,e.settings.torqueStrength,void 0,{number:!0}]]),I.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:ce,title:"クリックして編集"},(0,l.v_)(e.settings.torqueStrength),1)),I.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[23]||(Pe[23]=n=>e.settings.torqueStrength=n),min:"0.0",max:"5",step:"0.001",class:"value-input",onBlur:Se,onKeyup:(0,a.jR)(Se,["enter"]),ref_key:"torqueStrengthInput",ref:G},null,544)),[[a.Jo,e.settings.torqueStrength,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",P,[Pe[42]||(Pe[42]=(0,o.Lk)("label",null,[(0,o.eW)("減衰係数"),(0,o.Lk)("br"),(0,o.eW)("(Damping Coefficient):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[24]||(Pe[24]=n=>e.settings.lambda=n),min:"0",max:"1",step:"0.001"},null,512),[[a.Jo,e.settings.lambda,void 0,{number:!0}]]),D.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:de,title:"クリックして編集"},(0,l.v_)(e.settings.lambda),1)),D.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[25]||(Pe[25]=n=>e.settings.lambda=n),min:"0",max:"1",step:"0.001",class:"value-input",onBlur:Ce,onKeyup:(0,a.jR)(Ce,["enter"]),ref_key:"lambdaInput",ref:H},null,544)),[[a.Jo,e.settings.lambda,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",E,[Pe[43]||(Pe[43]=(0,o.Lk)("label",null,[(0,o.eW)("記憶時間"),(0,o.Lk)("br"),(0,o.eW)("(Memory Time):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"range","onUpdate:modelValue":Pe[26]||(Pe[26]=n=>e.settings.tau=n),min:"0",max:"5",step:"0.01"},null,512),[[a.Jo,e.settings.tau,void 0,{number:!0}]]),K.value?(0,o.Q3)("",!0):((0,o.uX)(),(0,o.CE)("span",{key:0,class:"editable-value",onClick:pe,title:"クリックして編集"},(0,l.v_)(e.settings.tau),1)),K.value?(0,o.bo)(((0,o.uX)(),(0,o.CE)("input",{key:1,type:"number","onUpdate:modelValue":Pe[27]||(Pe[27]=n=>e.settings.tau=n),min:"0",max:"5",step:"0.01",class:"value-input",onBlur:Le,onKeyup:(0,a.jR)(Le,["enter"]),ref_key:"tauInput",ref:$},null,544)),[[a.Jo,e.settings.tau,void 0,{number:!0}]]):(0,o.Q3)("",!0)]),(0,o.Lk)("div",R,[Pe[44]||(Pe[44]=(0,o.Lk)("label",null,[(0,o.eW)("捕食者フラグ"),(0,o.Lk)("br"),(0,o.eW)("(Is Predator):")],-1)),(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":Pe[28]||(Pe[28]=n=>e.settings.isPredator=n)},null,512),[[a.lH,e.settings.isPredator]]),(0,o.Lk)("span",null,(0,l.v_)(e.settings.isPredator),1)])])])]))}};var U=t(262);const A=(0,U.A)(_,[["__scopeId","data-v-e35dcab8"]]),F=A;var M=t(777),W=t(794),I=t(804),D=t(741),K=t(579),q=t(185),X=t(763);const B={id:"app"},Q={class:"ui-overlay"},j={style:{"margin-left":"1em"}},V={style:{"margin-left":"1em"}},z={style:{"margin-left":"1em"}},O={style:{"margin-left":"1em"}},Y={class:"info"},J=1,N=3,G=1e6,H=4,$=25,Z={__name:"App",setup(e){const n=(0,o.WQ)("wasmModule");n||console.error("wasmModule not provided");const t=n.cwrap("stepSimulation","number",["number"]),c=n.cwrap("build","void",["number","number"]),d=n.cwrap("setFlockSize","void",["number","number","number"]),p=(n.cwrap("exportTreeStructure","object",[]),n.cwrap("boidUnitMappingPtr","number",[])),m=n.cwrap("currentFirstBoidX","number",[]);const f=_n()?6e3:1e4,v=[{species:"Boids",count:f,cohesion:32,cohesionRange:30,separation:8,separationRange:.6,alignment:17,alignmentRange:6,maxSpeed:.26,maxTurnAngle:.25,maxNeighbors:6,horizontalTorque:.019,torqueStrength:10,lambda:.62,tau:1.5},{species:"Predator",count:1,cohesion:5.58,separation:0,alignment:0,maxSpeed:1.37,minSpeed:.4,maxTurnAngle:.2,separationRange:14,alignmentRange:11,cohesionRange:77,maxNeighbors:0,lambda:.05,tau:1,horizontalTorque:.022,torqueStrength:0,isPredator:!0}];function g(){try{const e=localStorage.getItem("boids_settings");if(e){const n=JSON.parse(e);if(Array.isArray(n))return n}}catch(e){console.error("Failed to load settings from localStorage:",e)}return v}const h=(0,i.Kh)(g());let b=Tn();const y=(0,o.EW)((()=>Tn())),w=(0,i.KR)(null);let x,k,T,S,C,L=null,P=null;const E=(0,i.KR)(!1),R=(0,i.KR)(!0),_=(0,i.KR)(!1),U=(0,i.KR)(!1),A=(0,i.KR)(!1),Z=(0,i.KR)(1);let ee=[],ne=[],te=null,ae=null,oe=null,le=null,ie=null,re=null,se=0,ue=0,ce=0,de=null,pe=0,me=0,fe=0,ve=0,ge=0,he=null;function be(e){"Space"===e.code&&(E.value=!E.value)}function ye(){const e=window.innerWidth,n=window.innerHeight;x=new r.Z58,x.background=new r.Q1f(Pe.DEEP_BLUE),Ue(),k=new r.ubm(75,e/n,.1,1e3),k.position.set(3,-5,3),k.lookAt(0,0,0),T=new s.JeP({antialias:!0,depth:!0}),T.setPixelRatio(window.devicePixelRatio),T.setSize(e,n),T.shadowMap.enabled=!0,T.shadowMap.type=r.Wk7,oe=T.getContext(),"undefined"!==typeof WebGL2RenderingContext&&oe instanceof WebGL2RenderingContext?(le=oe.getExtension("EXT_disjoint_timer_query_webgl2"),le||console.warn("EXT_disjoint_timer_query_webgl2 is not available; GPU timing disabled.")):le=null,w.value.appendChild(T.domElement),k.aspect=e/n,k.updateProjectionMatrix(),S=new u.N(k,T.domElement),S.enableDamping=!0,S.dampingFactor=.1;const t=new r.bdM(300,300),a=Ae();a.depthTest=!0;const o=new r.eaF(t,a);o.rotation.x=-Math.PI/2,o.position.y=-10,o.receiveShadow=!0,x.add(o);const l=new r.$p8(Ee(Pe.AMBIENT_LIGHT),.6);x.add(l);const i=new r.ZyN(Ee(Pe.SUN_LIGHT),20);if(i.position.set(300,500,200),i.castShadow=!0,i.shadow.camera.left=-100,i.shadow.camera.right=100,i.shadow.camera.top=100,i.shadow.camera.bottom=-100,i.shadow.camera.near=1,i.shadow.camera.far=1e3,i.shadow.mapSize.width=1024,i.shadow.mapSize.height=1024,i.shadow.bias=-.01,i.shadow.normalBias=.01,x.add(i),!_n()){const t={depthBuffer:!0,stencilBuffer:!1};P=new r.nWS(e,n,t),P.depthTexture=new r.VCu(e,n,r.RQf),P.depthTexture.format=r.zdS,P.depthTexture.type=r.RQf,P.depthTexture.needsUpdate=!0,C=new W.s(T,P);const a=new I.A(x,k);C.addPass(a);const o=new D.C(x,k,e,n);o.kernelRadius=8,o.minDistance=.001,o.maxDistance=.01,C.addPass(o);const l=new K.C(new r.I9Y(e,n),1.5,.4,.85);C.addPass(l),L=new q.p(_e),L.uniforms.tDepth.value=P.depthTexture,L.uniforms.fogColor.value.copy(Re.color),L.uniforms.distanceStart.value=Re.distanceStart,L.uniforms.distanceEnd.value=Re.distanceEnd,L.uniforms.distanceExponent.value=Re.distanceExponent,L.uniforms.distanceControlPoint1.value.copy(Re.distanceControlPoint1),L.uniforms.distanceControlPoint2.value.copy(Re.distanceControlPoint2),L.uniforms.surfaceLevel.value=Re.surfaceLevel,L.uniforms.heightFalloff.value=Re.heightFalloff,L.uniforms.heightExponent.value=Re.heightExponent,L.uniforms.maxOpacity.value=Re.maxOpacity,L.material.depthTest=!1,L.material.depthWrite=!1,L.material.transparent=!1,L.material.blending=r.XIg,L.material.toneMapped=!0,L.material.needsUpdate=!0,L.renderToScreen=!0,C.addPass(L)}window.addEventListener("resize",we)}function we(){const e=window.innerWidth,n=window.innerHeight;k.aspect=e/n,k.updateProjectionMatrix(),T.setSize(e,n),C&&C.setSize(e,n),P&&P.setSize(e,n)}let xe=null,ke=null;const Te=new Set,Se=[0,0,0,1],Ce=r.Ktl??r.Vnu,Le={uniforms:{uTailTime:{value:0},uTailAmplitude:{value:.14},uTailFrequency:{value:10},uTailPhaseStride:{value:5},uTailTurnStrength:{value:.1},uTailSpeedScale:{value:1},uTailRight:{value:new r.Pq0(1,0,0)},uTailForward:{value:new r.Pq0(0,0,1)},uTailUp:{value:new r.Pq0(0,1,0)},uTailEnable:{value:1}}},Pe={SKY_HIGHLIGHT:"#4fbaff",SKY_BLUE:"#15a1ff",DEEP_BLUE:"#002968",SEAFLOOR:"#777465",FOG:"#153a6c",AMBIENT_LIGHT:"#2c9aff",SUN_LIGHT:"#5389b7",SIDE_LIGHT1:"#6ba3d0",SIDE_LIGHT2:"#2d5f7a",BOTTOM_LIGHT:"#0f2635"},Ee=e=>parseInt(e.replace("#","0x"),16),Re={color:new r.Q1f(Pe.DEEP_BLUE),distanceStart:4,distanceEnd:60,distanceExponent:.4,distanceControlPoint1:new r.I9Y(.2,.8),distanceControlPoint2:new r.I9Y(.75,.95),surfaceLevel:100,heightFalloff:.01,heightExponent:1,maxOpacity:1.2},_e={uniforms:{tDiffuse:{value:null},tDepth:{value:null},cameraNear:{value:.1},cameraFar:{value:1e3},projectionMatrixInverse:{value:new r.kn4},cameraMatrixWorld:{value:new r.kn4},fogColor:{value:Re.color.clone()},distanceStart:{value:Re.distanceStart},distanceEnd:{value:Re.distanceEnd},distanceExponent:{value:Re.distanceExponent},distanceControlPoint1:{value:Re.distanceControlPoint1.clone()},distanceControlPoint2:{value:Re.distanceControlPoint2.clone()},surfaceLevel:{value:Re.surfaceLevel},heightFalloff:{value:Re.heightFalloff},heightExponent:{value:Re.heightExponent},maxOpacity:{value:Re.maxOpacity}},vertexShader:"\n    varying vec2 vUv;\n    void main() {\n      vUv = uv;\n      gl_Position = vec4(position.xy, 0.0, 1.0);\n    }\n  ",fragmentShader:"\n    precision highp float;\n    varying vec2 vUv;\n    uniform sampler2D tDiffuse;\n    uniform sampler2D tDepth;\n    uniform float cameraNear;\n    uniform float cameraFar;\n    uniform vec3 fogColor;\n    uniform float distanceStart;\n    uniform float distanceEnd;\n    uniform float distanceExponent;\n  uniform vec2 distanceControlPoint1;\n  uniform vec2 distanceControlPoint2;\n    uniform float surfaceLevel;\n    uniform float heightFalloff;\n    uniform float heightExponent;\n    uniform float maxOpacity;\n    uniform mat4 projectionMatrixInverse;\n    uniform mat4 cameraMatrixWorld;\n\n    float cubicBezier(float t, float p0, float p1, float p2, float p3) {\n      float u = 1.0 - t;\n      float tt = t * t;\n      float uu = u * u;\n      float uuu = uu * u;\n      float ttt = tt * t;\n      return uuu * p0 + 3.0 * uu * t * p1 + 3.0 * u * tt * p2 + ttt * p3;\n    }\n\n    float cubicBezierDerivative(float t, float p0, float p1, float p2, float p3) {\n      float u = 1.0 - t;\n      return 3.0 * u * u * (p1 - p0) + 6.0 * u * t * (p2 - p1) + 3.0 * t * t * (p3 - p2);\n    }\n\n    float sampleDistanceCurve(float x, vec2 c1, vec2 c2) {\n      float t = x;\n      for (int i = 0; i < 5; ++i) {\n        float current = cubicBezier(t, 0.0, c1.x, c2.x, 1.0) - x;\n        float slope = cubicBezierDerivative(t, 0.0, c1.x, c2.x, 1.0);\n        if (abs(slope) < 1e-5) {\n          break;\n        }\n        t -= current / slope;\n        t = clamp(t, 0.0, 1.0);\n      }\n      return cubicBezier(t, 0.0, c1.y, c2.y, 1.0);\n    }\n\n    void main() {\n      vec4 baseColor = texture2D(tDiffuse, vUv);\n      float depth = texture2D(tDepth, vUv).x;\n\n      if (depth >= 1.0) {\n        gl_FragColor = baseColor;\n        return;\n      }\n\n      vec2 ndc = vUv * 2.0 - 1.0;\n  float ndcZ = depth * 2.0 - 1.0;\n  vec4 clipPos = vec4(ndc, ndcZ, 1.0);\n      vec4 viewPos = projectionMatrixInverse * clipPos;\n      viewPos /= max(viewPos.w, 1e-5);\n      vec4 worldPos = cameraMatrixWorld * viewPos;\n\n  float viewDistance = length(viewPos.xyz);\n  float distanceFogNorm = clamp((viewDistance - distanceStart) /\n            max(distanceEnd - distanceStart, 1e-5), 0.0, 1.0);\n  float distanceFog = sampleDistanceCurve(distanceFogNorm, distanceControlPoint1, distanceControlPoint2);\n  distanceFog = pow(distanceFog, distanceExponent);\n\n      float depthBelowSurface = max(surfaceLevel - worldPos.y, 0.0);\n      float heightFactor = 1.0 - exp(-depthBelowSurface * heightFalloff);\n      heightFactor = clamp(pow(heightFactor, heightExponent), 0.0, 1.0);\n\n  float fogFactor = clamp(distanceFog * heightFactor, 0.0, 1.0);\n  fogFactor = mix(0.0, maxOpacity, fogFactor);\n\n      vec3 fogged = mix(baseColor.rgb, fogColor, fogFactor);\n      gl_FragColor = vec4(fogged, baseColor.a);\n      #include <tonemapping_fragment>\n      #include <colorspace_fragment>\n    }\n  "};function Ue(){if(!x)return null;const e=document.createElement("canvas"),n=e.getContext("2d");e.width=512,e.height=512;const t=n.createLinearGradient(0,0,0,e.height);t.addColorStop(0,Pe.SKY_HIGHLIGHT),t.addColorStop(.2,Pe.SKY_BLUE),t.addColorStop(.6,Pe.DEEP_BLUE),t.addColorStop(1,Pe.DEEP_BLUE),n.fillStyle=t,n.fillRect(0,0,e.width,e.height);const a=new r.GOR(e);a.colorSpace=r.er$,a.generateMipmaps=!1,a.minFilter=r.k6q,a.magFilter=r.k6q;const o=new r.Gu$(300,32,32),l=new r.V9B({map:a,side:r.hsX,fog:!1}),i=new r.eaF(o,l);return x.add(i),i}function Ae(){const e=new r.Tap,n=e.load("./models/groundAlfa.png");n.minFilter=r.k6q,n.magFilter=r.k6q,n.wrapS=r.ghU,n.wrapT=r.ghU;const t=new r._4j({color:Ee(Pe.SEAFLOOR),transparent:!0,alphaMap:n,depthWrite:!0});return t.roughness=.85,t.metalness=0,t}function Fe(e){Le.uniforms.uTailTime.value=e}let Me=0,We=null,Ie=null,De=null,Ke=0,qe=0,Xe=null,Be=null,Qe=0,je=0,Ve=0,ze=0,Oe=null,Ye=0,Je=null,Ne=null;function Ge(e,n){const t=e*n,a=[];for(let o=0;o<N;o++){const e=new r.uWO(new Float32Array(t),n);e.setUsage(Ce),a.push(e)}return a}function He(e){return{pos:Ge(e,3),quat:Ge(e,4),tailPhase:Ge(e,1),tailSpeed:Ge(e,1),tailTurn:Ge(e,1),tailDrive:Ge(e,1)}}function $e(e){for(const n of e.pos){const e=n.array;for(let n=0;n<e.length;n+=3)e[n]=G,e[n+1]=G,e[n+2]=G}for(const n of e.quat){const e=n.array;for(let n=0;n<e.length;n+=4)e[n]=0,e[n+1]=0,e[n+2]=0,e[n+3]=1}for(const n of e.tailPhase)n.array.fill(0);for(const n of e.tailSpeed)n.array.fill(0);for(const n of e.tailTurn)n.array.fill(0);for(const n of e.tailDrive)n.array.fill(0)}function Ze(e,n,t){e.geometry.setAttribute("instancePos",n.pos[t]),e.geometry.setAttribute("instanceQuat",n.quat[t]),e.geometry.setAttribute("instanceTailPhase",n.tailPhase[t]),e.geometry.setAttribute("instanceTailSpeed",n.tailSpeed[t]),e.geometry.setAttribute("instanceTailTurn",n.tailTurn[t]),e.geometry.setAttribute("instanceTailDrive",n.tailDrive[t])}function en(e){e.userData?.quaternionInstancingPatched||(e.onBeforeCompile=n=>{Object.entries(Le.uniforms).forEach((([e,t])=>{n.uniforms[e]=t})),n.vertexShader=n.vertexShader.replace("#include <common>","#include <common>\nattribute vec3 instancePos;\nattribute vec4 instanceQuat;\nattribute float aBodyCoord;\nattribute float instanceTailPhase;\nattribute float instanceTailSpeed;\nattribute float instanceTailTurn;\nattribute float instanceTailDrive;\nuniform float uTailTime;\nuniform float uTailAmplitude;\nuniform float uTailFrequency;\nuniform float uTailPhaseStride;\nuniform float uTailTurnStrength;\nuniform float uTailSpeedScale;\nuniform vec3 uTailRight;\nuniform vec3 uTailForward;\nuniform vec3 uTailUp;\nuniform float uTailEnable;\nvec3 quatTransform(vec3 v, vec4 q) {\n  vec3 t = 2.0 * cross(q.xyz, v);\n  return v + q.w * t + cross(q.xyz, t);\n}").replace("#include <instancing_vertex>","#ifdef USE_INSTANCING\n#endif").replace("#include <begin_vertex>","#include <begin_vertex>\nif (uTailEnable > 0.5) {\n  float driveRaw = instanceTailDrive;\n  if (driveRaw > 0.01) {\n    float drive = clamp(driveRaw, 0.0, 1.0);\n    vec3 originalPos = transformed;\n    vec3 right = normalize(uTailRight);\n    vec3 forward = normalize(uTailForward);\n    vec3 up = normalize(uTailUp);\n\n    float localX = dot(originalPos, right);\n    float localY = dot(originalPos, forward);\n    float localZ = dot(originalPos, up);\n\n    float bodyCoord = clamp(aBodyCoord, 0.0, 1.0);\n    float tailWeight = smoothstep(0.0, 0.35, bodyCoord);\n    float speedFactor = clamp(instanceTailSpeed * uTailSpeedScale, 0.0, 2.0);\n\n    float phase = instanceTailPhase + uTailTime * uTailFrequency;\n    float wavePhase = phase + bodyCoord * uTailPhaseStride;\n    float wag = sin(wavePhase) * uTailAmplitude * drive;\n    float turnOffset = instanceTailTurn * uTailTurnStrength * drive;\n    float motion = wag * (0.4 + 0.6 * speedFactor) + turnOffset;\n\n    float tipDamping = 1.0 - smoothstep(0.7, 1.0, bodyCoord) * 0.3;\n    float bendStrength = mix(0.02, 1.0, tailWeight) * tipDamping;\n\n    float bendAngle = motion * bendStrength;\n    float s = sin(bendAngle);\n    float c = cos(bendAngle);\n    float rotX = localX * c - localY * s;\n    float rotY = localX * s + localY * c;\n\n    float sway = motion * 0.4 * tipDamping;\n    rotX += sway * (0.05 + 0.95 * bodyCoord);\n\n    vec3 rotated = right * rotX + forward * rotY + up * localZ;\n    transformed = rotated;\n  }\n}\ntransformed = quatTransform(transformed, instanceQuat) + instancePos;").replace("#include <beginnormal_vertex>","#include <beginnormal_vertex>\nobjectNormal = quatTransform(objectNormal, instanceQuat);").replace("#include <project_vertex>","#include <project_vertex>\n#ifdef DEPTH_PACKING\nif (uTailEnable > 0.5) {\n  float driveRaw = instanceTailDrive;\n  if (driveRaw > 0.01) {\n    float drive = clamp(driveRaw, 0.0, 1.0);\n    vec3 viewPos = mvPosition.xyz;\n    mat3 normalMatrix3 = mat3(normalMatrix);\n    vec3 right = normalize(normalMatrix3 * uTailRight);\n    vec3 forward = normalize(normalMatrix3 * uTailForward);\n    vec3 up = normalize(normalMatrix3 * uTailUp);\n\n    float localX = dot(viewPos, right);\n    float localY = dot(viewPos, forward);\n    float localZ = dot(viewPos, up);\n\n    float bodyCoord = clamp(aBodyCoord, 0.0, 1.0);\n    float tailWeight = smoothstep(0.0, 0.35, bodyCoord);\n    float speedFactor = clamp(instanceTailSpeed * uTailSpeedScale, 0.0, 2.0);\n\n    float phase = instanceTailPhase + uTailTime * uTailFrequency;\n    float wavePhase = phase + bodyCoord * uTailPhaseStride;\n    float wag = sin(wavePhase) * uTailAmplitude * drive;\n    float turnOffset = instanceTailTurn * uTailTurnStrength * drive;\n    float motion = wag * (0.4 + 0.6 * speedFactor) + turnOffset;\n\n    float tipDamping = 1.0 - smoothstep(0.7, 1.0, bodyCoord) * 0.3;\n    float bendStrength = mix(0.02, 1.0, tailWeight) * tipDamping;\n\n    float bendAngle = motion * bendStrength;\n    float s = sin(bendAngle);\n    float c = cos(bendAngle);\n    float rotX = localX * c - localY * s;\n    float rotY = localX * s + localY * c;\n\n    float sway = motion * 0.4 * tipDamping;\n    rotX += sway * (0.05 + 0.95 * bodyCoord);\n\n    vec3 rotated = right * rotX + forward * rotY + up * localZ;\n    mvPosition.xyz = rotated;\n    gl_Position = projectionMatrix * mvPosition;\n  }\n}\n#endif"),e.userData={...e.userData||{},quaternionInstancingPatched:!0}},e.needsUpdate=!0,Te.add(e))}function nn(e){const n=new r.CSG({depthPacking:r.N5j,alphaTest:e.alphaTest??0});return n.map=e.map??null,n.alphaMap=e.alphaMap??null,n.transparent=e.transparent??!1,en(n),n}function tn(e){const n=new r.aVO({alphaTest:e.alphaTest??0});return n.map=e.map??null,n.alphaMap=e.alphaMap??null,n.transparent=e.transparent??!1,en(n),n}function an(e){const a=t(e);if(!a)return ve;ue=a;const o=n.HEAPU8.buffer;return de&&ce===a&&de.buffer===o||(de=new DataView(o,a,16),ce=a),pe=de.getUint32(0,!0),me=de.getUint32(4,!0),fe=de.getUint32(8,!0),ve=de.getInt32(12,!0),ve}function on(e){const t=n.HEAPF32.buffer;De!==t&&(De=t,Ke=0,qe=0,ze=0,Xe=null,Be=null,Oe=null,Qe=0,je=0,Ye=0);const a=pe,o=fe,l=me;return!a||!o||!l||e<=0?{positions:Xe??new Float32Array(0),orientations:Be??new Float32Array(0),velocities:Oe??new Float32Array(0)}:(null!==Xe&&Qe===e&&Ke===a||(Ke=a,Xe=new Float32Array(t,Ke,3*e),Qe=e),null!==Be&&je===e&&qe===o||(qe=o,Be=new Float32Array(t,qe,4*e),je=e),null!==Oe&&Ye===e&&ze===l||(ze=l,Oe=new Float32Array(t,ze,3*e),Ye=e),{positions:Xe,orientations:Be,velocities:Oe})}const ln=new r.Gu$(1,8,8),rn=new r.Gu$(1,3,2);ln.scale(.5,.5,2),rn.scale(.5,.5,2);let sn=null,un=null,cn=null,dn=null,pn=null,mn=null,fn=[],vn=-1,gn=!1;function hn(){return h.reduce(((e,n)=>e+(n.isPredator&&n.count?n.count:0)),0)}function bn(e){if(!pn)return!1;while(fn.length>e){const e=fn.pop();e&&x.remove(e)}while(fn.length<e){const e=pn.clone(!0);e.traverse((e=>{e.isMesh&&(e.castShadow=!0,e.receiveShadow=!0)})),e.visible=!1,x.add(e),fn.push(e)}return fn.length===e}function yn(e){const n=new Float32Array(e);for(let t=0;t<e;t++)n[t]=Math.random()*Math.PI*2;return n}function wn(e,n){if(e&&e.tailPhase)for(const t of e.tailPhase)t.array.set(n),t.needsUpdate=!0}function xn(e){Ne&&Ne.length===3*e||(Ne=new Float32Array(3*e))}function kn(e){if(e.getAttribute("aBodyCoord"))return;const n=e.getAttribute("position");if(!n)return;const t=n.count,a=n.array;let o=1/0,l=1/0,i=1/0,s=-1/0,u=-1/0,c=-1/0;for(let r=0;r<t;r++){const e=3*r,n=a[e],t=a[e+1],d=a[e+2];n<o&&(o=n),n>s&&(s=n),t<l&&(l=t),t>u&&(u=t),d<i&&(i=d),d>c&&(c=d)}const d=s-o,p=u-l,m=c-i;let f="z",v=i,g=m;d>p&&d>m?(f="x",v=o,g=d):p>m&&(f="y",v=l,g=p);const h=new Float32Array(t),b=g>0?g:1;for(let r=0;r<t;r++){const e=3*r,n="x"===f?a[e]:"y"===f?a[e+1]:a[e+2];h[r]=(n-v)/b}e.setAttribute("aBodyCoord",new r.THS(h,1))}function Tn(){return h.reduce(((e,n)=>e+(n.count||0)),0)}function Sn(e){if(!sn.children||!sn.children[0])return void console.error("Boid model does not have valid children.");xe&&(x.remove(xe),Te.delete(xe.material)),ke&&(x.remove(ke),Te.delete(ke.material)),Te.clear();const n=cn.clone();n.vertexColors=!1;const t=dn.clone();t.vertexColors=!1,en(n),en(t);const a=sn.children[0].geometry,o=un.children[0].geometry;kn(a),kn(o),xe=new r.ZLX(a,n,e),xe.castShadow=!0,xe.receiveShadow=!0,xe.frustumCulled=!1,xe.customDepthMaterial=nn(n),xe.customDistanceMaterial=tn(n),ke=new r.ZLX(o,t,e),ke.castShadow=!0,ke.receiveShadow=!0,ke.frustumCulled=!1,ke.customDepthMaterial=nn(t),ke.customDistanceMaterial=tn(t);const l=new r.Q1f(1,1,1);for(let r=0;r<e;r++)xe.setColorAt(r,l),ke.setColorAt(r,l);xe.instanceColor.needsUpdate=!0,ke.instanceColor.needsUpdate=!0,x.add(xe),x.add(ke),We=He(e),Ie=He(e),$e(We),$e(Ie),Je=yn(e),wn(We,Je),wn(Ie,Je),Me=0,Ze(xe,We,Me),Ze(ke,Ie,Me),xe.instanceMatrix.setUsage(r.agE),ke.instanceMatrix.setUsage(r.agE),xe.count=e,ke.count=e,Xe=null,Be=null,Qe=0,je=0,Ke=0,qe=0,Oe=null,Ye=0,ze=0,Ne=null,Ve=0,xn(e);const i=hn();bn(i)&&(vn=i);for(const r of fn)r.visible=!1;console.log("InstancedMeshes created with vertex colors enabled")}function Cn(e){const n=new X.B,t=new r.Tap;let a=3;const o=()=>{a=Math.max(0,a-1),0===a&&e()},l=t.load("./models/fish.png",(()=>{console.log("Texture loaded successfully.")}),void 0,(e=>{console.error("An error occurred while loading the texture:",e)})),i=t.load("./models/fish_lod.png",(()=>{console.log("Texture loaded successfully.")}),void 0,(e=>{console.error("An error occurred while loading the texture:",e)}));l.flipY=!1,l.colorSpace=r.er$,i.flipY=!1,i.colorSpace=r.er$;const s=t.load("./models/fishPredetor.png",(()=>{console.log("Predator texture loaded successfully.")}),void 0,(e=>{console.error("An error occurred while loading the predator texture:",e)}));s.flipY=!1,s.colorSpace=r.er$;let u=new r._4j({color:16777215,roughness:.1,metalness:0,transparent:!1,alphaTest:.5,map:l,vertexColors:!0,vertexColor:16777215}),c=new r._4j({color:16777215,roughness:.1,metalness:0,transparent:!1,alphaTest:.5,map:i,vertexColors:!1,vertexColor:16777215});cn=u,dn=c,mn=new r._4j({color:16777215,roughness:.5,metalness:0,transparent:!1,alphaTest:.5,map:s,vertexColors:!1,vertexColor:16777215}),n.load("./models/boidModel.glb",(e=>{sn=e.scene,sn.traverse((e=>{e.isMesh&&(e.material=u)})),o()}),void 0,(e=>{console.error("An error occurred while loading the model:",e),o()})),n.load("./models/boidModel_lod.glb",(e=>{un=e.scene,un.traverse((e=>{e.isMesh&&(e.material=c)})),o()}),void 0,(e=>{console.error("An error occurred while loading the LOD model:",e),o()})),n.load("./models/boidPredetorModel.glb",(e=>{pn=e.scene,pn.traverse((e=>{e.isMesh&&(e.material=mn,e.castShadow=!0,e.receiveShadow=!0)})),vn=-1,o()}),void 0,(e=>{console.error("An error occurred while loading the predator model:",e),o()}))}function Ln(){for(const e of ee)x.remove(e);for(const e of ne)x.remove(e);ee=[],ne=[]}let Pn=performance.now();function En(){te?.begin();const e=performance.now(),t=(e-Pn)/1e3;Pn=e,E.value||(Ve+=t),Fe(Ve);const a=an(E.value?0:t);if(!xe||!ke||!We||!Ie)return S.update(),(_n()?T:C).render(x,k),te?.end(),void(he=setTimeout(En,J));if(le&&oe&&!ie&&!re){const e=oe.createQuery();e&&(oe.beginQuery(le.TIME_ELAPSED_EXT,e),ie=e)}const{positions:o,orientations:l,velocities:i}=on(a);0===(63&ge++)&&m(),xn(a);const s=Me,u=(s+1)%N,c=We.pos[s],d=We.quat[s],f=Ie.pos[s],v=Ie.quat[s],g=(We.tailPhase[s],We.tailSpeed[s]),h=We.tailTurn[s],b=We.tailDrive[s],y=(Ie.tailPhase[s],Ie.tailSpeed[s]),w=Ie.tailTurn[s],R=Ie.tailDrive[s],_=c.array,U=d.array,F=f.array,W=v.array,I=g.array,D=h.array,K=b.array,q=y.array,X=w.array,B=R.array,Q=k.position,j=Q.x,V=Q.y,z=Q.z,O=hn(),Y=O>0?Math.max(0,a-O):a;vn!==O&&bn(O)&&(vn=O);for(const n of fn)n.visible=!1;const Z=G,[ee,ne,ue,ce]=Se;for(let n=0;n<a;++n){const e=3*n,t=o[e],a=o[e+1],r=o[e+2],s=i?i[e]:0,u=i?i[e+1]:0,c=i?i[e+2]:0,d=t-j,p=a-V,m=r-z,f=d*d+p*p+m*m,v=f<H,g=!v&&f<$,h=v||g,b=4*n,y=l[b],w=l[b+1],x=l[b+2],k=l[b+3],T=n>=Y&&O>0;if(T){const o=n-Y,l=fn[o];l&&(l.visible=!0,l.position.set(t,a,r),l.quaternion.set(y,w,x,k)),_[e]=Z,_[e+1]=Z,_[e+2]=Z,U[b]=ee,U[b+1]=ne,U[b+2]=ue,U[b+3]=ce,F[e]=Z,F[e+1]=Z,F[e+2]=Z,W[b]=ee,W[b+1]=ne,W[b+2]=ue,W[b+3]=ce,I[n]=0,q[n]=0,D[n]=0,X[n]=0,K[n]=0,B[n]=0,Ne&&(Ne[e]=0,Ne[e+1]=0,Ne[e+2]=0);continue}const S=Math.hypot(s,u,c),C=Ne?Ne[e]:0,L=Ne?Ne[e+1]:0,P=Ne?Ne[e+2]:0,E=Math.hypot(C,L,P);let R=0;if(E>1e-5&&S>1e-5){const e=P*s-C*c,n=C*s+L*u+P*c;R=Math.atan2(e,n)}const A=S,M=R;v?(_[e]=t,_[e+1]=a,_[e+2]=r,U[b]=y,U[b+1]=w,U[b+2]=x,U[b+3]=k,F[e]=Z,F[e+1]=Z,F[e+2]=Z,W[b]=ee,W[b+1]=ne,W[b+2]=ue,W[b+3]=ce):(F[e]=t,F[e+1]=a,F[e+2]=r,W[b]=y,W[b+1]=w,W[b+2]=x,W[b+3]=k,_[e]=Z,_[e+1]=Z,_[e+2]=Z,U[b]=ee,U[b+1]=ne,U[b+2]=ue,U[b+3]=ce);const Q=h?A:0,J=h?M:0,N=h?1:0;v?(I[n]=Q,D[n]=J,q[n]=0,X[n]=0,K[n]=N,B[n]=0):(I[n]=0,D[n]=0,q[n]=Q,X[n]=J,K[n]=0,B[n]=N),Ne&&(Ne[e]=s,Ne[e+1]=u,Ne[e+2]=c)}const de=O>0?Math.max(0,a-O):a;if(xe.count=de,ke.count=de,Ze(xe,We,s),Ze(ke,Ie,s),c.needsUpdate=!0,d.needsUpdate=!0,f.needsUpdate=!0,v.needsUpdate=!0,g.needsUpdate=!0,h.needsUpdate=!0,b.needsUpdate=!0,y.needsUpdate=!0,w.needsUpdate=!0,R.needsUpdate=!0,Me=u,A.value){const e=p(),t=n.HEAP32.buffer,o=new Int32Array(t,e,2*a);for(let n=0;n<de;n++){let e=-1;for(let a=0;a<o.length;a+=2)if(o[a]===n){e=o[a+1];break}const t=e>=0?(new r.Q1f).setHSL(e%100/100,.8,.6):new r.Q1f(1,0,0);xe.setColorAt(n,t),ke.setColorAt(n,t)}xe.instanceColor.needsUpdate=!0,ke.instanceColor.needsUpdate=!0}else if(gn){const e=new r.Q1f(1,1,1);for(let n=0;n<de;n++)xe.setColorAt(n,e),ke.setColorAt(n,e);xe.instanceColor.needsUpdate=!0,ke.instanceColor.needsUpdate=!0,console.log("✓ Reset vertex colors to white (OFF mode)")}if(gn=A.value,S.update(),L&&(L.uniforms.cameraNear.value=k.near,L.uniforms.cameraFar.value=k.far,L.uniforms.projectionMatrixInverse.value.copy(k.projectionMatrixInverse),L.uniforms.cameraMatrixWorld.value.copy(k.matrixWorld),P?.depthTexture&&(L.uniforms.tDepth.value=P.depthTexture)),_n()||!C?T.render(x,k):C.render(),le&&oe&&ie&&(oe.endQuery(le.TIME_ELAPSED_EXT),re=ie,ie=null),le&&oe&&re){const e=oe.getQueryParameter(re,oe.QUERY_RESULT_AVAILABLE),n=oe.getParameter(le.GPU_DISJOINT_EXT);if(e){if(!n){const e=oe.getQueryParameter(re,oe.QUERY_RESULT);se=e/1e6,!ae&&te&&"function"===typeof M.A.Panel&&(ae=te.addPanel(new M.A.Panel("GPU (ms)","#ff8","#221")),te.showPanel(0)),ae?.update(se,33)}oe.deleteQuery(re),re=null}}te?.end(),he=setTimeout(En,J)}function Rn(){const e=new n.VectorSpeciesParams;h.forEach((n=>{const t="number"===typeof n.tau?n.tau:0;e.push_back({species:n.species||"default",count:n.count||0,cohesion:n.cohesion||0,separation:n.separation||0,alignment:n.alignment||0,maxSpeed:n.maxSpeed||1,minSpeed:n.minSpeed||0,maxTurnAngle:n.maxTurnAngle||0,separationRange:n.separationRange||0,alignmentRange:n.alignmentRange||0,cohesionRange:n.cohesionRange||0,maxNeighbors:n.maxNeighbors||0,lambda:n.lambda||0,horizontalTorque:n.horizontalTorque||0,velocityEpsilon:n.velocityEpsilon||0,torqueStrength:n.torqueStrength||0,tau:t,isPredator:n.isPredator||!1})})),n.callInitBoids(e,1,6,.25),c(16,0);const t=Tn();d&&d(t,40,.25),b=t,Sn(t),En()}function _n(){return/Mobi|Android/i.test(navigator.userAgent)}function Un(){h.length=0,v.forEach((e=>h.push({...e})))}return(0,o.sV)((()=>{ye(),Cn((()=>{console.log("Boid model loaded successfully."),te=new M.A,te.showPanel(0),document.body.appendChild(te.dom),te.dom.style.position="fixed",te.dom.style.right="0px",te.dom.style.top="0px",te.dom.style.left="auto",te.dom.style.zIndex=1e3,le&&"function"===typeof M.A.Panel&&!ae&&(ae=te.addPanel(new M.A.Panel("GPU (ms)","#ff8","#221")),te.showPanel(0)),Rn()})),window.addEventListener("keydown",be)})),(0,o.wB)(h,(()=>{if(n&&n.setGlobalSpeciesParamsFromJS){const e=new n.VectorSpeciesParams;h.forEach((n=>{const t="number"===typeof n.tau?n.tau:0;e.push_back({species:n.species||"default",count:n.count||0,cohesion:n.cohesion||0,separation:n.separation||0,alignment:n.alignment||0,maxSpeed:n.maxSpeed||1,minSpeed:n.minSpeed||0,maxTurnAngle:n.maxTurnAngle||0,separationRange:n.separationRange||0,alignmentRange:n.alignmentRange||0,cohesionRange:n.cohesionRange||0,maxNeighbors:n.maxNeighbors||0,lambda:n.lambda||0,horizontalTorque:n.horizontalTorque||0,velocityEpsilon:n.velocityEpsilon||0,torqueStrength:n.torqueStrength||0,tau:t,isPredator:n.isPredator||!1})})),n.setGlobalSpeciesParamsFromJS(e,1);try{const e=h.map((e=>({...(0,i.ux)(e)})));localStorage.setItem("boids_settings",JSON.stringify(e))}catch(a){console.error("Failed to save settings to localStorage:",a)}}const e=Tn();e!==b&&(b=e,d&&d(e,40,.25),Sn(e));const t=hn();bn(t)&&(vn=t);for(const n of fn)n.visible=!1}),{deep:!0}),(0,o.wB)(R,(e=>{console.log("showUnits changed to:",e),e||Ln()})),(0,o.wB)([_,U],(([e,n])=>{console.log("Unit display mode changed - Spheres:",e,"Lines:",n),R.value&&Ln()})),(e,n)=>((0,o.uX)(),(0,o.CE)("div",B,[(0,o.Lk)("div",Q,[n[12]||(n[12]=(0,o.Lk)("h1",null,"Boids Simulation",-1)),(0,o.Lk)("details",null,[n[11]||(n[11]=(0,o.Lk)("summary",null,"Settings",-1)),((0,o.uX)(!0),(0,o.CE)(o.FK,null,(0,o.pI)(h,((e,n)=>((0,o.uX)(),(0,o.CE)("div",{key:n},[(0,o.bF)(F,{settings:e},null,8,["settings"])])))),128)),(0,o.Lk)("button",{onClick:Un,style:{"margin-bottom":"1em"}},"リセット"),(0,o.Lk)("div",null,[(0,o.Lk)("label",null,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[0]||(n[0]=e=>R.value=e)},null,512),[[a.lH,R.value]]),n[5]||(n[5]=(0,o.eW)(" Unit可視化 "))]),(0,o.Lk)("label",j,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[1]||(n[1]=e=>_.value=e)},null,512),[[a.lH,_.value]]),n[6]||(n[6]=(0,o.eW)(" スフィアのみ表示 "))]),n[10]||(n[10]=(0,o.eW)()),(0,o.Lk)("label",V,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[2]||(n[2]=e=>U.value=e)},null,512),[[a.lH,U.value]]),n[7]||(n[7]=(0,o.eW)(" 線のみ表示 "))]),(0,o.Lk)("label",z,[(0,o.bo)((0,o.Lk)("input",{type:"checkbox","onUpdate:modelValue":n[3]||(n[3]=e=>A.value=e)},null,512),[[a.lH,A.value]]),n[8]||(n[8]=(0,o.eW)(" Unit色分け "))]),(0,o.Lk)("label",O,[n[9]||(n[9]=(0,o.eW)(" 表示レイヤ下限: ")),(0,o.bo)((0,o.Lk)("input",{type:"range",min:"1",max:"20","onUpdate:modelValue":n[4]||(n[4]=e=>Z.value=e)},null,512),[[a.Jo,Z.value]]),(0,o.eW)(" "+(0,l.v_)(Z.value),1)])])]),(0,o.Lk)("div",Y,[(0,o.Lk)("p",null,"Boids Count: "+(0,l.v_)(y.value),1)])]),(0,o.Lk)("div",{ref_key:"threeContainer",ref:w,class:"three-container"},null,512)]))}},ee=Z,ne=ee,te="/wasm-boids/".replace(/\/*$/,"/"),ae=`${te}static/js`,oe=`${ae}/wasm_boids.js`,le=`${ae}/wasm_boids.wasm`;import(oe).then((e=>{if(!e?.default)throw new Error("WASM module loader not found at: "+oe);return e.default({locateFile:e=>e.endsWith(".wasm")?le:e})})).then((e=>{"undefined"!==typeof window&&(window.wasmModule=e),console.log("Wasm module initialized:",e);const n=(0,a.Ef)(ne);n.provide("wasmModule",e),n.mount("#app")})).catch((e=>{console.error("Failed to initialise WASM module:",e)}))}},n={};function t(a){var o=n[a];if(void 0!==o)return o.exports;var l=n[a]={exports:{}};return e[a](l,l.exports,t),l.exports}t.m=e,(()=>{var e=[];t.O=(n,a,o,l)=>{if(!a){var i=1/0;for(c=0;c<e.length;c++){for(var[a,o,l]=e[c],r=!0,s=0;s<a.length;s++)(!1&l||i>=l)&&Object.keys(t.O).every((e=>t.O[e](a[s])))?a.splice(s--,1):(r=!1,l<i&&(i=l));if(r){e.splice(c--,1);var u=o();void 0!==u&&(n=u)}}return n}l=l||0;for(var c=e.length;c>0&&e[c-1][2]>l;c--)e[c]=e[c-1];e[c]=[a,o,l]}})(),(()=>{t.d=(e,n)=>{for(var a in n)t.o(n,a)&&!t.o(e,a)&&Object.defineProperty(e,a,{enumerable:!0,get:n[a]})}})(),(()=>{t.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()})(),(()=>{t.o=(e,n)=>Object.prototype.hasOwnProperty.call(e,n)})(),(()=>{var e={57:0};t.O.j=n=>0===e[n];var n=(n,a)=>{var o,l,[i,r,s]=a,u=0;if(i.some((n=>0!==e[n]))){for(o in r)t.o(r,o)&&(t.m[o]=r[o]);if(s)var c=s(t)}for(n&&n(a);u<i.length;u++)l=i[u],t.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return t.O(c)},a=self["webpackChunkwasm_boids"]=self["webpackChunkwasm_boids"]||[];a.forEach(n.bind(null,0)),a.push=n.bind(null,a.push.bind(a))})();var a=t.O(void 0,[504],(()=>t(979)));a=t.O(a)})();
//# sourceMappingURL=index.184d86d7.js.map